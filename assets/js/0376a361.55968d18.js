"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[3560],{28453:(e,r,i)=>{i.d(r,{R:()=>o,x:()=>c});var n=i(96540);const t={},a=n.createContext(t);function o(e){const r=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(a.Provider,{value:r},e.children)}},72615:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>n,toc:()=>s});const n=JSON.parse('{"id":"client/http","title":"Calling an HTTP service","description":"You can create a WebClient with a base URI and send a request with a relative path.","source":"@site/src/content/docs/client/http.mdx","sourceDirName":"client","slug":"/client/http","permalink":"/docs/client/http","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/client/http.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Client","permalink":"/docs/category/client"},"next":{"title":"Calling a Thrift service","permalink":"/docs/client/thrift"}}');var t=i(74848),a=i(28453);const o={},c="Calling an HTTP service",l={},s=[{value:"Decorating a WebClient",id:"decorating-a-webclient",level:2},{value:"Service discovery with WebClient",id:"service-discovery-with-webclient",level:2},{value:"Configuring ClientFactory",id:"configuring-clientfactory",level:2},{value:"See also",id:"see-also",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"calling-an-http-service",children:"Calling an HTTP service"})}),"\n",(0,t.jsxs)(r.p,{children:["You can create a ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html",children:"WebClient"})," with a base URI and send a request with a relative path."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.client.WebClient;\nimport com.linecorp.armeria.common.AggregatedHttpResponse;\nimport com.linecorp.armeria.common.HttpHeaderNames;\nimport com.linecorp.armeria.common.HttpMethod;\nimport com.linecorp.armeria.common.RequestHeaders;\n\nWebClient webClient = WebClient.of("http://example.com/");\n\n// Send a simple GET request.\nAggregatedHttpResponse res1 = webClient.get("/foo/bar.txt").aggregate().join();\n\n// Send a GET request with an additional header.\nRequestHeaders getJson = RequestHeaders.of(HttpMethod.GET, "/foo/bar.json",\n                                           HttpHeaderNames.ACCEPT, "application/json");\n\nAggregatedHttpResponse res2 = webClient.execute(getJson).aggregate().join();\n\n// Send a simple POST request encoded in UTF-8.\nAggregatedHttpResponse res3 = webClient.post("/upload", "{ \\"foo\\": \\"bar\\" }")\n                                       .aggregate().join();\n'})}),"\n",(0,t.jsxs)(r.p,{children:["You can also create a ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html",children:"WebClient"})," without a base URI and send a request with an absolute URI.\nThe ad-hoc ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html",children:"WebClient"})," would be useful in the following cases:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Sending requests to arbitrary endpoints"}),"\n",(0,t.jsx)(r.li,{children:"Building a proxy server"}),"\n",(0,t.jsx)(r.li,{children:"Handling redirected requests"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.HttpStatus;\nimport com.linecorp.armeria.common.HttpHeaderNames;\n\n// Create a WebClient without a base URI.\nWebClient webClient = WebClient.of();\n\n// Send a request with an absolute URI.\nAggregatedHttpResponse res1 = webClient.get("http://example.com/foo/bar.txt")\n                                       .aggregate()\n                                       .join();\n\n// Send a GET request with an authority header.\nHttpRequest request = HttpRequest.of(RequestHeaders.builder()\n                                                   .scheme(SessionProtocol.HTTP)\n                                                   .authority("example.com")\n                                                   .method(HttpMethod.GET)\n                                                   .path("/foo/bar.txt")\n                                                   .build());\nAggregatedHttpResponse res2 = webClient.execute(request).aggregate().join();\n\n// Handle a redirected request\nAggregatedHttpResponse redirected = webClient.get("http://example.com/redirect")\n                                             .aggregate()\n                                             .join();\nassert redirected.status() == HttpStatus.TEMPORARY_REDIRECT;\nString location = redirected.headers().get(HttpHeaderNames.LOCATION);\nAggregatedHttpResponse actual = webClient.get(location).aggregate().join();\n'})}),"\n",(0,t.jsx)(r.h2,{id:"decorating-a-webclient",children:"Decorating a WebClient"}),"\n",(0,t.jsxs)(r.p,{children:["You can enrich your ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html",children:"WebClient"})," by decorating it with decorators.\nA decorator wraps another client to intercept an outgoing request or an incoming response.\nA lot of core features such as logging, metrics and distributed tracing are implemented as decorators."]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/brave/BraveClient.html",children:"BraveClient"})," which ",(0,t.jsx)(r.a,{href:"/docs/advanced/zipkin",children:"traces"})," outbound requests using\n",(0,t.jsx)(r.a,{href:"https://github.com/openzipkin/brave",children:"Brave"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerClient.html",children:"CircuitBreakerClient"})," which ",(0,t.jsx)(r.a,{href:"/docs/client/circuit-breaker",children:"opens a circuit"})," on failed responses."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/cookie/CookieClient.html",children:"CookieClient"})," which stores cookies of responses using ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/cookie/CookieJar.html",children:"CookieJar"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/limit/ConcurrencyLimitingClient.html",children:"ConcurrencyLimitingClient"})," which limits the concurrent number of active requests."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/logging/ContentPreviewingClient.html",children:"ContentPreviewingClient"})," which\n",(0,t.jsx)(r.a,{href:"/docs/advanced/structured-logging/#enabling-content-previews",children:"previews the content"})," of\nrequests and responses."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/encoding/DecodingClient.html",children:"DecodingClient"})," which decompresses a\n",(0,t.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding",children:"compressed"})," response."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/metric/MetricCollectingClient.html",children:"MetricCollectingClient"})," which\n",(0,t.jsx)(r.a,{href:"/docs/advanced/metrics#collecting-client-side-metrics",children:"collects metrics"})," using\n",(0,t.jsx)(r.a,{href:"https://micrometer.io/",children:"Micrometer"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/logging/LoggingClient.html",children:"LoggingClient"})," which logs requests and responses."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html",children:"RetryingClient"})," which ",(0,t.jsx)(r.a,{href:"/docs/client/retry",children:"automatically retries"})," failed requests."]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'import brave.http.HttpTracing;\nimport com.linecorp.armeria.client.brave.BraveClient;\nimport com.linecorp.armeria.client.circuitbreaker.CircuitBreaker;\nimport com.linecorp.armeria.client.circuitbreaker.CircuitBreakerClient;\nimport com.linecorp.armeria.client.circuitbreaker.CircuitBreakerRule;\nimport com.linecorp.armeria.client.cookie.CookieClient;\nimport com.linecorp.armeria.client.encoding.DecodingClient;\nimport com.linecorp.armeria.client.limit.ConcurrencyLimitingClient;\nimport com.linecorp.armeria.client.logging.ContentPreviewingClient;\nimport com.linecorp.armeria.client.logging.LoggingClient;\nimport com.linecorp.armeria.client.metric.MetricCollectingClient;\nimport com.linecorp.armeria.client.retry.RetryRule;\nimport com.linecorp.armeria.client.retry.RetryingClient;\nimport com.linecorp.armeria.common.metric.MeterIdPrefixFunction;\n\nHttpTracing tracing = ...;\nWebClient.builder()\n         .decorator(BraveClient.newDecorator(tracing))\n         .decorator(CircuitBreakerClient.newDecorator(\n             CircuitBreaker.ofDefaultName(), CircuitBreakerRule.onServerErrorStatus()))\n         .decorator(ConcurrencyLimitingClient.newDecorator(64))\n         .decorator(ContentPreviewingClient.newDecorator(128))\n         .decorator(CookieClient.newDecorator())\n         .decorator(DecodingClient.newDecorator())\n         .decorator(MetricCollectingClient.newDecorator(\n             MeterIdPrefixFunction.ofDefault("armeria.client")))\n         .decorator(LoggingClient.newDecorator())\n         .decorator(RetryingClient.newDecorator(RetryRule.onUnprocessed()))\n         ...\n         .build();\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Please see ",(0,t.jsx)(r.a,{href:"/docs/client/decorator",children:"Decorating a client"})," to learn how it works."]}),"\n",(0,t.jsx)(r.h2,{id:"service-discovery-with-webclient",children:"Service discovery with WebClient"}),"\n",(0,t.jsxs)(r.p,{children:["Armeria provides the various ",(0,t.jsx)(r.a,{href:"https://microservices.io/patterns/client-side-discovery.html",children:"service discovery"}),"\nmechanisms with ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/endpoint/EndpointGroup.html",children:"EndpointGroup"}),",\nfrom Kubernetes-style ",(0,t.jsx)(r.a,{href:"/docs/client/service-discovery#dns-based-service-discovery-with-dnsendpointgroup",children:"DNS records"}),"\nto ",(0,t.jsx)(r.a,{href:"/docs/client/service-discovery#consul-based-service-discovery-with-consulendpointgroup",children:"Consul"}),".\nRequests are sent to dynamically retrieved ",(0,t.jsx)(r.a,{href:"typeplural://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/Endpoint.html",children:"Endpoint"})," by specifying an ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/endpoint/EndpointGroup.html",children:"EndpointGroup"}),"\nto a ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html",children:"WebClient"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.client.endpoint.dns.DnsServiceEndpointGroup;\n\n// Retrieve the Endpoint list from SRV records\nDnsServiceEndpointGroup group =\n    DnsServiceEndpointGroup.of("k8s.default.svc.cluster.local.");\n\n// Filter out unhealthy endpoints\nHealthCheckedEndpointGroup healthCheckedGroup =\n        HealthCheckedEndpointGroup.of(group, "/monitor/l7check");\n\nWebClient.builder(SessionProtocol.HTTP, healthCheckedGroup)\n         ...\n         .build();\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Please check ",(0,t.jsx)(r.a,{href:"/docs/client/service-discovery",children:"Client-side load balancing and service discovery"}),"\nfor more information."]}),"\n",(0,t.jsx)(r.h2,{id:"configuring-clientfactory",children:"Configuring ClientFactory"}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html",children:"ClientFactory"})," manages connections and protocol-specific properties.\nYou can build your own ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html",children:"ClientFactory"})," using ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactoryBuilder.html",children:"ClientFactoryBuilder"})," and\nset it through ",(0,t.jsx)(r.a,{href:"type://#",children:"WebClientBuilder#factory()"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import com.linecorp.armeria.client.ClientFactory;\n// Create a customized ClientFactory\nClientFactory clientFactory =\n    ClientFactory.builder()\n                 // Increase the connect timeout from 3.2s to 10s.\n                 .connectTimeout(Duration.ofSeconds(10))\n                 .\n                 .build();\n\nWebClient client =\n        WebClient.builder()\n                 .factory(clientFactory)\n                 .build();\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Please check ",(0,t.jsxs)(r.a,{href:"/docs/client/factory",children:["Customizing a ",(0,t.jsx)(r.code,{children:"ClientFactory"})," with ",(0,t.jsx)(r.code,{children:"ClientFactoryBuilder"})]}),"\nfor the details."]}),"\n",(0,t.jsx)(r.h2,{id:"see-also",children:"See also"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"/docs/client/retrofit",children:"Retrofit integration"})}),"\n"]})]})}function m(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);