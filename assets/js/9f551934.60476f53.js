"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[5311],{7330:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});var t=i(97968),r=i(74848),a=i(28453);const o={authors:["teo"],other_languages:{ja:"/blog/ja/2020/01/14/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019"}},s="Monitoring a Spring Boot app in Kubernetes - What I learned from Devoxx Belgium 2019",l={authorsImageUrls:[void 0]},c=[{value:"Monitoring Example - Spring Boot application in Kubernetes",id:"monitoring-example---spring-boot-application-in-kubernetes",level:2},{value:"1. Preparing a Spring Boot application",id:"1-preparing-a-spring-boot-application",level:3},{value:"2. Installing Docker &amp; Kubernetes",id:"2-installing-docker--kubernetes",level:3},{value:"Docker",id:"docker",level:4},{value:"Kubernetes",id:"kubernetes",level:4},{value:"3. Building an Image",id:"3-building-an-image",level:3},{value:"Jib",id:"jib",level:4},{value:"4. Deploying to Kubernetes",id:"4-deploying-to-kubernetes",level:3},{value:"5. Monitoring our application inside Kubernetes",id:"5-monitoring-our-application-inside-kubernetes",level:3},{value:"Installing Prometheus",id:"installing-prometheus",level:4},{value:"Installing Grafana",id:"installing-grafana",level:4},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This November, accompanied by 3 other members of the Shop team, I attended Devoxx Belgium 2019, held in Antwerp, Belgium - the birthplace of Devoxx and most populous city of Belgium."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(98824).A+"",width:"1024",height:"682"})}),"\n","\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Devoxx",children:"Devoxx"})," is a developer community conference series started in 2001 which quickly grew to become one of the largest vendor-independent Java conferences in the world.\nToday, Devoxx conferences are also held in France, Poland, Ukraine, Morocco, and the UK."]}),"\n",(0,r.jsx)(n.p,{children:'Devoxx Belgium took place in "Kinepolis," one of the largest cinemas in Europe.\nThe speakers\' video and slides were projected on the huge cinema screens in 4K using the available THX audio setup.\nThe view was great!'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{src:i(37495).A+"",width:"1024",height:"768"})," ",(0,r.jsx)(n.img,{src:i(85562).A+"",width:"1024",height:"768"})," ",(0,r.jsx)(n.img,{src:i(75049).A+"",width:"768",height:"1024"})]}),"\n",(0,r.jsx)(n.p,{children:"In this blog post, I'd like to present a small hands-on example on monitoring a Spring Boot application in Kubernetes using what I learned at Devoxx.\nIn particular, I'd like to talk about:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Preparing a Spring Boot application"}),"\n",(0,r.jsx)(n.li,{children:"Installing Docker and Kubernetes"}),"\n",(0,r.jsx)(n.li,{children:"Building a Docker image"}),"\n",(0,r.jsx)(n.li,{children:"Deploying to Kubernetes"}),"\n",(0,r.jsx)(n.li,{children:"Monitoring our application inside Kubernetes"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-example---spring-boot-application-in-kubernetes",children:"Monitoring Example - Spring Boot application in Kubernetes"}),"\n",(0,r.jsx)(n.h3,{id:"1-preparing-a-spring-boot-application",children:"1. Preparing a Spring Boot application"}),"\n",(0,r.jsxs)(n.p,{children:['For this example, I\'m going to use a sample "Hello World" Spring Boot application that uses ',(0,r.jsx)(n.a,{href:"https://line.github.io/armeria/",children:"Armeria"}),".\nOn the Shop team we use Armeria to develop high-performance asynchronous microservices that use HTTP/2 as a session layer protocol.\nI want to use Armeria in this example to show how you can expose a custom metrics endpoint and have Prometheus pull metrics from it.\nExamples on how to get started with Armeria are available on ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria-examples",children:"Armeria's GitHub repo"}),".\nThe source code for this example is on ",(0,r.jsx)(n.a,{href:"https://github.com/nirvanarsc/k8s-monitoring-sample",children:"GitHub"}),".\nI've only tested the code on macOS."]}),"\n",(0,r.jsxs)(n.p,{children:["I have set up a ",(0,r.jsx)(n.a,{href:"https://github.com/nirvanarsc/k8s-monitoring-sample/blob/master/src/main/java/com/github/nirvanarsc/k8s/monitoring/sample/service/GreetingService.java#L17",children:"gRPC Service"})," and an ",(0,r.jsx)(n.a,{href:"https://github.com/nirvanarsc/k8s-monitoring-sample/blob/master/src/main/java/com/github/nirvanarsc/k8s/monitoring/sample/service/SampleService.java#L11",children:"HTTP Service"})," which we can call by navigating to ",(0,r.jsx)(n.code,{children:"/internal/docs"}),".\nDocService is a single-page web application that comes out of the box with Armeria listing all of our services and allowing us to call test them.\nMore about it can be found on ",(0,r.jsx)(n.a,{href:"https://line.github.io/armeria/server-docservice.html",children:"Armeria's official documentation"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(45704).A+"",width:"1024",height:"753"})}),"\n",(0,r.jsx)(n.h3,{id:"2-installing-docker--kubernetes",children:"2. Installing Docker & Kubernetes"}),"\n",(0,r.jsx)(n.h4,{id:"docker",children:"Docker"}),"\n",(0,r.jsxs)(n.p,{children:["Before we get started with Kubernetes, we need to install ",(0,r.jsx)(n.a,{href:"https://docs.docker.com/install/",children:"Docker"}),".\nIf you are just getting started with Docker, I found the official ",(0,r.jsx)(n.a,{href:"https://docs.docker.com/get-started/",children:"quickstart guide"})," useful.\nWe're going to use a public registry to push our application image to, so please ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/signup",children:"register"})," and login to Docker through the GUI or by running:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ docker login\n"})}),"\n",(0,r.jsxs)(n.p,{children:["There seems to be some confusion online regarding the user name you should use when prompted to login.\nDo not use your email!\nUse the Docker ID you chose when signing up.\nYou can find your Docker ID in the upper right corner after logging in to ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/",children:"Docker Hub"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(7683).A+"",width:"1024",height:"458"})}),"\n",(0,r.jsx)(n.h4,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"Okay now let's install Kubernetes.\nFor this example, we're just going to enable Kubernetes inside Docker."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(17850).A+"",width:"1024",height:"845"})}),"\n",(0,r.jsx)(n.p,{children:"Alternatives to docker-desktop for running a local Kubernetes cluster include:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/minikube",children:"minikube"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/kind",children:"kind"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-building-an-image",children:"3. Building an Image"}),"\n",(0,r.jsx)(n.p,{children:"If you've got this far you should be able to run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl cluster-info\n"})}),"\n",(0,r.jsx)(n.p,{children:"and see something similar to the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Kubernetes master is running at https://kubernetes.docker.internal:6443\nKubeDNS is running at https://kubernetes.docker.internal:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.\n"})}),"\n",(0,r.jsxs)(n.p,{children:["So far so good.\nNow let's build a docker image for our Spring Boot app.\nAll we need to do is write a Docker file and run a Docker daemon, while watching out for the best-practices for Docker.\nPerhaps following the first part of this ",(0,r.jsx)(n.a,{href:"https://spring.io/guides/topicals/spring-boot-docker/",children:"guide"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"jib",children:"Jib"}),"\n",(0,r.jsxs)(n.p,{children:["Or we can just jib it. ",(0,r.jsx)(n.a,{href:"https://github.com/GoogleContainerTools/jib",children:"Jib"})," is a tool developed by Google that helps you build Docker images for your Java applications without a Docker daemon - and without deep mastery of Docker best-practices.\nAll we need to do is to add the following to our build.gradle file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"plugins {\n    ..\n    id 'com.google.cloud.tools.jib' version '1.8.0'\n}\n\njib.to.image = 'docker_id/image_name'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In this example we're using a public docker registry but jib can be configured to upload images to a private registry.\nMore on that in ",(0,r.jsx)(n.a,{href:"https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin#authentication-methods",children:"Jib's official documentation"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"After we have configured the jib plugin, building our Docker image is as simple as running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ ./gradlew jib\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If all is well after logging in to ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/",children:"Docker Hub"})," you should see your image on top."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(70733).A+"",width:"1024",height:"522"})}),"\n",(0,r.jsxs)(n.p,{children:["The url for your image should be of the form ",(0,r.jsx)(n.code,{children:"docker.io/docker_id/image_name"})]}),"\n",(0,r.jsx)(n.h3,{id:"4-deploying-to-kubernetes",children:"4. Deploying to Kubernetes"}),"\n",(0,r.jsxs)(n.p,{children:["Next, let's deploy our image to Kubernetes.\nTo do this, we need to write YAML configuration files, and as you can see in these tutorials from ",(0,r.jsx)(n.a,{href:"https://developer.ibm.com/tutorials/yaml-basics-and-usage-in-kubernetes/",children:"IBM"})," and ",(0,r.jsx)(n.a,{href:"https://www.mirantis.com/blog/introduction-to-yaml-creating-a-kubernetes-deployment/",children:"Mirantis"}),", writing even a basic .yaml file correctly can be a daunting task.\nHowever, there is a very easy way to get started, which I found out at Ray Tsang's session ",(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=c16oOeTfFXM",children:'"Best Practices to Spring to Kubernetes Easier and Faster"'})," at Devoxx.\nInstead of doing something like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl create deployment my-app --image docker.io/nirvanarsc/my-app\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We should add the ",(0,r.jsx)(n.code,{children:"--dry-run"})," option like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl create deployment my-app --image docker.io/nirvanarsc/my-app --dry-run -oyaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Which will print the YAML configuration necessary for a Deployment with the specified image as follows."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: my-app\n  name: my-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: my-app\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: my-app\n    spec:\n      containers:\n      - image: docker.io/nirvanarsc/my-app\n        name: my-app\n        resources: {}\nstatus: {}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The only thing I will modify here is to increase the replicas from 1 to 3. (Set the number of instances of our app to 3)",(0,r.jsx)(n.br,{}),"\n","In the exact same way, we can get an initial configuration for our service.\nRunning the following for example,"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl create service clusterip my-app --tcp=8080:8080 --dry-run -oyaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"prints this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"apiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: my-app\n  name: my-app\nspec:\n  ports:\n  - name: 8080-8080\n    port: 8080\n    protocol: TCP\n    targetPort: 8080\n  selector:\n    app: my-app\n  type: ClusterIP\nstatus:\n  loadBalancer: {}\n"})}),"\n",(0,r.jsx)(n.p,{children:'Let\'s save both of these configuration to their own files.\nCreate a folder named "k8s" and execute:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl create deployment my-app --image docker.io/nirvanarsc/my-app --dry-run -oyaml > k8s/deployment.yaml\n$ kubectl create service clusterip my-app --tcp=8080:8080 --dry-run -oyaml > k8s/service.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now deploying our app is as simple as running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl apply -f k8s\n"})}),"\n",(0,r.jsx)(n.p,{children:"To access our application we will need to allow external traffic into our Kubernetes cluster."}),"\n",(0,r.jsxs)(n.p,{children:["This article will not be addressing Ingress/LoadBalancer/NodePort.\nPerhaps ",(0,r.jsx)(n.a,{href:"https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0",children:"this article on Medium"})," is a good overview on that subject."]}),"\n",(0,r.jsx)(n.p,{children:"Instead, we will just forward a local port to a port on the cluster like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl port-forward svc/my-app 8080:8080\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now we can access our ",(0,r.jsx)(n.code,{children:"internal/docs"})," endpoint and our ",(0,r.jsx)(n.code,{children:"internal/metrics"})," endpoint at ",(0,r.jsx)(n.code,{children:"http://localhost:8080"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(7492).A+"",width:"1024",height:"753"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(54934).A+"",width:"1024",height:"522"})}),"\n",(0,r.jsx)(n.h3,{id:"5-monitoring-our-application-inside-kubernetes",children:"5. Monitoring our application inside Kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"Finally, we can talk about monitoring.\nFirst a few words about Prometheus and Grafana."}),"\n",(0,r.jsx)(n.p,{children:"Prometheus is a monitoring and alerting system.\nIt was originally built by SoundCloud in 2012, but has since been open sourced and now is part of the CNCF.\nIt is inspired by Google's BorgMon - one of Google's internal monitoring technologies used to monitor services running on Borg.\nBorg is Google's internal cluster scheduler, which in turn inspired Kubernetes.\nSo Prometheus and Kubernetes have both been inspired by complementary technologies inside Google."}),"\n",(0,r.jsx)(n.p,{children:"Grafana is an open source analytics and monitoring system.\nPrometheus and Grafana have become basically the de facto monitoring solution.\nGrafana should not be confused with Kibana, which runs on top of Elasticsearch and is used to analyze log messages.\nOn the Shop team we also use Prometheus with Grafana as our monitoring solution."}),"\n",(0,r.jsx)(n.p,{children:"It is possible to have an external instance of Prometheus discover and pull metrics from our Application inside Kubernetes, but for this example I'm going to install an instance of Prometheus and Grafana inside the cluster and have Prometheus discover our Application and scrape metrics from it."}),"\n",(0,r.jsxs)(n.p,{children:["To install Prometheus and Grafana in our cluster we're going to use ",(0,r.jsx)(n.a,{href:"https://helm.sh/",children:"Helm"}),".\nHelm is a package manager for Kubernetes.\nThink of it like npm/apt for Kubernetes.\nCheck out the ",(0,r.jsx)(n.a,{href:"https://helm.sh/docs/intro/quickstart/",children:"official documentation on getting started"})," if you have the time, but for this example, all the configuration we're going to need is:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ brew install helm\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/\n"})}),"\n",(0,r.jsx)(n.h4,{id:"installing-prometheus",children:"Installing Prometheus"}),"\n",(0,r.jsx)(n.p,{children:"We can install Prometheus in our cluster by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ helm install my-prometheus stable/prometheus\n"})}),"\n",(0,r.jsx)(n.p,{children:"Which should output something like:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'NAME: my-prometheus\nLAST DEPLOYED: Thu Dec  5 15:29:58 2019\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nThe Prometheus server can be accessed via port 80 on the following DNS name from within your cluster:\nmy-prometheus-server.default.svc.cluster.local\n\nGet the Prometheus server URL by running these commands in the same shell:\n  export POD_NAME=$(kubectl get pods --namespace default -l "app=prometheus,component=server" -o jsonpath="{.items[0].metadata.name}")\n  kubectl --namespace default port-forward $POD_NAME 9090\n\nThe Prometheus alertmanager can be accessed via port 80 on the following DNS name from within your cluster:\nmy-prometheus-alertmanager.default.svc.cluster.local\n\nGet the Alertmanager URL by running these commands in the same shell:\n  export POD_NAME=$(kubectl get pods --namespace default -l "app=prometheus,component=alertmanager" -o jsonpath="{.items[0].metadata.name}")\n  kubectl --namespace default port-forward $POD_NAME 9093\n\nThe Prometheus PushGateway can be accessed via port 9091 on the following DNS name from within your cluster:\nmy-prometheus-pushgateway.default.svc.cluster.local\n\nGet the PushGateway URL by running these commands in the same shell:\n  export POD_NAME=$(kubectl get pods --namespace default -l "app=prometheus,component=pushgateway" -o jsonpath="{.items[0].metadata.name}")\n  kubectl --namespace default port-forward $POD_NAME 9091\n\nFor more information on running Prometheus, visit:\nhttps://prometheus.io/\n'})}),"\n",(0,r.jsx)(n.p,{children:"Now if we also run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ export POD_NAME=$(kubectl get pods --namespace default -l "app=prometheus,component=server" -o jsonpath="{.items[0].metadata.name}")\n  kubectl --namespace default port-forward $POD_NAME 9090\n'})}),"\n",(0,r.jsxs)(n.p,{children:["We should be able to access the Prometheus server at ",(0,r.jsx)(n.code,{children:"localhost:9090"})]}),"\n",(0,r.jsx)(n.p,{children:"But if we navigate to status/targets, we will see that Prometheus fails to discover our application."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(33023).A+"",width:"1024",height:"646"})}),"\n",(0,r.jsxs)(n.p,{children:["There's two ways to fix this.\nFirst we can use an ",(0,r.jsx)(n.a,{href:"https://github.com/helm/charts/blob/master/stable/prometheus/values.yaml#L1316",children:"additional argument"})," when installing the Prometheus chart through Helm -",(0,r.jsx)(n.br,{}),"\n","We can create a file ",(0,r.jsx)(n.code,{children:"extraScrapeConfigs.yaml"})," with the following settings"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"extraScrapeConfigs: |\n  - job_name: 'armeria-metrics'\n    scrape_interval: 1s\n    metrics_path: /internal/metrics\n    kubernetes_sd_configs:\n      - role: endpoints\n"})}),"\n",(0,r.jsx)(n.p,{children:"And then we need to update our Prometheus chart config by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ helm upgrade --install my-prometheus --set-file extraScrapeConfigs=prometheus/extraScrapeConfigs.yaml stable/prometheus\n"})}),"\n",(0,r.jsxs)(n.p,{children:["However I suggest we modify our ",(0,r.jsx)(n.code,{children:"deployment.yaml"})," file by adding the following config allowing Prometheus to pull metrics from our app:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'spec.template.metadata.annotations:\n  prometheus.io/scrape: "true"\n  prometheus.io/port: "8080"\n  prometheus.io/path: /internal/metrics\n'})}),"\n",(0,r.jsxs)(n.p,{children:["So our ",(0,r.jsx)(n.code,{children:"deployment.yaml"})," file should look like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: my-app\n  name: my-app\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: my-app\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: my-app\n      annotations:                               ### here\n        prometheus.io/scrape: "true"\n        prometheus.io/port: "8080"\n        prometheus.io/path: /internal/metrics\n    spec:\n      containers:\n      - image: docker.io/nirvanarsc/my-app\n        name: my-app\n        resources: {}\nstatus: {}\n'})}),"\n",(0,r.jsx)(n.p,{children:"And we need to re-deploy our app with the updated configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ kubectl delete deploy/my-app svc/my-app\n$ kubectl apply -f k8s\n$ kubectl port-forward svc/my-app 8080:8080\n"})}),"\n",(0,r.jsx)(n.p,{children:"If we navigate to status/targets now, we should see the 3 pods of our application.\nWe should also be able to query our metrics."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(19460).A+"",width:"1024",height:"665"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(61965).A+"",width:"1024",height:"396"})}),"\n",(0,r.jsx)(n.h4,{id:"installing-grafana",children:"Installing Grafana"}),"\n",(0,r.jsx)(n.p,{children:"Lastly, we can install Grafana and visualize our metrics."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ helm install my-grafana stable/grafana\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'NAME: my-grafana\nLAST DEPLOYED: Thu Dec  5 16:03:33 2019\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nNOTES:\n1. Get your \'admin\' user password by running:\n\n   kubectl get secret --namespace default my-grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo\n\n2. The Grafana server can be accessed via port 80 on the following DNS name from within your cluster:\n\n   my-grafana.default.svc.cluster.local\n\n   Get the Grafana URL to visit by running these commands in the same shell:\n\n     export POD_NAME=$(kubectl get pods --namespace default -l "app=grafana,release=my-grafana" -o jsonpath="{.items[0].metadata.name}")\n     kubectl --namespace default port-forward $POD_NAME 3000\n\n3. Login with the password from step 1 and the username: admin\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Following the instructions above we should be able to log in to Grafana at ",(0,r.jsx)(n.code,{children:"localhost:3000"}),".\nThen we can add Prometheus as a data source and create a dashboard with our applications metrics."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(80402).A+"",width:"1024",height:"723"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(29403).A+"",width:"1024",height:"317"})}),"\n",(0,r.jsx)(n.p,{children:"And that's it!\nWe have successfully used Prometheus and Grafana to build a dashboard visualizing our app's metrics."}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(n.p,{children:"Getting started with Kubernetes can be quite challenging.\nI think there are 3 main reasons for that:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Writing a good YAML file is difficult"}),"\n",(0,r.jsx)(n.li,{children:"Knowledge of networking is required"}),"\n",(0,r.jsx)(n.li,{children:"There are a lot of small interconnected components such as Docker, Pods, Services, and ReplicaSets"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"I hope this blog post will make it a little easier for you to begin development on Kubernetes."}),"\n",(0,r.jsx)(n.p,{children:"Happy coding!"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"A list of the Devoxx sessions about Kubernetes I found most useful:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=c16oOeTfFXM",children:"Best Practices to Spring to Kubernetes Easier and Faster by Ray Tsang - YouTube"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=YYJ4RZFw4j8",children:"Develop and Deploy to Kubernetes like a Googler by David Gageot - YouTube"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=YiXf4Pqyl0A",children:"Helm your way with Kubernetes by Ana Maria Mihalceanu - YouTube"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=dId543PzSsU",children:"Crash course in Kubernetes monitoring by Robert Munteanu - YouTube"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7492:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-9-72863d1657c6923548295bdf10de5dba.png"},7683:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-6-0e05f0c7e2d267e4fa64b2789b2d3ca9.png"},17850:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-7-1a01abcfce3208d0c00906f8e1305be5.png"},19460:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-12-a952350f9bf8708b17939060074def86.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var t=i(96540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},29403:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-15-aeb013ee4a1911f79afdcc680a01e887.png"},33023:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-11-3177aada7f7d631978ce2302a70b6277.png"},37495:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-2-4530f6955b4607b56de009631379926e.jpg"},45704:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-5-72863d1657c6923548295bdf10de5dba.png"},54934:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-10-8c715e5f0e93caec07cf919acc75c4a1.png"},61965:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-13-382dd088b3f97b0c8f38724aa7d7c150.png"},70733:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-8-df9a37f4de7dd4d36a83f18a48efe014.png"},75049:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-4-a9a269fb31331861032e096fc80bd0b2.jpg"},80402:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-14-20c6d4e2bf109eed0aeac970ff02e6f7.png"},85562:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-3-cebba6c5f750b3fb1e59c6d953ef9de0.jpg"},97968:e=>{e.exports=JSON.parse('{"permalink":"/blog/2019/12/23/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019","editUrl":"https://github.com/line/armeria/edit/main/site/src/content/blog/en/2019-12-23-monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019.mdx","source":"@site/src/content/blog/en/2019-12-23-monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019.mdx","title":"Monitoring a Spring Boot app in Kubernetes - What I learned from Devoxx Belgium 2019","description":"This November, accompanied by 3 other members of the Shop team, I attended Devoxx Belgium 2019, held in Antwerp, Belgium - the birthplace of Devoxx and most populous city of Belgium.","date":"2019-12-23T00:00:00.000Z","tags":[],"readingTime":13.04,"hasTruncateMarker":true,"authors":[{"name":"Teo","title":"Teodor is a server-side engineer at LINE.","imageURL":"/img/author-teo.png","key":"teo","page":null}],"frontMatter":{"authors":["teo"],"other_languages":{"ja":"/blog/ja/2020/01/14/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019"}},"unlisted":false,"prevItem":{"title":"Let\'s Play with Reactive Streams on Armeria - Part 1","permalink":"/blog/2020/05/06/reactive-streams-armeria-1"},"nextItem":{"title":"Make your GitHub contributions calendar greener (featuring Armeria Sprint)!","permalink":"/blog/2019/05/14/armeria-sprint-1"}}')},98824:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019-1-8e22983a2492a8731c34a80e445decc8.jpg"}}]);