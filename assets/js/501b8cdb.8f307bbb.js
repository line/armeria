"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[3028],{28453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>c});var t=n(96540);const i={},a=t.createContext(i);function s(e){const r=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:r},e.children)}},36114:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"tutorials/grpc/run-service","title":"Running a service","description":"In this step, we\'ll do three things with the code we obtained from our proto file; we\'ll create a server instance, add an empty gRPC service, and then lastly test connecting to the server.","source":"@site/src/content/docs/tutorials/grpc/02-run-service.mdx","sourceDirName":"tutorials/grpc","slug":"/tutorials/grpc/run-service","permalink":"/docs/tutorials/grpc/run-service","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/tutorials/grpc/02-run-service.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"2. Run a service","category":"grpc","tags":["server"],"level":"basic","type":"step"},"sidebar":"docsSidebar","previous":{"title":"1. Define a service","permalink":"/docs/tutorials/grpc/define-service"},"next":{"title":"3. Implement CREATE","permalink":"/docs/tutorials/grpc/implement-create"}}');var i=n(74848),a=n(28453);const s={sidebar_label:"2. Run a service",category:"grpc",tags:["server"],level:"basic",type:"step"},c="Running a service",l={},o=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Declare an empty service",id:"1-declare-an-empty-service",level:2},{value:"2. Add a service to a server",id:"2-add-a-service-to-a-server",level:2},{value:"3. Run the server and service",id:"3-run-the-server-and-service",level:2},{value:"4. Test connecting to the server",id:"4-test-connecting-to-the-server",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components},{TutorialSteps:n}=r;return n||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"running-a-service",children:"Running a service"})}),"\n",(0,i.jsx)(r.p,{children:"In this step, we'll do three things with the code we obtained from our proto file; we'll create a server instance, add an empty gRPC service, and then lastly test connecting to the server."}),"\n",(0,i.jsx)(n,{current:2}),"\n",(0,i.jsx)(r.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,i.jsxs)(r.p,{children:["You need to have the ",(0,i.jsx)(r.a,{href:"/docs/tutorials/grpc/define-service#6-compile-the-proto-file",children:"generated Java code"})," obtained from the previous step.\nYou can always ",(0,i.jsx)(r.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/grpc",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,i.jsx)(r.h2,{id:"1-declare-an-empty-service",children:"1. Declare an empty service"}),"\n",(0,i.jsxs)(r.p,{children:["Create a file ",(0,i.jsx)(r.code,{children:"BlogService.java"})," and declare an empty blog service. We'll implement the service methods later on in this file. For now, leave it empty."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="BlogService.java"',children:"package example.armeria.blog.grpc;\n\nfinal class BlogService extends BlogServiceGrpc.BlogServiceImplBase {}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"2-add-a-service-to-a-server",children:"2. Add a service to a server"}),"\n",(0,i.jsxs)(r.p,{children:["Build a service and server using Armeria's ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerBuilder.html",children:"ServerBuilder"})," to serve our service."]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Create a main class for our server. You can see the full version of the file ",(0,i.jsx)(r.a,{href:"https://github.com/line/armeria-examples/blob/main/tutorials/grpc/src/main/java/example/armeria/server/blog/grpc/Main.java",children:"here"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="Main.java"',children:"package example.armeria.blog.grpc;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic final class Main {\n  private static final Logger logger = LoggerFactory.getLogger(Main.class);\n}\n"})}),"\n",(0,i.jsxs)(r.ol,{start:"2",children:["\n",(0,i.jsxs)(r.li,{children:["Create a service instance using Armeria's ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcService.html#builder()",children:"GrpcService#builder()"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="Main.java"',children:"import com.linecorp.armeria.server.grpc.GrpcService;\nimport com.linecorp.armeria.server.Server;\n\npublic final class Main {\n...\n  static Server newServer(int port) throws Exception {\n    final GrpcService grpcService =\n      GrpcService.builder()\n                 .addService(new BlogService())\n                 .build();\n  }\n}\n"})}),"\n",(0,i.jsxs)(r.ol,{start:"3",children:["\n",(0,i.jsxs)(r.li,{children:["Build and return a new server instance using Armeria's ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerBuilder.html",children:"ServerBuilder"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="Main.java"',children:"  public final class Main {\n    static Server newServer(int port) throws Exception {\n      ...\n      return Server.builder()\n                   .http(port)\n                   .service(grpcService)\n                   .build();\n\n    }\n"})}),"\n",(0,i.jsx)(r.h2,{id:"3-run-the-server-and-service",children:"3. Run the server and service"}),"\n",(0,i.jsx)(r.p,{children:"Create a server instance and run the blog service."}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Create a server instance in the ",(0,i.jsx)(r.code,{children:"main()"})," method."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="Main.java"',children:'public static void main(String[] args) throws Exception {\n    final Server server = newServer(8080);\n\n    server.closeOnJvmShutdown().thenRun(() -> {\n        logger.info("Server has been stopped.");\n    });\n\n    server.start().join();\n}\n'})}),"\n",(0,i.jsxs)(r.ol,{start:"2",children:["\n",(0,i.jsxs)(r.li,{children:["Start the server by running the ",(0,i.jsx)(r.code,{children:"Main.main()"})," method on your IDE or using Gradle."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"./gradlew run\n"})}),"\n",(0,i.jsx)(r.p,{children:"Your server is running if you see the following message."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"[armeria-boss-http-*:8080] INFO com.linecorp.armeria.server.Server - Serving HTTP at /[0:0:0:0:0:0:0:0%0]:8080 - http://127.0.0.1:8080/\n"})}),"\n",(0,i.jsx)(r.h2,{id:"4-test-connecting-to-the-server",children:"4. Test connecting to the server"}),"\n",(0,i.jsx)(r.p,{children:"Let's create test code and connect to the server by sending a request using a client stub.\nNote that we'll use test code to verify what we implement along the way."}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Create a file, ",(0,i.jsx)(r.code,{children:"BlogServiceTest.java"}),", under ",(0,i.jsx)(r.code,{children:"{project_root}/src/test/java/example/armeria/blog/grpc"})," as follows.\nYou can see the full version of the file ",(0,i.jsx)(r.a,{href:"https://github.com/line/armeria-examples/blob/main/tutorials/grpc/src/test/java/example/armeria/server/blog/grpc/BlogServiceTest.java",children:"here"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"package example.armeria.blog.grpc;\nimport example.armeria.blog.grpc.BlogServiceGrpc.BlogServiceBlockingStub;\n\nclass BlogServiceTest {\n  static BlogServiceBlockingStub client;\n}\n"})}),"\n",(0,i.jsxs)(r.ol,{start:"2",children:["\n",(0,i.jsxs)(r.li,{children:["In the ",(0,i.jsx)(r.code,{children:"BlogServiceTest"})," class, add a test method as follows.\nAlthough we haven't implemented any service methods, we'll call one just to check whether we can connect to the server."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import org.junit.jupiter.api.Test;\nimport com.linecorp.armeria.client.grpc.GrpcClients;\n\n@Test\nvoid connect() {\n  client = GrpcClients.newClient("http://127.0.0.1:8080/",\n                                 BlogServiceBlockingStub.class);\n  client.createBlogPost(CreateBlogPostRequest.newBuilder().build());\n}\n'})}),"\n",(0,i.jsxs)(r.ol,{start:"3",children:["\n",(0,i.jsxs)(r.li,{children:["Make sure that your server is running.\nIf you have not stopped the server, it should already be running.\nOtherwise, restart the server by running the ",(0,i.jsx)(r.code,{children:"Main.main()"})," method."]}),"\n",(0,i.jsx)(r.li,{children:"Run the test case on your IDE or using Gradle."}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"./gradlew test\n"})}),"\n",(0,i.jsx)(r.p,{children:'Your client sent a request to the service successfully if the test fails and throws an "UNIMPLEMENTED" exception.'}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"UNIMPLEMENTED: Method example.armeria.blog.grpc.BlogService/CreateBlogPost is unimplemented\n"})}),"\n",(0,i.jsx)(r.p,{children:"This is because we are yet to implement the service method to create a blog post. One thing we did check is that our service does return something to a client call."}),"\n",(0,i.jsx)(r.h2,{id:"whats-next",children:"What's next"}),"\n",(0,i.jsx)(r.p,{children:"In this step, we've created and added an empty gRPC service to a server. We've also written a test and made a call to the server."}),"\n",(0,i.jsxs)(r.p,{children:["Next, we'll get on with implementing a service method for ",(0,i.jsx)(r.a,{href:"/docs/tutorials/grpc/implement-create",children:"creating blog posts"}),"."]}),"\n",(0,i.jsx)(n,{current:2})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);