"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[6109],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>a});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},76214:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"0.89.0","title":"v0.89.0","description":"New features","source":"@site/src/content/release-notes/0.89.0.mdx","sourceDirName":".","slug":"/0.89.0","permalink":"/release-notes/0.89.0","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/release-notes/0.89.0.mdx","tags":[],"version":"current","frontMatter":{"date":"2019-07-29T00:00:00.000Z"},"sidebar":"defaultSidebar","previous":{"title":"v0.89.1","permalink":"/release-notes/0.89.1"},"next":{"title":"v0.88.0","permalink":"/release-notes/0.88.0"}}');var r=i(74848),t=i(28453);const c={date:new Date("2019-07-29T00:00:00.000Z")},a="v0.89.0",l={},o=[{value:"New features",id:"new-features",level:2},{value:"Improvements",id:"improvements",level:2},{value:"Bug fixes",id:"bug-fixes",level:2},{value:"Deprecations",id:"deprecations",level:2},{value:"Breaking changes",id:"breaking-changes",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Thank you",id:"thank-you",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{ThankYou:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ThankYou",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.header,{children:[(0,r.jsx)(n.h1,{id:"v0890",children:"v0.89.0"}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"July 29, 2019"})})]}),"\n",(0,r.jsx)(n.h2,{id:"new-features",children:"New features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You can now specify decorators for all services in a ",(0,r.jsx)(n.code,{children:"Server"})," in a functional way. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1882",children:"#1882"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1900",children:"#1900"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"ServerBuilder sb = new ServerBuilder();\nsb.service(...);\n// After:\nsb.decorator((delegate, ctx, req) -> {\n    ...\n    return delegate.serve(ctx, req);\n});\n// Before:\nsb.decorator(delegate -> new SimpleServiceDecorator<HttpRequest, HttpResponse>(delegate) {\n    @Override\n    public HttpResponse serve(ServiceRequestContext ctx, HttpRequest req) throws Exception {\n        ...\n        return delegate().serve(ctx, req);\n    }\n});\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You can now use ",(0,r.jsx)(n.code,{children:"HealthCheckService"})," which has richer functionality than its predecessor ",(0,r.jsx)(n.code,{children:"HttpHealthCheckService"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1878",children:"#1878"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'ServerBuilder sb = new ServerBuilder();\nsb.service("/internal/l7check",\n           HealthCheckService.builder()\n                             .checkers(...)\n                             .healthyResponse(...)\n                             .unhealthyResponse(...)\n                             .longPolling(Durations.ofMinutes(1))\n                             .updatable(true)\n                             .build());\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Long-polling query support","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You can wait until the server becomes healthy or unhealthy and get notified immediately."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Easy customization of healthy/unhealthy responses"}),"\n",(0,r.jsx)(n.li,{children:"Easy customization of update request handler"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You now know exact host you are sending your request to when using Armeria client. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1917",children:"#1917"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["It was previously not possible when you specified an ",(0,r.jsx)(n.code,{children:"EndpointGroup"})," as the destination."]}),"\n",(0,r.jsxs)(n.li,{children:["Therefore, ",(0,r.jsx)(n.code,{children:"ClientRequestContext.endpoint()"})," may return ",(0,r.jsx)(n.code,{children:"null"})," since this release when Armeria failed to determine the destination host."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ClientRequestContext.endpointSelector()"})," has been added so that you still know which ",(0,r.jsx)(n.code,{children:"EndpointGroup"})," you are connecting to."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"BraveClient"})," and ",(0,r.jsx)(n.code,{children:"BraveService"})," now accept ",(0,r.jsx)(n.code,{children:"HttpTracing"})," as well as ",(0,r.jsx)(n.code,{children:"Tracing"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1223",children:"#1223"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1906",children:"#1906"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'Tracing tracing = ...;\n\n// Server-side\nServerBuilder sb = new ServerBuilder();\n//// Before\nsb.service("/", myService.decorate(BraveService.newDecorator(tracing)));\n//// After\nHttpTracing httpTracing = HttpTracing.create(tracing);\nsb.service("/", myService.decorate(BraveService.newDecorator(httpTracing)));\n\n// Client-side\nHttpClientBuilder cb = new HttpClientBuilder(...);\n//// Before\ncb.decorator(BraveClient.newDecorator(tracing, "myBackend"));\n//// After\ncb.decorator(BraveClient.newDecorator(httpTracing.clientOf("myBackend")));\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You can now create a decorating ",(0,r.jsx)(n.code,{children:"Service"})," or ",(0,r.jsx)(n.code,{children:"Client"})," in a less verbose way by extending new ",(0,r.jsx)(n.code,{children:"SimpleDecorating*"})," classes. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1881",children:"#1881"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1925",children:"#1925"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SimpleDecoratingHttpService extends SimpleDecoratingService<HttpRequest, HttpResponse>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SimpleDecoratingRpcService extends SimpleDecoratingService<RpcRequest, RpcResponse>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SimpleDecoratingHttpClient extends SimpleDecoratingClient<HttpRequest, HttpResponse>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SimpleDecoratingRpcClient extends SimpleDecoratingClient<RpcRequest, RpcResponse>"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"RpcService"})," has been added for your convenience. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1881",children:"#1881"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1925",children:"#1925"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"RpcService extends Service<RpcRequest, RpcResponse>"})}),"\n"]}),"\n"]}),"\n"]}),"\n","\n",(0,r.jsx)(n.h2,{id:"improvements",children:"Improvements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The output type of ",(0,r.jsx)(n.code,{children:"RequestLog"})," sanitizer functions has been relaxed to ",(0,r.jsx)(n.code,{children:"?"})," so that a user can write much simpler and more efficient sanitizer function. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1810",children:"#1810"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1879",children:"#1879"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Before\nFunction<HttpHeaders, HttpHeaders> sanitizer = headers -> {\n    return headers.toBuilder().removeAndThen("authorization").build();\n};\n// After\nFunction<HttpHeaders, Object> sanitizer = headers -> {\n    // No need to construct a new HttpHeaders object.\n    return headers.toBuilder().removeAndThen("authorization").toString();\n};\n// Even more efficiently\nFunction<HttpHeaders, Object> sanitizer = headers -> "sanitized!";\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["A glob path mapping is not translated into a regex path mapping when combined with path prefix anymore. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1929",children:"#1929"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ByteBufHttpData.toInputStream()"})," does not perform extra memory copy anymore. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1918",children:"#1918"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1919",children:"#1919"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"bug-fixes",children:"Bug fixes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Armeria client now sends ",(0,r.jsx)(n.code,{children:"OPTIONS * HTTP/1.1"})," instead of ",(0,r.jsx)(n.code,{children:"HEAD / HTTP/1.1"}),", so that the initial protocol upgrade does not trigger business logic when a server has business logic bound at ",(0,r.jsx)(n.code,{children:"/"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1895",children:"#1895"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1896",children:"#1896"})]}),"\n",(0,r.jsxs)(n.li,{children:["Response content is not sanitized twice anymore. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1879",children:"#1879"})]}),"\n",(0,r.jsxs)(n.li,{children:["gRPC message compression is now enabled by default on the server side, so that the default behavior matches that of the upstream implementation. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1885",children:"#1885"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1889",children:"#1889"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"max-age"})," attribute in a ",(0,r.jsx)(n.code,{children:"set-cookie"})," header is now handled correctly when using Spring WebFlux. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1904",children:"#1904"})]}),"\n",(0,r.jsxs)(n.li,{children:["Fixed a bug where the base URL of the received request is set incorrectly when using Spring WebFlux. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1904",children:"#1904"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HttpHealthCheckedEndpoint"})," does not leak connections and requests after ",(0,r.jsx)(n.code,{children:"close()"})," is called. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1899",children:"#1899"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"BraveClient"})," does not trigger ",(0,r.jsx)(n.code,{children:"RequestLogAvailabilityException"})," anymore when the request being traced has failed without sending any data. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1911",children:"#1911"})," ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1912",children:"#1912"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@ConsumesJson"})," annotation now accepts JSON documents with any charsets rather than only ",(0,r.jsx)(n.code,{children:"UTF-8"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1920",children:"#1920"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"IllegalStateException"})," raised by ",(0,r.jsx)(n.code,{children:"pushIfAbsent()"})," is now propagated properly to the ",(0,r.jsx)(n.code,{children:"CompletableFuture"})," created by ",(0,r.jsx)(n.code,{children:"RequestContext.makeContextAware()"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1920",children:"#1920"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deprecations",children:"Deprecations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HttpHealthCheckService"})," and ",(0,r.jsx)(n.code,{children:"SettableHttpHealthCheckService"})," have been deprecated in favor of ",(0,r.jsx)(n.code,{children:"HealthCheckService"})," and its builder. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1878",children:"#1878"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"breaking-changes",children:"Breaking changes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ClientRequestContext.endpoint()"})," may return ",(0,r.jsx)(n.code,{children:"null"})," since this release. ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1917",children:"#1917"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"Endpoint"})," returned by ",(0,r.jsx)(n.code,{children:"ClientRequestContext.endpoint()"})," now always refers to a single host, not an ",(0,r.jsx)(n.code,{children:"EndpointGroup"}),". ",(0,r.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1917",children:"#1917"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"ClientRequestContext.endpointSelector().group()"})," to retrieve the related ",(0,r.jsx)(n.code,{children:"EndpointGroup"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"gRPC 1.21.0 -> 1.22.1"}),"\n",(0,r.jsx)(n.li,{children:"Netty 4.1.37 -> 4.1.38"}),"\n",(0,r.jsx)(n.li,{children:"Tomcat 9.0.21 -> 9.0.22, 8.5.42 -> 8.5.43"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"thank-you",children:"Thank you"}),"\n",(0,r.jsx)(i,{usernames:["anuraaga","babjo","codefromthecrypt","hirakida","hyeonjames","ikhoon","imasahiro","kojilin","minwoox","trustin","woohhan"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);