"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[2718],{15284:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-1-b8df78267813bd6db4a7146dc18e2f91.png"},20399:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-2-651dfe37d84cf70fa56b6314072fc869.png"},28453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>o});var t=s(96540);const n={},a=t.createContext(n);function i(e){const r=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(a.Provider,{value:r},e.children)}},44771:e=>{e.exports=JSON.parse('{"permalink":"/blog/2020/07/03/reactive-streams-armeria-2","editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/blog/en/2020-07-03-reactive-streams-armeria-2.mdx","source":"@site/src/content/blog/en/2020-07-03-reactive-streams-armeria-2.mdx","title":"Let\'s Play with Reactive Streams on Armeria - Part 2","description":"In the first part of this blog post, we took a look at the basic concepts of Reactive Streams.","date":"2020-05-06T11:00:00.000Z","tags":[],"readingTime":12.7,"hasTruncateMarker":true,"authors":[{"name":"Um Ikhun","title":"Ikhun is developing for open-source Armeria and Central Dogma at LINE Plus.","imageURL":"https://github.com/ikhoon.png","key":"ikhunum","page":null}],"frontMatter":{"date":"2020-05-06T11:00","authors":["ikhunum"],"other_languages":{"ko":"/blog/ko/2020/02/19/reactive-streams-armeria-2","ja":"/blog/ja/2020/03/26/reactive-streams-armeria-2"}},"unlisted":false,"prevItem":{"title":"Using Circuit Breakers with Armeria","permalink":"/blog/2020/07/08/circuit-breakers-armeria"},"nextItem":{"title":"Let\'s Play with Reactive Streams on Armeria - Part 1","permalink":"/blog/2020/05/06/reactive-streams-armeria-1"}}')},45118:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});var t=s(44771),n=s(74848),a=s(28453);const i={date:"2020-05-06T11:00",authors:["ikhunum"],other_languages:{ko:"/blog/ko/2020/02/19/reactive-streams-armeria-2",ja:"/blog/ja/2020/03/26/reactive-streams-armeria-2"}},o="Let's Play with Reactive Streams on Armeria - Part 2",c={authorsImageUrls:[void 0]},l=[{value:"What\u2019s Armeria?",id:"whats-armeria",level:2},{value:"Supported protocols",id:"supported-protocols",level:3},{value:"A closer look at Armeria",id:"a-closer-look-at-armeria",level:3},{value:"HTTP/2 streams inside Armeria",id:"http2-streams-inside-armeria",level:3},{value:"Consolidating Reactive Streams and Armeria",id:"consolidating-reactive-streams-and-armeria",level:2},{value:"Armeria HTTP response publisher",id:"armeria-http-response-publisher",level:3},{value:"Armeria&#39;s built-in publisher",id:"armerias-built-in-publisher",level:3},{value:"Migrating Spring WebFlux",id:"migrating-spring-webflux",level:2},{value:"Support for gRPC streams",id:"support-for-grpc-streams",level:2},{value:"Armeria features for microservices",id:"armeria-features-for-microservices",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Footnotes",id:"footnotes",level:4}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.p,{children:["In the ",(0,n.jsx)(r.a,{href:"/blog/2020/05/06/reactive-streams-armeria-1",children:"first part of this blog post"}),", we took a look at the basic concepts of Reactive Streams.\nIn part 2 of this blog post, I'd like to tell you about how we use Reactive Streams with Armeria."]}),"\n","\n",(0,n.jsx)(r.h2,{id:"whats-armeria",children:"What\u2019s Armeria?"}),"\n",(0,n.jsx)(r.p,{children:"Armeria is an open-source asynchronous HTTP/2, RPC, REST client/server library based on Java 8, Netty, Thrift, and gRPC.\nWhile Armeria is a lightweight microservices framework, its capabilities is comparable to existing full stack web frameworks."}),"\n",(0,n.jsx)(r.p,{children:"Let's first take a look at some prerequisite knowledge for setting up a Reactive Streams server on Armeria."}),"\n",(0,n.jsx)(r.h3,{id:"supported-protocols",children:"Supported protocols"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(15284).A+"",width:"3030",height:"1468"})}),"\n",(0,n.jsxs)(r.p,{children:["Armeria supports both HTTP/1 and HTTP/2, and these protocols both support ",(0,n.jsx)(r.a,{href:"https://simple.wikipedia.org/wiki/Cleartext",children:"cleartext"})," and TLS (Transport Layer Security) cryptographic protocols.\nTo ensure compatibility between HTTP/1 and HTTP/2, Armeria supports both HTTP/2's connection preface and HTTP/1's upgrade request."]}),"\n",(0,n.jsx)(r.p,{children:"Furthermore, gRPC and Thrift works with both HTTP/1 and HTTP/2 on Armeria.\nThis is a unique feature of Armeria. gRPC normally doesn't support HTTP/1 and Thrift normally doesn't support HTTP/2.\nHowever, Armeria's wide array of support allows it to be used in a variety of business environments.\nIn Linux environments, Armeria supports JNI-based (Java Native Interface) socket IOs and BoringSSL-based TLS to allow better performance during production."}),"\n",(0,n.jsx)(r.p,{children:"Let's take a closer look at Armeria along with some sample code."}),"\n",(0,n.jsx)(r.h3,{id:"a-closer-look-at-armeria",children:"A closer look at Armeria"}),"\n",(0,n.jsx)(r.p,{children:'Armeria is a user-friendly API with simple and easy-to-use code.\nYou only need to write the following five lines if you want to run a "Hello world" server.'}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// Build your own server under 5 lines.\nvar server = Server.builder()\n       .http(8080)\n       .service(\u201c/\u201c, (ctx, req) -> HttpResponse.of(\u201cHello, World!\u201d))\n       .build();\n\nserver.start();\n"})}),"\n",(0,n.jsx)(r.p,{children:"The ability to easily run servers is a core feature for running separate business components on independent servers in a microservices environment."}),"\n",(0,n.jsxs)(r.p,{children:["Armeria also allows you to simplify server architecture.\nYou don't need to run ",(0,n.jsx)(r.a,{href:"https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar",children:"sidecar patterns"})," such as Nginx or static web servers such as Apache httpd to use HTTPS or HTTP/2.\nAs mentioned, Armeria supports JNI-based socket IOs and BoringSSL in Linux environments, making it relatively less prone to performance impact.\nYou can also ",(0,n.jsx)(r.a,{href:"https://line.github.io/armeria/docs/server-http-file",children:"serve static files"})," such as JS, CSS, or images."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"var server = Server.builder()\n       .http(8080)\n       .https(8443) // HTTPS support\n       .tlsSelfSigned()\n       .service(\u201c/\u201c, (ctx, req) -> HttpResponse.of(\u201cHello, World!\u201d))\n       .build();\nserver.start();\n"})}),"\n",(0,n.jsx)(r.p,{children:"You no longer need to add network hops with Armeria, allowing you to reduce points of failure, use resources more efficiently, simplify architecture, monitor activity, and dynamically expand your servers."}),"\n",(0,n.jsxs)(r.p,{children:["There's even more.\nArmeria comes with built-in annotation that lets you use its features even more easily.\nFor example, you can easily write routing code by setting ",(0,n.jsx)(r.code,{children:"hello"})," as a prefix, and ",(0,n.jsx)(r.code,{children:"name"})," as a path variable like the code below (For more information on using annotations, refer to ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/server-annotated-service",children:"official Armeria documentation"}),")."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"import com.linecorp.armeria.server.annotation.Get;\nimport com.linecorp.armeria.server.annotation.Param;\nimport com.linecorp.armeria.server.annotation.PathPrefix;\n\n// Use built-in annotations for mapping path and parameter injection\n@PathPrefix(\u201c/hello\u201d)\nclass HelloService {\n   @Get(\u201c/:name\u201d)\n   public String hello(@Param String name) {\n       return String.format(\u201cHello, %s!\u201d, name);\n   }\n}\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Armeria also comes with special features that allow you to serve multiple RPC protocols simultaneously.\nYou can provide REST API, gRPC, and Thrift on a single server, allowing you to flexibly adapt to any business requirements or architecture changes.\nThe single port design enables you to efficiently use resources, minimize unnecessary exposure, and reduce potential maintenance costs. ",(0,n.jsx)(r.a,{href:"#footnotes",children:"[1]"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"var server = Server.builder()\n   .http(8080)\n   .service(\u201c/hello/rest\u201d, (ctx, req) -> HttpResponse.of(\u201cHello, world!\u201d))\n   .service(\u201c/hello/thrift\u201d, THttpService.of(new ThriftHelloService()))\n   .service(\u201c/hello/grpc\u201d, GrpcService.builder()\n                                      .addService(new GrpcHelloService())\n                                      .build())\n   .build();\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Enterprise software developers would all agree that they've spent countless hours coming up with ways to efficiently process authentication and logging.\nWith Armeria, you can put those worries aside.\nYou can use a separate ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/server-decorator",children:"decorator"})," to manage this ",(0,n.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Separation_of_concerns",children:"separation of concerns"}),".",(0,n.jsx)(r.a,{href:"#footnotes",children:"[2]"})]}),"\n",(0,n.jsxs)(r.p,{children:["If you wish to add an additional decorator, you can always manually implement and bind one to a specific path or service.\nFor example, ",(0,n.jsx)(r.code,{children:"AuthService"}),"in the figure below only calls the service when a ",(0,n.jsx)(r.code,{children:"request"}),' includes authentication info, and returns a "401 unauthorized" error if not.']}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(20399).A+"",width:"3316",height:"1652"})}),"\n",(0,n.jsx)(r.p,{children:"Next, let's take a look at how Armeria works with Reactive Streams."}),"\n",(0,n.jsx)(r.h3,{id:"http2-streams-inside-armeria",children:"HTTP/2 streams inside Armeria"}),"\n",(0,n.jsxs)(r.p,{children:['As the name suggests, "streams" need to maintain a connection and let data constantly flow.\nIf there is only one opening while everywhere else is closed, it will lead to an overload.\nArmeria uses the back pressure feature of Reactive Streams to dynamically control data flow inside servers.\nAlso, back pressure that utilizes ',(0,n.jsx)(r.a,{href:"https://tools.ietf.org/html/rfc7540#section-5.2",children:"HTTP/2 stream flow control"})," using ",(0,n.jsx)(r.a,{href:"https://http2.github.io/http2-spec/#WINDOW_UPDATE",children:"WINDOW_UPDATE"})," allows you to dynamically connect the Armeria server with your services and repositories from subnetwork layers."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(55206).A+"",width:"3336",height:"1792"})}),"\n",(0,n.jsxs)(r.p,{children:["If converting your service's server to an Armeria Reactive server is difficult at the moment, you could use an Armeria Reactive proxy server by following the sample code and ",(0,n.jsx)(r.a,{href:"https://github.com/line/armeria-examples/tree/master/proxy-server",children:"instructions available on the repository"}),"."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// Use Armeria\u2019s async & reactive HTTP/2 client.\nvar client = HttpClient.of(\u201ch2c://backend\u201d);\nvar server = Server.builder()\n    .http(8080)          // Forward all requests reactively\n    .service(\u201cprefix:/\u201c, (ctx, req) -> client.execute(req))\n    .build();\n"})}),"\n",(0,n.jsx)(r.p,{children:"With an Armeria proxy server at the forefront, you can keep your server safe from any external threats on the internet."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(57625).A+"",width:"2310",height:"716"})}),"\n",(0,n.jsx)(r.h2,{id:"consolidating-reactive-streams-and-armeria",children:"Consolidating Reactive Streams and Armeria"}),"\n",(0,n.jsx)(r.p,{children:"If you create an Armeria server with direct support of Reactive Streams, even more features are available to you.\nLet's take a closer look at how you can use Reactive Streams on Armeria, and some details about the built-in publisher."}),"\n",(0,n.jsx)(r.h3,{id:"armeria-http-response-publisher",children:"Armeria HTTP response publisher"}),"\n",(0,n.jsxs)(r.p,{children:["Responses on Armeria are comprised of ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpHeaders.html",children:"HttpHeaders"})," and ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpData.html",children:"HttpData"}),".\nI will explain how you can convert an RxJava ",(0,n.jsx)(r.a,{href:"http://reactivex.io/RxJava/javadoc/io/reactivex/Observable.html",children:"Observable"})," to an Armeria ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpResponse.html",children:"HttpResponse"})," step-by-step."]}),"\n",(0,n.jsxs)(r.p,{children:["Once your data is ready, wrap ",(0,n.jsx)(r.code,{children:"dataStream"}),"with ",(0,n.jsx)(r.code,{children:"HttpData"})," using the ",(0,n.jsx)(r.code,{children:"Observable map"})," operator."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// 1. Fetch data from Reactive Streams Publisher\nObservable<String> dataStream = Observable.just(\u201ca\u201d, \u201cb\u201d, \u201cc\u201d, \u201cd\u201d, \u201ce\u201d);\n\n// 2. Convert string to Armeria HttpData\nObservable<HttpData> httpDataStream = dataStream.map(HttpData::ofUtf8);\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Once you have a confirmed response and a response header, combine it with the ",(0,n.jsx)(r.code,{children:"httpDataStream"})," prepared above using the ",(0,n.jsx)(r.code,{children:"concat"})," operator.\nThis will complete a connected stream from ",(0,n.jsx)(r.code,{children:"HttpHeaders"}),"to ",(0,n.jsx)(r.code,{children:"HttpData"}),"."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// 3. Prepare response headers\nResponseHeaders httpHeaders = ResponseHeaders.of(HttpStatus.OK);\n\n// 4. Concat http header and body stream\nObservable<HttpObject> responseStream = Observable.concat(Observable.just(httpHeaders), httpDataStream);\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Convert the completed stream to a Reactive Streams ",(0,n.jsx)(r.a,{href:"https://www.baeldung.com/rxjava-2-flowable",children:"Flowable"})," using the ",(0,n.jsx)(r.code,{children:"Observable"})," ",(0,n.jsx)(r.code,{children:"toFlowable"})," function, and wrap it with Armeria's ",(0,n.jsx)(r.code,{children:"HttpResponse"})," to complete the conversion."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// 5. Convert Observable to Armeria Response Stream\nHttpResponse response = HttpResponse.of(responseStream.toFlowable(BackpressureStrategy.BUFFER));\n"})}),"\n",(0,n.jsx)(r.h3,{id:"armerias-built-in-publisher",children:"Armeria's built-in publisher"}),"\n",(0,n.jsxs)(r.p,{children:["The steps above may seem too complicated or boring.\nThat's why Armeria provides a built-in publisher for ",(0,n.jsx)(r.a,{href:"https://tools.ietf.org/html/rfc7464",children:"JSON Text Sequences(RFC 7464)"}),", the standard way of sending stream data on the web, and ",(0,n.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Server-sent_events",children:"Server-sent events"}),", the HTML5 standard.\nThis publisher will allow you to send Reactive Streams on the web more easily."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// Fetch data from Reactive Streams Publisher\nPublisher<String> dataStream = Flux.just(\u201ca\u201d, \u201cb\u201d, \u201cc\u201d, \u201cd\u201d, \u201ce\u201d);\n\n// Convert Publisher to JSON Text Sequences with Armeria HttpResponse\n// with \u201capplication/json-seq\u201d MIME type\nHttpResponse httpResponse = JsonTextSequences.fromPublisher(dataStream);\n\n// Convert Publisher to Server-sent Events with Armeria HttpResponse\n// with \u201ctext/event-stream\u201d MIME type\nHttpResponse httpResponse = ServerSentEvents\n        .fromPublisher(dataStream, SeverSentEvent::ofData);\n"})}),"\n",(0,n.jsxs)(r.p,{children:["RxJava consolidation support is available for those looking to use the built-in publisher even more easily.\nAdd the ",(0,n.jsx)(r.code,{children:"@ProduceJsonSequence"})," annotation to the annotated service and return ",(0,n.jsx)(r.code,{children:"Observable"})," for automatic conversion on Armeria to the protocols mentioned above."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"import io.reactivex.Observable;\nimport com.linecorp.armeria.server.annotation.ProducesJsonSequences;\n\nclass RxJavaService {\n    @Get(\u201c/json-streaming\u201d)\n      // Generate JSON Text Sequences\n    @ProducesJsonSequences\n    public Observable<String> json() {\n          // Just return RxJava Observable!\n        return Observable.just(\u201ca\u201d, \u201cb\u201d, \u201cc\u201d);\n    }\n};\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Encoding a JSON text string with 'JsonTextSequences' will add a separator and line feed to the beginning and end respectively.\nDepending on the protocol, different operations are required when sending data through HTTP/1 or HTTP/2.\nArmeria automatically finds the appropriate format according to the currently connected protocol.\nJSON data is divided inside the ",(0,n.jsx)(r.a,{href:"https://http2.github.io/http2-spec/#DATA",children:"Data frame"})," for HTTP/2, and ",(0,n.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Chunked_transfer_encoding",children:"chunked transfer encoding"})," is used for HTTP/1."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(51376).A+"",width:"3278",height:"1818"})}),"\n",(0,n.jsx)(r.h2,{id:"migrating-spring-webflux",children:"Migrating Spring WebFlux"}),"\n",(0,n.jsxs)(r.p,{children:["Armeria supports various libraries and frameworks.\nIf you are already using ",(0,n.jsx)(r.a,{href:"https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html",children:"Spring WebFlux"})," to use Reactive Streams, you only need to ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/advanced-spring-webflux-integration",children:"add"}),(0,n.jsx)(r.code,{children:"armeria-spring-boot-webflux-starter"}),(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/advanced-spring-webflux-integration",children:"to your dependencies"})," to complete migration to Armeria.\nYou can replace ",(0,n.jsx)(r.a,{href:"https://github.com/reactor/reactor-netty",children:"Reactor-Netty"}),", a WebFlux network layer, with Armeria's Reactive engine with this way."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(87576).A+"",width:"3120",height:"1346"})}),"\n",(0,n.jsx)(r.p,{children:'You may be thinking to yourself "Shouldn\'t I just use WebFlux if I only want to replace the engine?" What advantages are there to going through the process above?'}),"\n",(0,n.jsxs)(r.p,{children:["You can add Armeria features to Spring with ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/spring/ArmeriaServerConfigurator.html",children:"ArmeriaServerConfigurator"})," if you replace your engine, allowing you to use unique Armeria features that aren't normally available on Spring.\nFor example, you can add gRPC and Thrift features to a REST API Spring WebFlux server, and serve it through the same single port."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"@Configuration\npublic class ArmeriaConfiguration {\n   // Configure the server by providing an ArmeriaServerConfigurator bean.\n   @Bean\n   public ArmeriaServerConfigurator armeriaServerConfigurator() {\n       // Customize the server using the given ServerBuilder. For example:\n       return builder -> {\n           // Add DocService that enables you to send gRPC and Thrift requests from web browser.\n           builder.serviceUnder(\u201c/docs\u201d, new DocService());\n           // Log every message which the server receives and responds.\n           builder.decorator(LoggingService.newDecorator());\n           // Write access log after completing a request.\n           builder.accessLogWriter(AccessLogWriter.combined(), false);\n           // You can also bind asynchronous RPC services such as Thrift and gRPC:\n           builder.service(THttpService.of(\u2026));\n           builder.service(GrpcService.builder()\u2026build());\n       };\n   }\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:"The decorator features mentioned above are also available, to make your service more feature-rich."}),"\n",(0,n.jsx)(r.h2,{id:"support-for-grpc-streams",children:"Support for gRPC streams"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"https://grpc.io/docs/tutorials/basic/java/#server-side-streaming-rpc",children:"gRPC supports streams"})," through ",(0,n.jsx)(r.a,{href:"https://grpc.github.io/grpc-java/javadoc/io/grpc/stub/StreamObserver.html",children:"StreamObserver"}),", and you can easily convert to gRPC's StreamObserver with Reactive Streams.\nLet's take a look at the example below."]}),"\n",(0,n.jsx)(r.p,{children:"First, decide how to send and receive data using protobuf, and define your interface."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"syntax = \u201cproto3\u201d;\npackage users;\noption java_package = \u201cusers\u201d;\n\nservice UserService {\n  // Returns all user information\n  rpc getAllUsers(UserRequest) returns (stream User) {}\n\n  // Push to stream of users\n  rpc pushToUsers(stream User) returns (Result) {}\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:"In order to send emails and push messages to all users, you must first look up the information of all users.\nIf there are too many users, it may be difficult to send the data at once.\nIn cases like this, you can build a stream server that returns large amounts of user information on gRPC by following the instructions below."}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["Use ProjectReactor's ",(0,n.jsx)(r.code,{children:"Flux"}),"as a publisher to look up data on the repository in the format of a stream."]}),"\n",(0,n.jsxs)(r.li,{children:["Convert to gRPC ",(0,n.jsx)(r.code,{children:"StreamObservser"})," and send the data to an external location."]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"// Implement interfaces generated by gRPC\npublic final class UserServiceImpl extends UserServiceImplBase {\n    @Override\n    public void getAllUsers(UserRequest request, StreamObserver<User> responseObserver) {\n        final Flux<User> userPublisher = userRepo.findAll();\n        publisher.subscribe(responseObserver::onNext,\n                            responseObserver::onError,\n                            responseObserver::onCompleted);\n    }\n}\n"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"StreamObserver"}),", like Reactive Streams, has ",(0,n.jsx)(r.code,{children:"onNext"}),", ",(0,n.jsx)(r.code,{children:"onError"}),", ",(0,n.jsx)(r.code,{children:"onCompleted"})," functions that can be matched and linked to APIs."]}),"\n",(0,n.jsxs)(r.p,{children:["This time let's think how you would receive the data containing all user information.\nFor this demonstration I will be using ",(0,n.jsx)(r.code,{children:"Processor"}),". ",(0,n.jsx)(r.code,{children:"Processor"})," doesn't have separate API, and simply inherits ",(0,n.jsx)(r.code,{children:"Subscriber"}),"and ",(0,n.jsx)(r.code,{children:"Publisher"}),".\nYou can use ",(0,n.jsx)(r.code,{children:"Processor"})," to easily subscribe to data, and publish the subscribed data easily.\nYou can send new user info that was received through ",(0,n.jsx)(r.code,{children:"StreamObserver's"})," ",(0,n.jsx)(r.code,{children:"onNext using Processor's onNext"})," function, and can further perform additional tasks by resubscribing."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"@Override\npublic StreamObserver<User> pushToUsers(StreamObserver<Result> responseObserver) {\n    Processor<User, User> processor = EmitterProcessor.create();\n    Publisher<User> publisher = processor;\n    Subscriber<User> subscriber = processor;\n    // Push one-by-one by subscribing publisher\n    ...\n\n      return new StreamObserver<User>() {\n        // subscribe user data \xe2\x80\xa8\n        @Override public void onNext(User user) { processor.onNext(user); }\n        @Override public void onError(Throwable throwable) { processor.onError(throwable); }\n        @Override public void onCompleted() {\n            responseObserver.onNext(Result.newBuilder().setStatus(200).build());\n            responseObserver.onCompleted();\n        }\n    };\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:"Let's run the gRPC code that we wrote on Armeria."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.grpc.GrpcService;\n\n// Add your grpc service to Armeria GrpcService\nvar grpcService = GrpcService.builder()\n                             .addService(new UserServiceImpl())\n                             .build();\n\nvar server = Server.builder()\n                   .http(8080)\n                   .serviceUnder(\u201c/grpc\u201d, grpcService)\n                   .serviceUnder(\u201c/docs\u201d, new DocService())\n                   .build();\n"})}),"\n",(0,n.jsx)(r.p,{children:"With a stream server like this, you can stream large amounts of data using only a small amount of memory."}),"\n",(0,n.jsx)(r.h2,{id:"armeria-features-for-microservices",children:"Armeria features for microservices"}),"\n",(0,n.jsx)(r.p,{children:"Using Reactive Streams through Armeria allows you to easily handle large amounts of data and traffic.\nRPC allows your microservices to communicate with each other more easily as well."}),"\n",(0,n.jsx)(r.p,{children:"In addition, here are some more features catered towards microservices:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Kubernetes-type DNS (Domain Name System) and ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/advanced-zookeeper",children:"service discovery with ZooKeeper"})," for easily locating servers in a cloud environment."]}),"\n",(0,n.jsx)(r.li,{children:"Client-side load-distribution for searched services during communication with the server. Fewer points of failure."}),"\n",(0,n.jsxs)(r.li,{children:["Direct server diagnosis with non-",(0,n.jsx)(r.a,{href:"https://www.nginx.com/resources/glossary/layer-7-load-balancing/",children:"L7"})," clients."]}),"\n",(0,n.jsx)(r.li,{children:"Automatic access logging to Kafka without the need to access distributed servers."}),"\n",(0,n.jsx)(r.li,{children:"Easy transfer of metrics to application monitoring tools such as Netflix's Atlas and Prometheus through Micrometer's filters."}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(74690).A+"",width:"3076",height:"1428"})}),"\n",(0,n.jsx)(r.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,n.jsx)(r.p,{children:"Through parts 1 and 2 of this blog post, we took a look at Reactive Streams and Armeria.\nArmeria allows you to build an asynchronous server that is safe, less prone to failure, and can harness the high performance of Reactive Streams, while also supporting RPC and HTTP/2."}),"\n",(0,n.jsxs)(r.p,{children:["The features mentioned in this blog post aren't everything there is to Armeria.\nFor more information on what Armeria can do for you, refer to the ",(0,n.jsx)(r.a,{href:"https://armeria.dev/",children:"official website"})," and the following sources."]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["GitHub: ",(0,n.jsx)(r.a,{href:"https://github.com/line/armeria",children:"line/armeria"})]}),"\n",(0,n.jsxs)(r.li,{children:["Twitter: ",(0,n.jsx)(r.a,{href:"https://twitter.com/armeria_project",children:"@armeria_project"})]}),"\n",(0,n.jsxs)(r.li,{children:["Chat: ",(0,n.jsx)(r.a,{href:"https://armeria.dev/s/discord",children:"Discord"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html",children:"API documentation"}),", ",(0,n.jsx)(r.a,{href:"https://armeria.dev/release-notes/",children:"release notes"})]}),"\n",(0,n.jsxs)(r.li,{children:["Armeria examples: ",(0,n.jsx)(r.a,{href:"https://github.com/line/armeria-examples",children:"line/armeria-examples"})]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h4,{id:"footnotes",children:"Footnotes"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["Refer to ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/server-grpc",children:"Running a gRPC service"})," and ",(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/server-thrift",children:"Running a Thrift service"}),"."]}),"\n",(0,n.jsxs)(r.li,{children:["For more information on the various decorators provided with Armeria, refer to the Armeria and Javadoc official documentation.","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/server-decorator",children:"Decorating a service"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://armeria.dev/docs/client-decorator",children:"Decorating a client"})}),"\n",(0,n.jsxs)(r.li,{children:["Check Direct Known Subsclasses on ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/SimpleDecoratingHttpService.html",children:"SimpleDecoratingHttpService"})," and ",(0,n.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/SimpleDecoratingClient.html",children:"SimpleDecoratingClient"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},51376:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-5-b047c88a956d6aea2e8163ea08fd3590.png"},55206:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-3-19c9d7f507f0cc7efb072673431792ff.png"},57625:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-4-d1176606f39d7cc2951b0a21a74b80c6.png"},74690:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-7-da8c2428f8f86f6212efef177ca57d88.png"},87576:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/reactive-streams-armeria-2-6-0408b3405e56818eebd1d7b8471bbc75.png"}}]);