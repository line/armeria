"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[2872],{28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>c});var a=t(96540);const n={},i=a.createContext(n);function o(e){const r=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),a.createElement(i.Provider,{value:r},e.children)}},36812:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"server/servlet","title":"Embedding a servlet container","description":"You can make Armeria serve your JEE web application on the same JVM and TCP/IP port by embedding","source":"@site/src/content/docs/server/servlet.mdx","sourceDirName":"server","slug":"/server/servlet","permalink":"/docs/server/servlet","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/server/servlet.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Serving static files","permalink":"/docs/server/http-file"},"next":{"title":"Writing an access log","permalink":"/docs/server/access-log"}}');var n=t(74848),i=t(28453);const o={},c="Embedding a servlet container",s={},d=[{value:"Embedding Apache Tomcat",id:"embedding-apache-tomcat",level:2},{value:"Embedding Jetty",id:"embedding-jetty",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{RequiredDependencies:t}=r;return t||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("RequiredDependencies",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"embedding-a-servlet-container",children:"Embedding a servlet container"})}),"\n",(0,n.jsxs)(r.p,{children:["You can make Armeria serve your JEE web application on the same JVM and TCP/IP port by embedding\n",(0,n.jsx)(r.a,{href:"https://tomcat.apache.org/",children:"Apache Tomcat"})," or ",(0,n.jsx)(r.a,{href:"https://www.eclipse.org/jetty/",children:"Jetty"}),".\nNeither Tomcat nor Jetty will open a server socket or accept an incoming connection.\nAll HTTP requests and responses go through Armeria. As a result, you get the following bonuses:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Your webapp gets HTTP/2 support for free even if your servlet container does not support it."}),"\n",(0,n.jsx)(r.li,{children:"You can run your RPC services on the same JVM and port as your webapp with no performance loss."}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"embedding-apache-tomcat",children:"Embedding Apache Tomcat"}),"\n",(0,n.jsxs)(r.p,{children:["You need the ",(0,n.jsx)(r.code,{children:"armeria-tomcat9"})," dependency:"]}),"\n",(0,n.jsx)(t,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-tomcat9"}]}),"\n",(0,n.jsxs)(r.p,{children:["Then, add a ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/tomcat/TomcatService.html",children:"TomcatService"})," to a ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerBuilder.html",children:"ServerBuilder"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.tomcat.TomcatService;\n\nServerBuilder sb = Server.builder();\n\nsb.serviceUnder("/tomcat/api/rest/v2/",\n                TomcatService.forCurrentClassPath("/webapp"));\n\nsb.serviceUnder("/tomcat/api/rest/v1/",\n                TomcatService.forFileSystem("/var/lib/webapps/old_api.war"));\n'})}),"\n",(0,n.jsxs)(r.p,{children:["For more information, please refer to the API documentation of ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/tomcat/TomcatService.html",children:"TomcatService"})," and\n",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/tomcat/TomcatServiceBuilder.html",children:"TomcatServiceBuilder"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"embedding-jetty",children:"Embedding Jetty"}),"\n",(0,n.jsxs)(r.p,{children:["You need ",(0,n.jsx)(r.code,{children:"armeria-jetty9"}),", additional ",(0,n.jsx)(r.code,{children:"jetty"})," dependencies and bootstrap code due to its modular design:"]}),"\n",(0,n.jsx)(t,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"},{groupId:"org.eclipse.jetty",artifactId:"jetty-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-jetty9"},{groupId:"org.eclipse.jetty",artifactId:"jetty-webapp"},{groupId:"org.eclipse.jetty",artifactId:"jetty-annotations"},{groupId:"org.eclipse.jetty",artifactId:"apache-jsp"},{groupId:"org.eclipse.jetty",artifactId:"apache-jstl"}]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.jetty.JettyService;\nimport org.eclipse.jetty.annotations.ServletContainerInitializersStarter;\nimport org.eclipse.jetty.apache.jsp.JettyJasperInitializer\nimport org.eclipse.jetty.plus.annotation.ContainerInitializer\nimport org.eclipse.jetty.util.resource.Resource;\nimport org.eclipse.jetty.webapp.WebAppContext;\n\nServerBuilder sb = Server.builder();\n\nsb.serviceUnder("/jetty/api/rest/v2/",\n                JettyService.builder()\n                            .handler(newWebAppContext("/webapp"))\n                            .build());\n\nstatic WebAppContext newWebAppContext(String resourcePath) throws MalformedURLException {\n    final WebAppContext handler = new WebAppContext();\n    handler.setContextPath("/");\n    handler.setBaseResource(Resource.newClassPathResource(resourcePath));\n    handler.setClassLoader(/* Specify your class loader here. */);\n    handler.addBean(new ServletContainerInitializersStarter(handler), true);\n    handler.setAttribute(\n            "org.eclipse.jetty.containerInitializers",\n            Collections.singletonList(\n                    new ContainerInitializer(new JettyJasperInitializer(), null)));\n    return handler;\n}\n'})}),"\n",(0,n.jsxs)(r.p,{children:["For more information, please refer to the API documentation of ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/jetty/JettyService.html",children:"JettyService"})," and\n",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/jetty/JettyServiceBuilder.html",children:"JettyServiceBuilder"}),"."]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);