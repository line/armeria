"use strict";(self.webpackChunkarmeria_site=self.webpackChunkarmeria_site||[]).push([[6543],{32675:function(e,t,r){r.r(t),r.d(t,{_frontmatter:function(){return s},default:function(){return v},pageTitle:function(){return c}});var n=r(63366),a=(r(67294),r(64983)),o=r(28819),i=(r(75609),["components"]),c="Kotlin integration",s={},l=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",t)}},p=l("Tip"),u=l("RequiredDependencies"),d={pageTitle:c,_frontmatter:s},m=o.Z;function v(e){var t=e.components,r=(0,n.Z)(e,i);return(0,a.kt)(m,Object.assign({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"kotlin-integration",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h1",href:"#kotlin-integration","aria-label":"kotlin integration permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Kotlin integration"),(0,a.kt)("h6",{className:"inlinePageToc",role:"navigation"},"Table of contents"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"#coroutines-support-for-annotated-services"},"Coroutines support for annotated services")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#coroutine-context-and-dispatcher"},"Coroutine context and dispatcher")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#coroutine-dispatcher"},"Coroutine dispatcher")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#customizing-coroutinecontext-for-annotated-services"},"Customizing CoroutineContext for annotated services")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"#coroutines-support-for-typerestclient"},"Coroutines support for type://RestClient"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"#coroutines-support-for-grpc-kotlin"},"Coroutines support for gRPC-Kotlin")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#running-a-grpc-kotlin-service"},"Running a gRPC-Kotlin service")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#calling-a-grpc-kotlin-service"},"Calling a gRPC-Kotlin service")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#customizing-coroutinecontext-for-grpc-kotlin-services"},"Customizing CoroutineContext for gRPC-Kotlin services"))))),(0,a.kt)("h2",{id:"coroutines-support-for-annotated-services",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h2",href:"#coroutines-support-for-annotated-services","aria-label":"coroutines support for annotated services permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Coroutines support for annotated services"),(0,a.kt)(p,{mdxType:"Tip"},(0,a.kt)("p",null,"Visit ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/line/armeria/tree/main/examples/annotated-http-service-kotlin"},"annotated-http-service-kotlin")," to check out a fully working example.")),(0,a.kt)("p",null,"You can implement annotated services with ",(0,a.kt)("a",{parentName:"p",href:"https://kotlinlang.org/docs/reference/coroutines-overview.html"},"Kotlin coroutines"),"\nby adding the following dependency:"),(0,a.kt)(u,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-kotlin"}],mdxType:"RequiredDependencies"}),(0,a.kt)("p",null,"Then, define the suspending function:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyAnnotatedService {\n    @Get("/users/{name}")\n    suspend fun getUserToken(@Param("name") name: String): String {\n        val user = myReactiveRepository.findByName(name).await()\n        return user.token\n    }\n}\n')),(0,a.kt)("p",null,"Note that you can omit the value of ",(0,a.kt)("a",{parentName:"p",href:"type://@Param:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html"},"type://@Param")," if you compiled your Kotlin code with ",(0,a.kt)("a",{parentName:"p",href:"https://kotlinlang.org/docs/reference/compiler-reference.html#-java-parameters"},(0,a.kt)("inlineCode",{parentName:"a"},"java-parameters"))," option."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyAnnotatedService {\n    @Get("/users/{name}")\n    suspend fun getUserToken(@Param name: String): String { ... }\n}\n')),(0,a.kt)("p",null,"Data classes are also supported for JSON requests and responses:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'data class User(val name: String, val token: String)\ndata class Result(val status: Int, val message: String)\n\nclass MyRestService {\n\n    @ConsumesJson\n    @ProducesJson\n    @Post("/users")\n    suspend fun createUser(user: User): Result {\n        return myReactiveRepository.save(user).await()\n    }\n}\n')),(0,a.kt)("h3",{id:"coroutine-context-and-dispatcher",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#coroutine-context-and-dispatcher","aria-label":"coroutine context and dispatcher permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Coroutine context and dispatcher"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html"},"type://ServiceRequestContext")," is injected to the default ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext")," of a ",(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," function,\nso you can access ",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html"},"type://ServiceRequestContext")," from a ",(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," function with ",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext.current()/"},"type://ServiceRequestContext.current()/"),"\nand the context is inherits to child contexts."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"class MyContextAwareService {\n    suspend fun contextPropagation(@Param name: String): String {\n        // Make sure that current thread is request context aware\n        assert(ServiceRequestContext.current() != null)\n\n        return withContext(myDispatcher) {\n            // Make sure that the ServiceRequestContext is propagated to other CoroutineContext which is needed \n            // for logging, tracing.\n            assert(ServiceRequestContext.current() != null)\n            ...\n        }\n    }\n}\n")),(0,a.kt)("h3",{id:"coroutine-dispatcher",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#coroutine-dispatcher","aria-label":"coroutine dispatcher permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Coroutine dispatcher"),(0,a.kt)("p",null,"By default, Armeria uses a context-aware event loop as a\n",(0,a.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/"},"coroutine dispatcher")," to run ",(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," functions.\nA context-aware blocking executor is used as a dispatcher if you annotate a service method with\n",(0,a.kt)("a",{parentName:"p",href:"type://@Blocking:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Blocking.html"},"type://@Blocking")," or enable ",(0,a.kt)("a",{parentName:"p",href:"type://AnnotatedServiceBindingBuilder#useBlockingTaskExecutor(boolean):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/AnnotatedServiceBindingBuilder.html#useBlockingTaskExecutor(boolean)"},"type://AnnotatedServiceBindingBuilder#useBlockingTaskExecutor(boolean)"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'serverBuilder\n    .annotatedService()\n    // Enable `useBlockingTaskExecutor`.\n    .useBlockingTaskExecutor(true)\n    .build(MyAnnotatedService())\n\n// or use @Blocking annotation:\n\nimport com.linecorp.armeria.server.annotation.Blocking\n\nclass MyAnnotatedService {\n    @Blocking\n    @Get("/blocking/users/{name}")\n    suspend fun getUserTokenBlocking(@Param("name") name: String): String {\n        val id = myReactiveClient.getId(name).await()\n        val user = myBlockingRepository.findById(id)\n        return user.token\n    }\n}\n')),(0,a.kt)(p,{mdxType:"Tip"},(0,a.kt)("p",null,"If you use ",(0,a.kt)("a",{parentName:"p",href:"/docs/advanced-logging"},"Logback integration")," or ",(0,a.kt)("a",{parentName:"p",href:"/docs/advanced-zipkin"},"Zipkin integration"),",\ncoroutines should be executed in a thread that is aware of ",(0,a.kt)("a",{parentName:"p",href:"type://RequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/RequestContext.html"},"type://RequestContext"),".")),(0,a.kt)("h3",{id:"customizing-coroutinecontext-for-annotated-services",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#customizing-coroutinecontext-for-annotated-services","aria-label":"customizing coroutinecontext for annotated services permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Customizing ",(0,a.kt)("inlineCode",{parentName:"h3"},"CoroutineContext")," for annotated services"),(0,a.kt)("p",null,"Armeria provides a way to configure a coroutine context of annotated service methods\nusing ",(0,a.kt)("a",{parentName:"p",href:"type://CoroutineContextService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/kotlin/CoroutineContextService.html"},"type://CoroutineContextService")," decorator."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'import com.linecorp.armeria.server.kotlin.CoroutineContextService\n\nserverBuilder\n    .annotatedService()\n    .decorator(CoroutineContextService.newDecorator { ctx ->\n        CoroutineName(ctx.config().defaultServiceNaming().serviceName(ctx) ?: "name")\n    })\n    .build(MyAnnotatedService())\n')),(0,a.kt)("h2",{id:"coroutines-support-for-typerestclient",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h2",href:"#coroutines-support-for-typerestclient","aria-label":"coroutines support for typerestclient permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Coroutines support for ",(0,a.kt)("a",{parentName:"h2",href:"type://RestClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RestClient.html"},"type://RestClient")),(0,a.kt)("p",null,"Armeria provides extension methods to convert ",(0,a.kt)("a",{parentName:"p",href:"type://RestClientPreparation#execute(Class):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RestClientPreparation.html#execute(java.lang.Class)"},"type://RestClientPreparation#execute(Class)")," to a ",(0,a.kt)("inlineCode",{parentName:"p"},"suspend")," function."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'val client = RestClient.of("https://armeria.dev")\n// In a coroutine scope.\nval response: ResponseEntity<RestResponse> =\n   client.get("/api/v1/users/{id}")\n         .pathParam("id", "Armeria")\n         .header(HttpHeaderNames.AUTHORIZATION, "...")\n         // The suspend function executes the request and\n         // returns the response.\n         .execute<RestResponse>()\n')),(0,a.kt)("h2",{id:"coroutines-support-for-grpc-kotlin",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h2",href:"#coroutines-support-for-grpc-kotlin","aria-label":"coroutines support for grpc kotlin permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Coroutines support for ",(0,a.kt)("a",{parentName:"h2",href:"https://github.com/grpc/grpc-kotlin"},"gRPC-Kotlin")),(0,a.kt)(p,{mdxType:"Tip"},(0,a.kt)("p",null,"Visit ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/line/armeria/tree/main/examples/grpc-kotlin"},"grpc-kotlin")," to check out a fully working example.")),(0,a.kt)("p",null,"To use gRPC-Kotlin with Armeria, add the following dependency:"),(0,a.kt)(u,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-grpc-kotlin"}],mdxType:"RequiredDependencies"}),(0,a.kt)("h3",{id:"running-a-grpc-kotlin-service",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#running-a-grpc-kotlin-service","aria-label":"running a grpc kotlin service permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Running a gRPC-Kotlin service"),(0,a.kt)("p",null,"gRPC-kotlin support is enabled automatically by registering coroutine stub services in\n",(0,a.kt)("a",{parentName:"p",href:"/docs/server-grpc"},"the same way")," as using gRPC-Java."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'import com.linecorp.armeria.server.Server\nimport com.linecorp.armeria.server.docs.DocService\nimport com.linecorp.armeria.server.grpc.GrpcService\n\nclass YourServiceImpl : YourServiceGrpcKt.YourServiceCoroutineImplBase() {\n  ...\n}\n\n// Creates GrpcService with your gRPC stub generated by gRPC-Kotlin.\nval grpcService =\n  GrpcService\n    .builder()\n    // Add your gRPC-Kotlin stub to GrpcService\n    .addService(YourServiceImpl())\n    .enableUnframedRequests(true)\n    .build()\n\n// Creates Armeria Server for gRPC-Kotlin stub.\nServer\n  .builder()\n  .http(httpPort)\n  .https(httpsPort)\n  .service(grpcService)\n  // Add DocService for browsing the list of gRPC services and \n  // invoking a service operation from a web form.\n  // See https://armeria.dev/docs/server-docservice for more information.\n  .serviceUnder("/docs", DocService())\n  .build()\n')),(0,a.kt)("h3",{id:"calling-a-grpc-kotlin-service",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#calling-a-grpc-kotlin-service","aria-label":"calling a grpc kotlin service permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Calling a gRPC-Kotlin service"),(0,a.kt)("p",null,"You can use ",(0,a.kt)("a",{parentName:"p",href:"type://GrpcClients:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/grpc/GrpcClients.html"},"type://GrpcClients")," to specify a coroutine stub that ends with ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineStub")," when creating a\ngRPC-Kotlin client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'val client =\n  GrpcClients\n    .builder("https://grpc.service.com")\n    .intercept(yourInterceptors)\n    .build(YourServiceGrpcKt.YourServiceCoroutineStub::class.java)\n')),(0,a.kt)(p,{mdxType:"Tip"},(0,a.kt)("p",null,"Please refer to ",(0,a.kt)("a",{parentName:"p",href:"/docs/client-grpc"},"Calling a gRPC service")," for more information on gRPC clients.")),(0,a.kt)("h3",{id:"customizing-coroutinecontext-for-grpc-kotlin-services",style:{position:"relative"}},(0,a.kt)("a",{parentName:"h3",href:"#customizing-coroutinecontext-for-grpc-kotlin-services","aria-label":"customizing coroutinecontext for grpc kotlin services permalink",className:"anchor before"},(0,a.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Customizing ",(0,a.kt)("inlineCode",{parentName:"h3"},"CoroutineContext")," for gRPC-Kotlin services"),(0,a.kt)("p",null,"When you use gRPC-Kotlin's suspend functions, the default ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext")," is the combination of\n",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html"},"type://ServiceRequestContext")," and an event loop ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineDispatcher"),". You can access\n",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html"},"type://ServiceRequestContext")," from the suspend functions with ",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext#current():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html#current()"},"type://ServiceRequestContext#current()"),",\nsimilar to how you access it in annotated services."),(0,a.kt)("p",null,"With Armeria's integration with gRPC-Kotlin, it's easy to set up a custom ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext")," for your\ngRPC-Kotlin service. You can create your own ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext")," using ",(0,a.kt)("a",{parentName:"p",href:"type://CoroutineContextProvider:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/kotlin/CoroutineContextProvider.html"},"type://CoroutineContextProvider"),", and\nadd it to your service through Java SPI."),(0,a.kt)("p",null,"Note that the ",(0,a.kt)("a",{parentName:"p",href:"type://ServiceRequestContext:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServiceRequestContext.html"},"type://ServiceRequestContext")," is still a part of the\n",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext"),", but the event loop ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineDispatcher")," is disabled if the custom ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContext"),"\nis used."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"class CustomCoroutineContextProvider : CoroutineContextProvider {\n    override fun provide(ctx: ServiceRequestContext): CoroutineContext {\n      return ... // A custom CoroutineContext\n    }\n}\n")),(0,a.kt)(p,{mdxType:"Tip"},(0,a.kt)("p",null,"A custom ",(0,a.kt)("inlineCode",{parentName:"p"},"CoroutineContextProvider")," should be registered via Java SPI in\n",(0,a.kt)("inlineCode",{parentName:"p"},"META-INF/services/com.linecorp.armeria.common.kotlin.CoroutineContextProvider"),".")))}v.isMDXComponent=!0},28819:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(25444),a=r(67294),o=JSON.parse('{"root":["index","setup"],"Useful links":{"Tutorials":"/tutorials","Community articles":"/community/articles","API documentation":"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html","Release notes":"/release-notes"},"Server":["server-basics","server-decorator","server-grpc","server-thrift","server-graphql","server-docservice","server-annotated-service","server-http-file","server-servlet","server-access-log","server-cors","server-sse","server-service-registration","server-multipart","server-timeouts"],"Client":["client-http","client-thrift","client-grpc","client-factory","client-decorator","client-retrofit","client-custom-http-headers","client-timeouts","client-retry","client-circuit-breaker","client-service-discovery"],"Advanced":["advanced-logging","advanced-structured-logging","advanced-custom-attributes","advanced-streaming-backpressure","advanced-structured-logging-kafka","advanced-metrics","advanced-unit-testing","advanced-production-checklist","advanced-saml","advanced-spring-boot-integration","advanced-spring-webflux-integration","advanced-dropwizard-integration","advanced-kotlin","advanced-scala","advanced-scalapb","advanced-flags-provider","advanced-zipkin","advanced-client-interoperability"]}'),i=r(46731),c=function(e){var t=(0,n.useStaticQuery)("1217743243").allMdx.nodes;return a.createElement(i.Z,Object.assign({},e,{candidateMdxNodes:t,index:o,prefix:"docs",pageTitleSuffix:"Armeria documentation"}))}}}]);
//# sourceMappingURL=component---src-pages-docs-advanced-kotlin-mdx-c968d50b5a9a47c68f13.js.map