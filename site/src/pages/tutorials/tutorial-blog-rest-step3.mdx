---
menuTitle: "Implement CREATE"
order: 3
type: step
tags:
  - rest
  - request
  - request-converter
level: basic
---

# Implementing CREATE operation

In this step, you'll write a service method for creating a blog post. By completing this step, you'll learn to map your service with the HTTP POST (<type://@Post>) method and make your own request converter (<type://@RequestConverter>).

<TutorialSteps current={3} />

## What you need

You must have the following files ready to try creating a blog post. You can always [download](https://github.com/line/armeria-examples/blob/master/tutorials/rest-api-annotated-service/src/main/java/example/armeria/server/blog/) the full version, instead of creating one yourself.

- Main.java: See [Step 1. Create a server](/tutorials/tutorial-blog-rest-step1)
- BlogPost.java: See [Step 2. Prepare a data object](/tutorials/tutorial-blog-rest-step2)

## 0. Create a service file

Create a service file, BlogService.java, if you don't have it. You can see the full version of the file [here](https://github.com/line/armeria-examples/blob/master/tutorials/rest-api-annotated-service/src/main/java/example/armeria/server/blog/BlogService.java).

```java filename=BlogService.java
package example.armeria.server.blog;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public final class BlogService {
  private Map<Integer, BlogPost> blogPosts = new ConcurrentHashMap<>();
}
```

## 1. Map HTTP method

Let's start [mapping the HTTP POST method](/docs/server-annotated-service#mapping-http-service-methods) with our service method:

1. Declare a service method, `createBlogPost()`, in the class `BlogService`.
2. Map this service method with the HTTP POST method by adding the <type://@Post> annotation.
3. Bind the endpoint `/blogs` to the method.

```java filename=BlogService.java highlight=7
import com.fasterxml.jackson.core.JsonProcessingException;
import com.linecorp.armeria.server.annotation.*;

public final class BlogService {
  ...

  @Post("/blogs")
  public void createBlogPost(BlogPost blogPost)
      throws JsonProcessingException {}
}
```

## 2. Handle parameters

Let's receive blog post information through a request body. Armeria's [request converter](/docs/server-annotated-service#converting-an-http-request-to-a-java-object) converts request parameters in HTTP messages into Java objects for you. In the request converter we define what keys of a JSON object to map with what properties of a Java object.

Let's first [write a request converter](#write-a-request-converter) and then [register the request converter](#register-a-request-converter) to the service method.

### Write a request converter

Armeria's [request converter](/docs/server-annotated-service#converting-an-http-request-to-a-java-object) converts a request body from a client into a Java object for you.

We can use Armeria's default request converter as is, but here let's give a go at customizing a request converter for our blog post requests. We want to convert blog post details into a Java object.

1. Create a BlogPostRequestConverter.java file and declare a class, implementing the <type://RequestConverterFunction> interface. For the sake of simplicity, generate impromptu IDs for this tutorial.

  ```java filename=BlogRequestConverter.java
  package example.armeria.server.blog;

  import com.fasterxml.jackson.databind.ObjectMapper;
  import com.linecorp.armeria.server.annotation.RequestConverterFunction;
  import java.util.concurrent.atomic.AtomicInteger;

  final class BlogPostRequestConverter implements RequestConverterFunction {
    private static final ObjectMapper mapper = new ObjectMapper();
    private AtomicInteger idGenerator = new AtomicInteger(); // Blog post ID
  }
  ```

2. Add a method retrieving a value of a given key in a JSON object:

  ```java filename=BlogRequestConverter.java highlight=6-12
  import com.fasterxml.jackson.databind.JsonNode;

  final class BlogPostRequestConverter implements RequestConverterFunction {
    ...

    static String stringValue(JsonNode jsonNode, String field) {
      JsonNode value = jsonNode.get(field);
      if (value == null) {
        throw new IllegalArgumentException(field + " is missing!");
      }
      return value.textValue();
    }
  }
  ```

3. Customize the default `convertRequest()` method as follows.

  ```java filename=BlogRequestConverter.java highlight=10-22
  import com.linecorp.armeria.server.ServiceRequestContext;
  import com.linecorp.armeria.common.AggregatedHttpRequest;
  import javax.annotation.Nullable;
  import java.lang.reflect.ParameterizedType;

  final class BlogPostRequestConverter implements RequestConverterFunction {
    ...
    @Override

    public Object convertRequest(ServiceRequestContext ctx,
      AggregatedHttpRequest request, Class<?> expectedResultType,
      @Nullable ParameterizedType expectedParameterizedResultType)
        throws Exception {
      if (expectedResultType == BlogPost.class) {
        JsonNode jsonNode = mapper.readTree(request.contentUtf8());
        int id = idGenerator.getAndIncrement();
        String title = stringValue(jsonNode, "title");
        String content = stringValue(jsonNode, "content");
        return new BlogPost(id, title, content); // Create an instance of BlogPost object
      }
      return RequestConverterFunction.fallthrough();
    }
    ...
  }
  ```

### Register a request converter

In this step, assign the [request converter we customized](#write-a-request-converter) to our service method. Annotate the service method with <type://@RequestConverter> and specify the <type://RequestConverterFunction> class as `BlogPostRequestConverter.class`.

```java filename=BlogService.java highlight=2
@Post("/blogs")
@RequestConverter(BlogPostRequestConverter.class)
public void createBlogPost(BlogPost blogPost)
    throws JsonProcessingException {
  // Implement blog service
}
```

## 3. Implement service code

When the request for creation is received, our request converter creates an instance of a blog post object for us. We want to save the blog post object in the map (`blogPosts`) created in the `BlogService` class.

Let's store the blog post information in the map by adding line 5, in the `createBlogPost()` method.

```java filename=BlogService.java highlight=5 showlineno=true
@Post("/blogs")
@RequestConverter(BlogPostRequestConverter.class)
public void createBlogPost(BlogPost blogPost)
    throws JsonProcessingException {
  blogPosts.put(blogPost.getId(), blogPost);
}
```

## 4. Return response

Now, it's time to return a response to our client. As the response, on top of the information received, add the ID of the post, created time, plus the modified time which would be identical to the created time.

Let's return a response for blog post creation:

1. Replace the return type of the `createBlogPost()` method from `void` to `HttpResponse`.
2. Create and return an HTTP response using Armeria's <type://HttpResponse> with the information of the post created.

  ```java filename=BlogService.java highlight=4,7
  import com.linecorp.armeria.common.HttpResponse;
  import com.linecorp.armeria.common.HttpStatus;

  public HttpResponse createBlogPost(BlogPost blogPost)
      throws JsonProcessingException {
    ...
    return HttpResponse.ofJson(blogPost);
  }
  ```

## 5. Test creating a blog post

1. Add our blog service to the server, by removing the dummy service we added in [Step 1. Create a server](/tutorials/tutorial-blog-rest-step1#1-create-a-server-instance) and adding line 6.

  ```java filename="Main.java" highlight=6 showlineno=true
  public final class Main {
    ...
    static Server newServer(int port) {
      ServerBuilder sb = Server.builder();
      return sb.http(port)
               .annotatedService(new BlogService())
               .build();
  }
  ...
  ```

2. Run the server like we did in [Step 1. Create a server](/tutorials/tutorial-blog-rest-step1) by running the `main()` method or using Gradle.
When you see the message, "Server has been started", you can try testing service methods.
3. Call the service method for creating a blog post. Here, we'll use the cURL command.

  ```bash
  $ curl --location --request POST 'localhost:8080/blogs' \
  -H 'Content-Type: application/json' \
  -d '{"title":"My first blog", "content":"Hello Armeria!"}'
  ```

4. Check the return value.

  ```bash
  {"id":0,"title":"My first blog","content":"Hello Armeria!","createdAt":1624489646371,"modifiedAt":1624489646371}
  ```

You can test this also with Armeria's [Documentation service](/docs/server-docservice), which we'll cover at [Step 7. Add services to server](/tutorials/tutorial-blog-rest-step7).

## Next step

In this step, you've written a method to implement a CREATE operation and used Armeria's annotations; <type://@Post> and <type://@RequestConverter>.

Next, at [Step 4. Implement READ](/tutorials/tutorial-blog-rest-step4), you'll implement a READ operation to read a single post and multiple posts.

<TutorialSteps current={3} />
