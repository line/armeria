version: '{branch}.{build}'
environment:
  GRADLE_CLI_OPTS: '--no-daemon --console=verbose --stacktrace'
  matrix:
    - PROFILE: 'java8'
      APPVEYOR_BUILD_WORKER_IMAGE: 'bionic'
      APPVEYOR_BUILD_WORKER_CLOUD: 'verda'
    - PROFILE: 'java11'
      APPVEYOR_BUILD_WORKER_IMAGE: 'bionic'
      APPVEYOR_BUILD_WORKER_CLOUD: 'verda'
    - PROFILE: 'java13'
      APPVEYOR_BUILD_WORKER_IMAGE: 'bionic'
      APPVEYOR_BUILD_WORKER_CLOUD: 'verda'
    - PROFILE: 'windows'
      APPVEYOR_BUILD_WORKER_IMAGE: 'Visual Studio 2019'
      JAVA_HOME: 'C:\Program Files\Java\jdk12'

matrix:
  fast_finish: false

init:
  - cmd: 'git config --global core.autocrlf true'
  - sh: 'git config --global core.autocrlf input'

build_script:
  - cmd: 'gradlew.bat --version'
  - cmd: 'gradlew.bat %GRADLE_CLI_OPTS% checkstyle check build'
  - sh: './.appveyor.sh "$PROFILE"'

test: off

on_finish:
  # Upload the JUnit test results.
  # See: https://github.com/appveyor/ci/issues/92#issuecomment-307242316
  - ps: |
      $wc = New-Object 'System.Net.WebClient'
      Get-ChildItem . -Name -Recurse 'TEST-*.xml'  |
      Foreach-Object {
          $wc.UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path $_))
      }

cache:
  - "%USERPROFILE%\\AppData\\Local\\Yarn\\cache"
  - "%USERPROFILE%\\.gradle\\wrapper\\dists"
  - "%USERPROFILE%\\.gradle\\caches\\jars-3"
  - "%USERPROFILE%\\.gradle\\caches\\modules-2"
  - "%USERPROFILE%\\.gradle\\caches\\package-lists"
  - "%USERPROFILE%\\.gradle\\caches\\sphinx-binary"

notifications:
  - provider: Slack
    incoming_webhook:
      secure: uDUySAYLk8RjAL6ZAWd9K/hP9rV1/yYPz26CybZOPFZB7Le4v7/x2byv3HkwEJtxAYFi0RjeVJG4UF9oZfyqfbnyOW4vGZ3KYUJBT1EidEE=
