"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[4266],{28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>l});var n=s(96540);const o={},r=n.createContext(o);function i(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(r.Provider,{value:t},e.children)}},75465:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"tutorials/grpc/implement-read","title":"Implementing READ operation","description":"In the earlier step, we created blog posts.","source":"@site/src/content/docs/tutorials/grpc/04-implement-read.mdx","sourceDirName":"tutorials/grpc","slug":"/tutorials/grpc/implement-read","permalink":"/docs/tutorials/grpc/implement-read","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/tutorials/grpc/04-implement-read.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_label":"4. Implement READ","type":"step","category":"grpc","tags":["server"],"level":"basic"},"sidebar":"docsSidebar","previous":{"title":"3. Implement CREATE","permalink":"/docs/tutorials/grpc/implement-create"},"next":{"title":"5. Implement UPDATE","permalink":"/docs/tutorials/grpc/implement-update"}}');var o=s(74848),r=s(28453);const i={sidebar_label:"4. Implement READ",type:"step",category:"grpc",tags:["server"],level:"basic"},l="Implementing READ operation",a={},d=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"2. Test retrieving a single post",id:"2-test-retrieving-a-single-post",level:2},{value:"4. Test an error case",id:"4-test-an-error-case",level:2},{value:"5. Test retrieving multiple posts",id:"5-test-retrieving-multiple-posts",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components},{TabItem:s,Tabs:n,TutorialSteps:i}=t;return s||g("TabItem",!0),n||g("Tabs",!0),i||g("TutorialSteps",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"implementing-read-operation",children:"Implementing READ operation"})}),"\n",(0,o.jsx)(t.p,{children:"In the earlier step, we created blog posts.\nIn this step, we'll implement a read operation and make a call to read blog posts.\nWe'll write two service methods, one for reading a single post and another for multiple posts."}),"\n",(0,o.jsx)(i,{current:4}),"\n",(0,o.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,o.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,o.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/grpc",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/docs/tutorials/grpc/define-service#6-compile-the-proto-file",children:"Generated Java code"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"BlogService.java"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"Main.java"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,o.jsx)(t.p,{children:"Let's write two methods for retrieving blog posts; one for a single post and\nanother for multiple posts."}),"\n",(0,o.jsxs)(n,{groupId:"grpc-read",children:[(0,o.jsxs)(s,{label:"Single post",value:"1",children:[(0,o.jsxs)(t.p,{children:["Add a service method in ",(0,o.jsx)(t.code,{children:"BlogService.java"})," to retrieve a single post."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:'import example.armeria.blog.grpc.GetBlogPostRequest;\n\npublic final class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n\n  @Override\n  public void getBlogPost(GetBlogPostRequest request, StreamObserver<BlogPost> responseObserver) {\n    final BlogPost blogPost = blogPosts.get(request.getId());\n    if (blogPost == null) {\n      responseObserver.onError(\n        Status.NOT_FOUND.withDescription("The blog post does not exist. ID: " + request.getId())\n                        .asRuntimeException());\n    } else {\n        responseObserver.onNext(blogPost);\n        responseObserver.onCompleted();\n    }\n  }\n}\n'})})]}),(0,o.jsxs)(s,{label:"Multiple posts",value:"2",children:[(0,o.jsxs)(t.p,{children:["Add a service method in ",(0,o.jsx)(t.code,{children:"BlogService.java"})," to retrieve multiple posts."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:"import java.util.Collection;\nimport java.util.Collections;\nimport java.util.Comparator;\nimport java.util.Map.Entry;\n\nimport example.armeria.blog.grpc.ListBlogPostsRequest;\nimport example.armeria.blog.grpc.ListBlogPostsResponse;\n\nfinal class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n  @Override\n  public void listBlogPosts(ListBlogPostsRequest request,\n                            StreamObserver<ListBlogPostsResponse> responseObserver) {\n      final Collection<BlogPost> blogPosts;\n      if (request.getDescending()) {\n          blogPosts = this.blogPosts.entrySet()\n                      .stream()\n                      .sorted(Collections.reverseOrder(Comparator.comparingInt(Entry::getKey)))\n                      .map(Entry::getValue).collect(Collectors.toList());\n      } else {\n          blogPosts = this.blogPosts.values();\n      }\n      responseObserver.onNext(ListBlogPostsResponse.newBuilder().addAllBlogs(blogPosts).build());\n      responseObserver.onCompleted();\n  }\n}\n"})})]})]}),"\n",(0,o.jsx)(t.h2,{id:"2-test-retrieving-a-single-post",children:"2. Test retrieving a single post"}),"\n",(0,o.jsx)(t.p,{children:"Let's test if we can retrieve a blog post we created."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["In the ",(0,o.jsx)(t.code,{children:"BlogServiceTest"})," class, add a test method to retrieve the first blog post with ID ",(0,o.jsx)(t.code,{children:"0"}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\nvoid getBlogPost() throws JsonProcessingException {\n  final BlogPost blogPost = client.getBlogPost(GetBlogPostRequest.newBuilder().setId(0).build());\n\n  assertThat(blogPost.getTitle()).isEqualTo("My first blog");\n  assertThat(blogPost.getContent()).isEqualTo("Hello Armeria!");\n}\n'})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsxs)(t.li,{children:["Add annotations to configure the order our test methods will be executed.\nThe annotations guarantee that the first blog post will be created in the ",(0,o.jsx)(t.code,{children:"createBlogPost()"})," method before we try to retrieve it in the ",(0,o.jsx)(t.code,{children:"getBlogPost()"})," method."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;\nimport org.junit.jupiter.api.Order;\nimport org.junit.jupiter.api.TestMethodOrder;\n\n@TestMethodOrder(OrderAnnotation.class) // Add this\nclass BlogServiceTest {\n  ...\n\n  @Test\n  @Order(1) // Add this\n  void createBlogPost() throws JsonProcessingException {\n    ...\n  }\n\n  @Test\n  @Order(2) // Add this\n  void getBlogPost() throws JsonProcessingException {\n    ...\n  }\n}\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"Run all the test cases on your IDE or using Gradle."}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Your client retrieved a blog post from the server successfully if the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"4-test-an-error-case",children:"4. Test an error case"}),"\n",(0,o.jsx)(t.p,{children:"Let's try retrieving a blog post that does not exist.\nAdd a test method to retrieve a blog post with an invalid ID, asserting an exception is thrown."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(3)\nvoid getInvalidBlogPost() throws JsonProcessingException {\n  final Throwable exception = catchThrowable(() -> {\n      client.getBlogPost(GetBlogPostRequest.newBuilder().setId(Integer.MAX_VALUE).build());\n  });\n  final StatusRuntimeException statusException = (StatusRuntimeException) exception;\n    assertThat(statusException.getStatus().getCode()).isEqualTo(Code.NOT_FOUND);\n    assertThat(statusException)\n          .hasMessageContaining("The blog post does not exist. ID: " + Integer.MAX_VALUE);\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"5-test-retrieving-multiple-posts",children:"5. Test retrieving multiple posts"}),"\n",(0,o.jsx)(t.p,{children:"Finally, let's test if we can retrieve multiple posts.\nAdd a test method like the following to create the second blog post and test retrieving the list of blog posts."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(4)\nvoid listBlogPosts() throws JsonProcessingException {\n  final CreateBlogPostRequest newBlogPost = CreateBlogPostRequest.newBuilder()\n                .setTitle("My second blog")\n                .setContent("Armeria is awesome!")\n                .build();\n  client.createBlogPost(newBlogPost);\n  final ListBlogPostsResponse\n          response = client.listBlogPosts(ListBlogPostsRequest.newBuilder()\n                .setDescending(false)\n                .build());\n\n  final List<BlogPost> blogs = response.getBlogsList();\n  assertThat(blogs).hasSize(2);\n  final BlogPost firstBlog = blogs.get(0);\n  assertThat(firstBlog.getTitle()).isEqualTo("My first blog");\n  assertThat(firstBlog.getContent()).isEqualTo("Hello Armeria!");\n\n  final BlogPost secondBlog = blogs.get(1);\n  assertThat(secondBlog.getTitle()).isEqualTo("My second blog");\n  assertThat(secondBlog.getContent()).isEqualTo("Armeria is awesome!");\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,o.jsx)(t.p,{children:"In this step, we've implemented service methods to retrieve blog posts."}),"\n",(0,o.jsxs)(t.p,{children:["Next, at ",(0,o.jsx)(t.a,{href:"/docs/tutorials/grpc/implement-update",children:"Step 5. Implement UPDATE"}),", we'll implement an UPDATE operation to update a blog post."]}),"\n",(0,o.jsx)(i,{current:4})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}function g(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);