"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[913],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}},63217:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tutorials/grpc/implement-create","title":"Implementing CREATE operation","description":"In the previous step, we defined service methods.","source":"@site/src/content/docs/tutorials/grpc/03-implement-create.mdx","sourceDirName":"tutorials/grpc","slug":"/tutorials/grpc/implement-create","permalink":"/docs/tutorials/grpc/implement-create","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/tutorials/grpc/03-implement-create.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"3. Implement CREATE","category":"grpc","tags":["server"],"level":"basic","type":"step"},"sidebar":"docsSidebar","previous":{"title":"2. Run a service","permalink":"/docs/tutorials/grpc/run-service"},"next":{"title":"4. Implement READ","permalink":"/docs/tutorials/grpc/implement-read"}}');var s=n(74848),i=n(28453);const o={sidebar_label:"3. Implement CREATE",category:"grpc",tags:["server"],level:"basic",type:"step"},a="Implementing CREATE operation",l={},c=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"2. Register a ServerExtension",id:"2-register-a-serverextension",level:2},{value:"3. Set up a client for testing",id:"3-set-up-a-client-for-testing",level:2},{value:"4. Test creating a blog post",id:"4-test-creating-a-blog-post",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{TutorialSteps:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"implementing-create-operation",children:"Implementing CREATE operation"})}),"\n",(0,s.jsxs)(t.p,{children:["In the previous step, we defined service methods.\nIn this step, we'll implement one of the service methods to create a blog post and again, try making a call to a service method.\nAlso, we'll use Armeria's ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/testing/junit5/server/ServerExtension.html",children:"ServerExtension"})," for testing."]}),"\n",(0,s.jsx)(n,{current:3}),"\n",(0,s.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,s.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,s.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/grpc",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/define-service#6-compile-the-proto-file",children:"Generated Java code"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogService.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"Main.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,s.jsxs)(t.p,{children:["Let's implement a service method ",(0,s.jsx)(t.code,{children:"createBlogPost()"})," in the ",(0,s.jsx)(t.code,{children:"BlogService"})," class."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Create an ID generator to issue temporary blog post IDs and a map to contain blogs posts."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:"import java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic final class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n  private final AtomicInteger idGenerator = new AtomicInteger();\n  private final Map<Integer, BlogPost> blogPosts = new ConcurrentHashMap<>();\n}\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Add a service method, ",(0,s.jsx)(t.code,{children:"createBlogPost()"}),":","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Create a ",(0,s.jsx)(t.code,{children:"BlogPost"})," object with request parameters."]}),"\n",(0,s.jsx)(t.li,{children:"Save the post information in the map."}),"\n",(0,s.jsx)(t.li,{children:"Return the information of the blog post created."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:"import java.time.Instant;\nimport io.grpc.stub.StreamObserver;\n\nfinal class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n  @Override\n  public void createBlogPost(CreateBlogPostRequest request, StreamObserver<BlogPost> responseObserver) {\n    final int id = idGenerator.getAndIncrement(); // Generate post ID\n    final Instant now = Instant.now();            // Get current time\n    final BlogPost updated = BlogPost.newBuilder()\n                     .setId(id)\n                     .setTitle(request.getTitle())\n                     .setContent(request.getContent())\n                     .setModifiedAt(now.toEpochMilli())\n                     .setCreatedAt(now.toEpochMilli())\n                     .build();\n    blogPosts.put(id, updated);\n    responseObserver.onNext(updated);\n    responseObserver.onCompleted();\n  }\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"2-register-a-serverextension",children:"2. Register a ServerExtension"}),"\n",(0,s.jsxs)(t.p,{children:["In the previous test code, we've connected directly to the server.\nThis time, let's use Armeria's ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/testing/junit5/server/ServerExtension.html",children:"ServerExtension"})," instead.\nThis approach automatically handles set-up and tear-down of a server for testing.\nNow we don't have to invoke the main method to set up a server before running our tests."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.code,{children:"BlogServiceTest"})," class, remove the ",(0,s.jsx)(t.code,{children:"connect()"})," method to eliminate dependency on the main method."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"public class BlogServiceTest {\n  ...\n  @Test\n  void connect() {...} // Remove this method\n}\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Register a ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/testing/junit5/server/ServerExtension.html",children:"ServerExtension"})," as follows.\nNote that the service instance is added to the configuration."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"import org.junit.jupiter.api.extension.RegisterExtension;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.grpc.GrpcService;\nimport com.linecorp.armeria.testing.junit5.server.ServerExtension;\n\npublic class BlogServiceTest {\n  ...\n  @RegisterExtension\n  static final ServerExtension server = new ServerExtension() {\n    @Override\n    protected void configure(ServerBuilder sb) throws Exception {\n      sb.service(GrpcService.builder()\n                    // Add the service to the configuration\n                    .addService(new BlogService())\n                    .build());\n    }\n  };\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"3-set-up-a-client-for-testing",children:"3. Set up a client for testing"}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"BlogServiceTest"})," class, add a method as follows.\nThis will set up a client before executing each test cases."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"import org.junit.jupiter.api.BeforeAll;\n\n@BeforeAll\nstatic void beforeAll() {\n  client = GrpcClients.newClient(server.httpUri(),\n                 BlogServiceBlockingStub.class);\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"4-test-creating-a-blog-post",children:"4. Test creating a blog post"}),"\n",(0,s.jsx)(t.p,{children:"Let's test if we can create a blog post."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.code,{children:"BlogServiceTest"})," class, add a test method as follows."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import static org.assertj.core.api.Assertions.assertThat;\nimport com.fasterxml.jackson.core.JsonProcessingException;\n\n@Test\nvoid createBlogPost() throws JsonProcessingException {\n  final CreateBlogPostRequest request = CreateBlogPostRequest.newBuilder()\n                   .setTitle("My first blog")\n                   .setContent("Hello Armeria!")\n                   .build();\n  final BlogPost response = client.createBlogPost(request);\n  assertThat(response.getTitle()).isEqualTo(request.getTitle());\n  assertThat(response.getContent()).isEqualTo(request.getContent());\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsx)(t.li,{children:"Run the test case on your IDE or using Gradle."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"./gradlew test\n"})}),"\n",(0,s.jsx)(t.p,{children:"The service worked as expected if you see the test case passed."}),"\n",(0,s.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,s.jsxs)(t.p,{children:["In this step, we've implemented a method for creating a blog post.\nWe've also registered ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/testing/junit5/server/ServerExtension.html",children:"ServerExtension"})," to our test."]}),"\n",(0,s.jsxs)(t.p,{children:["Next, at ",(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/implement-read",children:"Step 4. Implement READ"}),", we'll implement a READ operation to read a single post and also multiple posts."]}),"\n",(0,s.jsx)(n,{current:3})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);