"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[9228],{28453:(e,r,i)=>{i.d(r,{R:()=>l,x:()=>o});var t=i(96540);const a={},n=t.createContext(a);function l(e){const r=t.useContext(n);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(n.Provider,{value:r},e.children)}},36760:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"client/thrift","title":"Calling a Thrift service","description":"Visit armeria-examples to find a fully working example.","source":"@site/src/content/docs/client/thrift.mdx","sourceDirName":"client","slug":"/client/thrift","permalink":"/docs/client/thrift","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/client/thrift.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Calling an HTTP service","permalink":"/docs/client/http"},"next":{"title":"Calling a gRPC service","permalink":"/docs/client/grpc"}}');var a=i(74848),n=i(28453);const l={},o="Calling a Thrift service",c={},s=[{value:"See also",id:"see-also",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"calling-a-thrift-service",children:"Calling a Thrift service"})}),"\n",(0,a.jsx)(r.admonition,{type:"tip",children:(0,a.jsxs)(r.p,{children:["Visit ",(0,a.jsx)(r.a,{href:"https://github.com/line/armeria-examples",children:"armeria-examples"})," to find a fully working example."]})}),"\n",(0,a.jsxs)(r.p,{children:["Let's assume we have the following Thrift IDL, served at ",(0,a.jsx)(r.code,{children:"http://127.0.0.1:8080/hello"}),", just like what we\nused in ",(0,a.jsx)(r.a,{href:"/docs/server/thrift",children:"Running a Thrift service"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-protobuf",children:"namespace java com.example.thrift.hello\n\nservice HelloService {\n    string hello(1:string name)\n}\n"})}),"\n",(0,a.jsx)(r.p,{children:"Making a call starts from creating a client:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.client.thrift.ThriftClients;\n\n// Use the tbinary format by default.\nHelloService.Iface helloService = ThriftClients.newClient(\n    "http://127.0.0.1:8080/hello",\n    HelloService.Iface.class); // or AsyncIface.class\n\nString greeting = helloService.hello("Armerian World");\nassert greeting.equals("Hello, Armerian World!");\n'})}),"\n",(0,a.jsxs)(r.p,{children:["Note that if a serialization format is unspecified, ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftSerializationFormats.html#BINARY",children:"ThriftSerializationFormats#BINARY"})," is used by\ndefault. You can also specify one of ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftSerializationFormats.html#BINARY",children:"ThriftSerializationFormats#BINARY"}),",\n",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftSerializationFormats.html#COMPACT",children:"ThriftSerializationFormats#COMPACT"}),", ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftSerializationFormats.html#JSON",children:"ThriftSerializationFormats#JSON"}),"\nand ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftSerializationFormats.html#TEXT",children:"ThriftSerializationFormats#TEXT"}),"\nusing ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/thrift/ThriftClientBuilder.html#serializationFormat(com.linecorp.armeria.common.SerializationFormat)",children:"ThriftClientBuilder#serializationFormat(SerializationFormat)"}),"."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.thrift.ThriftSerializationFormats;\n\nHelloService.Iface helloService =\n    ThriftClients.builder("http://127.0.0.1:8080")\n                 .path("/hello")\n                 .serializationFormat(ThriftSerializationFormats.JSON)\n                 .build(HelloService.Iface.class); // or AsyncIface.class\n'})}),"\n",(0,a.jsxs)(r.p,{children:["Since we specified ",(0,a.jsx)(r.code,{children:"HelloService.Iface"})," as the client type, ",(0,a.jsx)(r.code,{children:"ThriftClients.newClient()"})," will return a\nsynchronous client implementation. If we specified ",(0,a.jsx)(r.code,{children:"HelloService.AsyncIface"}),", the calling code would have looked\nlike the following:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.thrift.ThriftFuture;\nimport com.linecorp.armeria.common.util.CompletionActions;\nimport com.linecorp.armeria.client.thrift.ThriftClients;\n\nHelloService.AsyncIface helloService =\n    ThriftClients.newClient("http://127.0.0.1:8080/hello",\n                            HelloService.AsyncIface.class);\n\nThriftFuture<String> future = new ThriftFuture<String>();\nhelloService.hello("Armerian World", future);\n\nfuture.thenAccept(response -> assert response.equals("Hello, Armerian World!"))\n      .exceptionally(cause -> {\n          cause.printStackTrace();\n          return null;\n      });\n\n// You can also wait until the call is finished.\nString reply = future.get();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["The example above introduces a new class called ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftFuture.html",children:"ThriftFuture"}),". It is a subtype of Java 8\nCompletableFuture_ that implements Thrift ",(0,a.jsx)(r.a,{href:"https://github.com/apache/thrift/blob/bd964c7f3460c308161cb6eb90583874a7d8d848/lib/java/src/org/apache/thrift/async/AsyncMethodCallback.java#L22",children:"AsyncMethodCallback"}),". Once passed as a callback of an asynchronous\nThrift call, ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/thrift/ThriftFuture.html",children:"ThriftFuture"})," will complete itself when the reply is received or the call\nfails. You'll find it way more convenient to consume the reply than ",(0,a.jsx)(r.a,{href:"https://github.com/apache/thrift/blob/bd964c7f3460c308161cb6eb90583874a7d8d848/lib/java/src/org/apache/thrift/async/AsyncMethodCallback.java#L22",children:"AsyncMethodCallback"})," thanks to the rich set\nof methods provided by ",(0,a.jsx)(r.a,{href:"https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/CompletableFuture.html",children:"CompletableFuture"}),"."]}),"\n",(0,a.jsx)(r.p,{children:"You can also use the builder pattern for client construction:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.HttpRequest;\nimport com.linecorp.armeria.common.HttpResponse;\n\nHelloService.Iface helloService =\n    ThriftClients.builder("http://127.0.0.1:8080")\n                 .path("/hello")\n                 .responseTimeoutMillis(10000)\n                 .decorator(LoggingClient.newDecorator())\n                 .build(HelloService.Iface.class); // or AsyncIface.class\n\nString greeting = helloService.hello("Armerian World");\nassert greeting.equals("Hello, Armerian World!");\n'})}),"\n",(0,a.jsxs)(r.p,{children:["As you might have noticed already, we decorated the client using ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/logging/LoggingClient.html",children:"LoggingClient"}),", which logs all\nrequests and responses. You might be interested in decorating a client using other decorators, for example\nto gather metrics. Please also refer to ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/thrift/ThriftClientBuilder.html",children:"ThriftClientBuilder"})," for more configuration options."]}),"\n",(0,a.jsx)(r.h2,{id:"see-also",children:"See also"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"/docs/server/thrift",children:"Running a Thrift service"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"/docs/client/decorator",children:"Decorating a client"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"/docs/client/custom-http-headers",children:"Sending custom HTTP headers"})}),"\n"]})]})}function m(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);