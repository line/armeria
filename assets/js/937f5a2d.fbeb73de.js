"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[4284],{1686:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_grpc_return-10115c0dab2e3ada0fc5d655e611c1c8.png"},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}},67642:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_grpc_docservice_start-8b46379051643c6ec196732e0ebb01e6.png"},74881:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_grpc_reqex-620d07274f6a2f0646251d679cb6f03a.png"},86342:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tutorials/grpc/implement-delete","title":"Implementing DELETE operation","description":"So far, we created, read, and updated a blog post.","source":"@site/src/content/docs/tutorials/grpc/06-implement-delete.mdx","sourceDirName":"tutorials/grpc","slug":"/tutorials/grpc/implement-delete","permalink":"/docs/tutorials/grpc/implement-delete","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/tutorials/grpc/06-implement-delete.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_label":"6. Implement DELETE","category":"grpc","tags":["server"],"level":"basic","type":"step"},"sidebar":"docsSidebar","previous":{"title":"5. Implement UPDATE","permalink":"/docs/tutorials/grpc/implement-update"},"next":{"title":"Thrift tutorial introduction","permalink":"/docs/tutorials/thrift/"}}');var s=n(74848),i=n(28453);const o={sidebar_label:"6. Implement DELETE",category:"grpc",tags:["server"],level:"basic",type:"step"},a="Implementing DELETE operation",l={},c=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"2. Test deleting a blog post",id:"2-test-deleting-a-blog-post",level:2},{value:"3. Test an error case",id:"3-test-an-error-case",level:2},{value:"4. Add the Documentation service",id:"4-add-the-documentation-service",level:2},{value:"5. Check the DocService page",id:"5-check-the-docservice-page",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{TutorialSteps:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"implementing-delete-operation",children:"Implementing DELETE operation"})}),"\n",(0,s.jsxs)(t.p,{children:["So far, we created, read, and updated a blog post.\nNow, let's implement and make a call to delete a blog post.\nAlso, we'll add Armeria's ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation Service"})," for testing our blog service."]}),"\n",(0,s.jsx)(r,{current:6}),"\n",(0,s.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,s.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,s.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/grpc",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/define-service#6-compile-the-proto-file",children:"Generated Java code"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogService.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"Main.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogNotFoundException.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"GrpcExceptionHandler.java"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,s.jsxs)(t.p,{children:["Let's implement a service method ",(0,s.jsx)(t.code,{children:"deleteBlogPost()"})," in the ",(0,s.jsx)(t.code,{children:"BlogService"})," class."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Add a service method, ",(0,s.jsx)(t.code,{children:"deleteBlogPost()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:'import example.armeria.blog.grpc.DeleteBlogPostRequest;\n\npublic class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n  @Override\n  public void deleteBlogPost(DeleteBlogPostRequest request, StreamObserver<Empty> responseObserver) {\n    try {\n      // Simulate a blocking API call.\n      Thread.sleep(100);\n    } catch (InterruptedException e) {\n      throw new RuntimeException(e);\n    }\n\n    final BlogPost removed = blogPosts.remove(request.getId());\n    if (removed == null) {\n      responseObserver.onError(\n        new BlogNotFoundException("The blog post does not exist. ID: " + request.getId()));\n    } else {\n        responseObserver.onNext(Empty.getDefaultInstance());\n        responseObserver.onCompleted();\n    }\n }\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Add Armeria's ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcServiceBuilder.html",children:"GrpcServiceBuilder"}),"'s blocking task executor to make all gRPC methods executed\nin the blocking task executor's thread pool."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["By default, service methods are executed on the event loop and are expected to be implemented asynchronously.\nTo implement blocking logic, call ",(0,s.jsx)(t.code,{children:"useBlockingTaskExecutor(true)"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:"private static Server newServer(int port) throws Exception {\n  final GrpcService grpcService =\n          GrpcService.builder().addService(new BlogService())\n                               .exceptionMapping(new GrpcExceptionHandler())\n                               .useBlockingTaskExecutor(true) // Add this\n                               .build();\n  ...\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"2-test-deleting-a-blog-post",children:"2. Test deleting a blog post"}),"\n",(0,s.jsxs)(t.p,{children:["Let's test deleting a blog post.\nWe'll delete the blog post with ID ",(0,s.jsx)(t.code,{children:"1"}),", and try retrieving with the same ID to verify it is indeed deleted.\nAdd a test method like the following."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(7)\nvoid deleteBlogPost() {\n  final DeleteBlogPostRequest request = DeleteBlogPostRequest.newBuilder()\n                                                             .setId(1)\n                                                             .build();\n  client.deleteBlogPost(request);\n  final Throwable exception = catchThrowable(() -> {\n    client.getBlogPost(GetBlogPostRequest.newBuilder().setId(1).build());\n  });\n\n  final StatusRuntimeException statusException = (StatusRuntimeException) exception;\n  assertThat(statusException.getStatus().getCode()).isEqualTo(Code.NOT_FOUND);\n  assertThat(statusException)\n          .hasMessageContaining("The blog post does not exist. ID: 1");\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,s.jsx)(t.h2,{id:"3-test-an-error-case",children:"3. Test an error case"}),"\n",(0,s.jsx)(t.p,{children:"Let's test deleting a blog post that does not exist.\nAdd a test method like the following."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(8)\nvoid badRequestExceptionHandlerWhenTryingDeleteMissingBlogPost() throws JsonProcessingException {\n  final Throwable exception = catchThrowable(() -> {\n    client.deleteBlogPost(DeleteBlogPostRequest.newBuilder().setId(100).build());\n  });\n  final StatusRuntimeException statusException = (StatusRuntimeException) exception;\n  assertThat(statusException.getStatus().getCode()).isEqualTo(Code.NOT_FOUND);\n  assertThat(statusException)\n          .hasMessageContaining("The blog post does not exist. ID: 100");\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,s.jsx)(t.h2,{id:"4-add-the-documentation-service",children:"4. Add the Documentation service"}),"\n",(0,s.jsxs)(t.p,{children:["This time, we'll add Armeria's ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"}),".\nThe Documentation service automatically creates documentation of your service methods, as well as providing means to test out the methods."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.code,{children:"newServer()"})," method, add a ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," instance and a request example for ",(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/implement-create",children:"creating blog posts"}),",\nusing ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocServiceBuilder.html#exampleRequests(java.lang.Class,java.lang.String,java.lang.Iterable)",children:"DocServiceBuilder#exampleRequests(Class,String,Iterable)"}),". Feel free to add more examples for other service methods."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'import com.linecorp.armeria.server.docs.DocService;\nimport com.linecorp.armeria.server.docs.DocServiceFilter;\nimport io.grpc.reflection.v1alpha.ServerReflectionGrpc;\n\nfinal class Main {\n  private static Server newServer(int port) throws Exception {\n    final BlogPost exampleRequest =\n      BlogPost.newBuilder()\n              .setTitle("Example title")\n              .setContent("Example content")\n              .build();\n    final DocService docService =\n      DocService.builder()\n                .exampleRequests(BlogServiceGrpc.SERVICE_NAME,\n                                 "CreateBlogPost", exampleRequest)\n                .exclude(DocServiceFilter.ofServiceName(\n                         ServerReflectionGrpc.SERVICE_NAME))\n                .build();\n\n  }\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Enable unframed requests by setting ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcServiceBuilder.html#enableUnframedRequests(boolean)",children:"GrpcServiceBuilder#enableUnframedRequests(boolean)"})," to ",(0,s.jsx)(t.code,{children:"true"}),".\nThis makes the blog service support requests that are not framed in gRPC wire format.\nFor us, this enables making calls from a web browser."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:"private static Server newServer(int port) throws Exception {\n...\nfinal GrpcService grpcService =\n        GrpcService.builder()\n                   .addService(new BlogService())\n                   .enableUnframedRequests(true) // Add this\n                   .exceptionMapping(new GrpcExceptionHandler())\n                   .useBlockingTaskExecutor(true)\n                   .build();\n...\n}\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Add the ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," to the server builder."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'private static Server newServer(int port) throws Exception {\n  ...\n  return Server.builder()\n               .http(port)\n               .service(grpcService)\n               .serviceUnder("/docs", docService) // Add this\n               .build();\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:["(Optional) To access the Documentation service result easily, edit the log message in the ",(0,s.jsx)(t.code,{children:"main()"})," method."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'public static void main(String[] args) throws Exception {\n  ...\n  logger.info("Server has been started. Serving DocService at http://127.0.0.1:{}/docs",\n              server.activeLocalPort());\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["Otherwise, restart the server by running the ",(0,s.jsx)(t.code,{children:"Main.main()"})," method."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The server and services are launched successfully if you see this message."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"Server has been started. Serving DocService at http://127.0.0.1:8080/docs\n"})}),"\n",(0,s.jsx)(t.h2,{id:"5-check-the-docservice-page",children:"5. Check the DocService page"}),"\n",(0,s.jsx)(t.p,{children:"Let's test and call our service operations using Armeria's Documentation service."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Click the URL ",(0,s.jsx)(t.a,{href:"http://127.0.0.1:8080/docs",children:"http://127.0.0.1:8080/docs"})," from the log message or open up the URL on a web browser."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["If you see the Document service page, you've successfully launched the ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," and server."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(67642).A+"",width:"1193",height:"519"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Click the ",(0,s.jsx)(t.strong,{children:"CreateBlogPost()"})," method link in the left panel. You can make calls to the method from the page."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(74881).A+"",width:"536",height:"419"})}),"\n",(0,s.jsxs)(t.p,{children:["Note that in the ",(0,s.jsx)(t.strong,{children:"REQUEST BODY"})," section the values specified in the ",(0,s.jsx)(t.code,{children:"exampleRequest"})," are automatically displayed on the page."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'final BlogPost exampleRequest = BlogPost.newBuilder()\n                   .setTitle("Example title")\n                   .setContent("Example content")\n                   .build();\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Click the ",(0,s.jsx)(t.strong,{children:"SUBMIT"})," button, and you'll see the blog post information returned in the right panel."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(1686).A+"",width:"1080",height:"296"})}),"\n",(0,s.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,s.jsxs)(t.p,{children:["In this step, we've implemented a service method and client method for deleting a blog post.\nWe've also added ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"})," to our server."]}),"\n",(0,s.jsx)(t.p,{children:"We've come to the end of this tutorial.\nNext, try adding more service methods to the tutorial or have a go at developing a service of your own."}),"\n",(0,s.jsx)(r,{current:6})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);