"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[9754],{25450:e=>{e.exports=JSON.parse('{"permalink":"/blog/2016/04/13/open-sourcing-armeria","editUrl":"https://github.com/line/armeria/edit/main/site/src/content/blog/en/2016-04-13-open-sourcing-armeria.mdx","source":"@site/src/content/blog/en/2016-04-13-open-sourcing-armeria.mdx","title":"Open-sourcing Armeria","description":"Armeria is an asynchronous RPC/API client-server implementation built on top of Java 8 and Netty that went open-source last November under Apache License 2.0 by LINE Corporation.","date":"2016-04-13T00:00:00.000Z","tags":[],"readingTime":10,"hasTruncateMarker":true,"authors":[{"name":"Trustin Lee","title":"He is the founder of Netty and a co-founder of Apache MINA.","imageURL":"https://github.com/trustin.png","key":"trustin","page":null}],"frontMatter":{"authors":["trustin"],"other_languages":{"ja":"/blog/ja/2016/04/13/open-sourcing-armeria","ko":"/blog/ko/2016/04/13/open-sourcing-armeria"}},"unlisted":false,"prevItem":{"title":"Circuit breakers for distributed services","permalink":"/blog/2016/07/24/circuit-breakers-for-distributed-services"}}')},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(96540);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}},78130:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var i=n(25450),o=n(74848),s=n(28453),r=n(5260);const a={authors:["trustin"],other_languages:{ja:"/blog/ja/2016/04/13/open-sourcing-armeria",ko:"/blog/ko/2016/04/13/open-sourcing-armeria"}},l="Open-sourcing Armeria",h={authorsImageUrls:[void 0]},c=[{value:"Cleaning up the project history",id:"cleaning-up-the-project-history",level:2},{value:"Writing API documentation",id:"writing-api-documentation",level:2},{value:"Building a website",id:"building-a-website",level:2},{value:"Designing a logo",id:"designing-a-logo",level:2},{value:"I&#39;m not a lawyer but legal stuff matters",id:"im-not-a-lawyer-but-legal-stuff-matters",level:2},{value:"Working with other open-source projects",id:"working-with-other-open-source-projects",level:2},{value:"Please join us!",id:"please-join-us",level:2},{value:"About the author",id:"about-the-author",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"http://line.github.io/armeria/",children:"Armeria"})," is an asynchronous RPC/API client-server implementation built on top of Java 8 and ",(0,o.jsx)(t.a,{href:"http://netty.io/",children:"Netty"})," that went open-source last November under Apache License 2.0 by LINE Corporation.\nIts primary goal is to help engineers build high-performance asynchronous Thrift clients and servers that use HTTP/2 as a session layer protocol, although it is designed to be protocol-agnostic and highly extensible (for example, you can serve a directory of static files via HTTP/2 and run Java EE web applications)."]}),"\n","\n",(0,o.jsx)(t.p,{children:"In this post, I'd like to focus on the steps that were taken to open-source an internal project rather than the technical aspect.\nIf you are interested in the technical details of Armeria, you might want to check out the following slides presented last February during the 14th LINE Developer Meetup:"}),"\n",(0,o.jsx)(r.A,{children:(0,o.jsx)("script",{async:!0,className:"speakerdeck-embed-script",src:"https://speakerdeck.com/assets/embed.js"})}),"\n",(0,o.jsx)("div",{className:"deck-embed js-deck-embed",style:{aspectRatio:"1024/640"},"data-ratio":"1.6","data-state":"processed",children:(0,o.jsx)("div",{className:"speakerdeck-embed","data-title":"false","data-skip-resize":"true","data-id":"8d645c29ce33400e8360e61fd0250f91","data-name":"Armeria: LINE's next generation RPC layer","data-ratio":"1.6","data-host":"speakerdeck.com"})}),"\n",(0,o.jsx)(t.h2,{id:"cleaning-up-the-project-history",children:"Cleaning up the project history"}),"\n",(0,o.jsx)(t.p,{children:"When you work on an internal project, it is very likely that the project contains changesets you wouldn't have published if they were public from day 1, such as:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Confidential information (Such as issue numbers, host names, internal URLs)"}),"\n",(0,o.jsx)(t.li,{children:'Commit messages that are meaningless or written in poor taste ("Blah", "WIP", "WTF")'}),"\n",(0,o.jsx)(t.li,{children:"Copyright headers"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"It is obviously not an option to append an amending commit to the repository, because the history of the project would still be preserved.\nWe need to clean up the history so that it does not leak anything unexpected.\nThere are basically two options for this."}),"\n",(0,o.jsxs)(t.p,{children:["One option is to review each changeset and amend it individually.\nAlthough you can reduce the amount of effort by using automation such as the ",(0,o.jsx)(t.a,{href:"https://git-scm.com/docs/git-filter-branch",children:(0,o.jsx)(t.code,{children:"git filter-branch"})})," command, you'll basically have to review every changeset carefully.\nThe other option is to hide any unwanted information and collapse all changesets into a single commit.\nThis is much simpler than the first option, but you will lose the history.\nSomeday, you may wonder why you wrote a piece of code in a certain way, but you'll have no clue because the history has been squashed away."]}),"\n",(0,o.jsx)(t.p,{children:"If the project history is relatively short and you are sure your coding standards are pretty high, you might want to choose the first option.\nOtherwise, if your time is limited and there's too much stuff to review, you would want to push the big red button like we did - squashing the history into a single commit."}),"\n",(0,o.jsx)(t.p,{children:"However, code is not written by a single person nowadays.\nIf we just make a single commit, how would we credit the people who participated in this collaborative effort of fine workmanship?\nWe ended up crediting them in our commit message."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"Subject: Initial import\nThis commit contains the collective work of the following enthusiastic\ncontributors at LINE Corporation:\n- Anuraag Agrawal  @anuraaga\n- Heon Jeong       @blmarket\n- Young-tae Seok   @delegacy\n- Su-ahn Lee       @inch772\n- Woo-jung Choi    @sophiechoi\n- Trustin Lee      @trustin\n- Yuichi Ono\n"})}),"\n",(0,o.jsx)(t.p,{children:"Looking back, I should have expressed more appreciation into the commit message.\nI can't thank you enough, folks!"}),"\n",(0,o.jsx)(t.h2,{id:"writing-api-documentation",children:"Writing API documentation"}),"\n",(0,o.jsx)(t.p,{children:"When starting a project from scratch, especially one with no real template to follow, it is important to write code fast and get it out fast to find design issues and bugs.\nAPIs change fast in the early stages and it can be convenient to leave out API documentation to focus on implementation, leaving some holes that need to be filled later (of course, we also find it much more fun to write code than documentation)."}),"\n",(0,o.jsx)(t.p,{children:"However, good documentation is one of the critical factors of adoption in the open-source scene.\nIt's only when we are very desperate when we consider to use undocumented open-source software.\nWhy would people use our open-source project if it is not documented well?\nThere are already so many similar projects in the wild!"}),"\n",(0,o.jsx)(t.p,{children:"So, we had to fill all the holes we left open.\nWe could call it \"documentation debt\" and we must admit that paying it back was not the most pleasing experience.\nNow that we have documented everything properly, it is very easy to keep the documentation debt low by making sure any new public methods and classes are documented properly during the review process.\nIt's like keeping your body fit; it's easier once you're fit."}),"\n",(0,o.jsx)(t.h2,{id:"building-a-website",children:"Building a website"}),"\n",(0,o.jsx)(t.p,{children:"Although Github is a good starting point for hosting a project, it is almost always better to provide a dedicated website.\nIn a dedicated project website, we can organize the information we want to provide in the way we want and express the identity of the project in a more visually appealing way."}),"\n",(0,o.jsx)(t.p,{children:"However, building a website is not a simple job and we did not want to spend more time than writing a few lines of code to maintain it; we needed a scalable way to write and maintain it."}),"\n",(0,o.jsxs)(t.p,{children:["Fortunately, some engineers have open-sourced great website generation tools that help us deal with HTML and CSS, so we can bug our designers less often.\nWe chose ",(0,o.jsx)(t.a,{href:"http://www.sphinx-doc.org/en/stable/",children:"Sphinx"})," in conjunction with ",(0,o.jsx)(t.a,{href:"http://trustin.github.io/sphinx-maven-plugin/",children:"sphinx-maven-plugin"})," and ",(0,o.jsx)(t.a,{href:"http://read-the-docs.readthedocs.org/en/latest/",children:"Read the Docs theme"})," so that we can generate our website as a part of the build process.\nThere are also many other tools that serve similar purposes, such as ",(0,o.jsx)(t.a,{href:"http://awestruct.org/",children:"Awestruct"})," and ",(0,o.jsx)(t.a,{href:"https://jekyllrb.com/",children:"Jekyll"}),", so you might want to play with them and choose what fits you if you are interested in building a website."]}),"\n",(0,o.jsx)(t.h2,{id:"designing-a-logo",children:"Designing a logo"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:n(87757).A+"",width:"938",height:"811"})}),"\n",(0,o.jsx)(t.p,{children:"The Armeria logo"}),"\n",(0,o.jsx)(t.p,{children:"A logo is like the essence of a project.\nIt visualizes and symbolizes what the project is and where it is going.\nIt also helps people remember the project via association."}),"\n",(0,o.jsx)(t.p,{children:"Because of its impact on a project, it requires a designer to contemplate and iterate over many prototypes.\nWe fortunately had a new member with an industrial design degree who joined us at just the right time.\nWe really appreciate her for helping us in her spare time, and we believe her next logo will be fascinating as well!"}),"\n",(0,o.jsx)(t.h2,{id:"im-not-a-lawyer-but-legal-stuff-matters",children:"I'm not a lawyer but legal stuff matters"}),"\n",(0,o.jsx)(t.p,{children:"The notion of open-source software has been around since the beginning of computing, but it hasn't been very long since open-source licensing caught our attention.\nSome people overlook the fact that an open source project is still owned by someone even if it is free to use.\nTo avoid any potential legal issues, what we did first was to make sure that we do not violate the license terms of the open-source software projects Armeria depends on."}),"\n",(0,o.jsx)(t.p,{children:"For instance, we included all the license agreement files and their summaries into our repository so that our users are informed about what software Armeria depends on.\nWe also explicitly mentioned what portions of other open-source software have been modified and redistributed in Armeria."}),"\n",(0,o.jsxs)(t.p,{children:["On the other hand, Armeria is also an open source project with an owner, so we licensed it to its users under fair and clear terms as well.\nWe chose ",(0,o.jsx)(t.a,{href:"https://tldrlegal.com/license/apache-license-2.0-(apache-2.0)",children:"Apache License 2.0"})," over other open source licenses because of the following notable features:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Software licensed under Apache License 2.0 may be freely used, reproduced, modified, distributed or sold without accompanying the corresponding source code."}),"\n",(0,o.jsx)(t.li,{children:"It contains a provision that states the conditions of the granting and infringement of patent licenses."}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Another important thing people often miss out is the contributor license agreement (CLA) which is required when accepting an external contribution.\nWhen someone outside your company sends a pull request for a very cool feature you feel like merging immediately, you'd better make sure the submitter of the pull request has signed the contributor license agreement.\nIt's outside the scope of this post to explain what exactly CLA is, but you can find detailed explanations on ",(0,o.jsx)(t.a,{href:"http://oss-watch.ac.uk/resources/cla",children:"OSS Watch"})," and ",(0,o.jsx)(t.a,{href:"https://www.clahub.com/pages/why_cla",children:"CLAHub"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"All these steps are seemingly time-consuming and painful, but it wasn't anything like that in reality.\nThey are mostly one-time things, and our friendly folks at the legal department freed us from the hassles of dealing with legal issues we would have had to deal with by ourselves otherwise.\nWhen you are in doubt, just find your legal department; we are not lawyers!"}),"\n",(0,o.jsx)(t.h2,{id:"working-with-other-open-source-projects",children:"Working with other open-source projects"}),"\n",(0,o.jsx)(t.p,{children:"You may sometimes find bugs in an open-source project you depend on.\nSometimes it can be worked around, but sometimes it can't.\nYou could keep the fix in your own fork of the project, but it's almost always better to propose a change upstream so that you do not need to maintain it by yourself indefinitely.\nContributing upstream also increases your visibility to the open-source scene and you will find yourself having fun collaborating with others, both of which are very positive to your career."}),"\n",(0,o.jsxs)(t.p,{children:["While developing Armeria, we reported various issues and contributed some of their fixes to the ",(0,o.jsx)(t.a,{href:"http://netty.io/",children:"Netty"})," project:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["HTTP/1 and 2","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4785",children:"#4785"})," - Fix missing trailing data on HTTP client upgrade"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4582",children:"#4582"})," - Revamp InboundHttp2ToHttpAdapter builder API"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4574",children:"#4574"})," - Revamp the Http2ConnectionHandler builder API"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4525",children:"#4525"}),' - Fix the incorrect usage/value of "Connection: upgrade"']}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4524",children:"#4524"})," - Fix IllegalReferenceCountException caused by HttpClientCodec.upgradeFrom()"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4523",children:"#4523"})," - Relax the sanity check in HttpClientUpgradeHandler"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4428",children:"#4428"})," - Reject the first SETTINGS ack on HTTP/2 Preface"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4210",children:"#4210"})," - Http2ConnectionHandler does not close the stream 1 (HTTP_UPGRADE_STREAM_ID)"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/3876",children:"#3876"})," - Lazily instantiate HttpServerUpgradeHandler.UpgradeCodec"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["DNS","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4946",children:"#4946"})," - Fix potential infinite loop when resolving CNAME records"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4837",children:"#4837"})," - Preserve the host name of address when parsing /etc/hosts file"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4665",children:"#4665"})," - Netty's DNS resolution should take into account system domain name"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4541",children:"#4541"})," - Don't cycle dns servers while cycling dns record types."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["Miscellaneous","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4547",children:"#4547"})," - NPE in PooledByteBufAllocator.newDirectBuffer()"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/netty/netty/pull/4419",children:"#4419"}),' - Fix a bug where DefaultPromise.toString() says "incomplete" when it\'s done']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"By working closely with the projects Armeria depends on, we were able to reduce the burden of maintaining a fork and increase the visibility of Armeria itself and its project members in the open-source community."}),"\n",(0,o.jsx)(t.h2,{id:"please-join-us",children:"Please join us!"}),"\n",(0,o.jsx)(t.p,{children:"Did you find our story about contributing our work to the community and working with other projects interesting?\nArmeria is still in its early stages, and we have various new features in our roadmap, such as:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Client-side load balancing"}),"\n",(0,o.jsx)(t.li,{children:"Large content streaming via reactive streams"}),"\n",(0,o.jsx)(t.li,{children:"Support for more protocols such as Redis and MySQL"}),"\n",(0,o.jsx)(t.li,{children:"Integrated web-based administrative and monitoring console"}),"\n",(0,o.jsx)(t.li,{children:"New Thrift compiler for better documentation and code generation"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"We also have a few more projects in our open-sourcing pipeline and we encourage our engineers to build something that could be useful to more people in the longer term rather than just serving our own immediate purpose.\nPlease apply to join us in building something fascinating that could impress the world!"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"http://recruit.linepluscorp.com/lineplus/career/detail/20000312",children:"Job opening"})," (Scroll down for English)"]}),"\n",(0,o.jsx)(t.h2,{id:"about-the-author",children:"About the author"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://github.com/trustin",children:"Trustin Lee"})," is a platform software engineer at LINE.\nHe is also the founder of ",(0,o.jsx)(t.a,{href:"http://netty.io/",children:"Netty"})," and a co-founder of ",(0,o.jsx)(t.a,{href:"http://mina.apache.org/",children:"Apache MINA"}),"."]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},87757:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/open-sourcing-armeria-1-89b68e7649f79147f589aed590d59639.png"}}]);