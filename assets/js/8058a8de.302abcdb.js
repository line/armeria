"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[6690],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var a=n(96540);const r={},o=a.createContext(r);function i(e){const t=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(o.Provider,{value:t},e.children)}},37759:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"tutorials/rest/implement-delete","title":"Implementing DELETE operation","description":"In this step, we\'ll write a method for deleting a blog post. By completing this step, you\'ll learn to map your service with the HTTP DELETE (@Delete) method, customize an exception handler, and use a blocking task executor.","source":"@site/src/content/docs/tutorials/rest/07-implement-delete.mdx","sourceDirName":"tutorials/rest","slug":"/tutorials/rest/implement-delete","permalink":"/docs/tutorials/rest/implement-delete","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/tutorials/rest/07-implement-delete.mdx","tags":[{"inline":true,"label":"rest","permalink":"/docs/tags/rest"},{"inline":true,"label":"request","permalink":"/docs/tags/request"},{"inline":true,"label":"request-converter","permalink":"/docs/tags/request-converter"},{"inline":true,"label":"exceptions","permalink":"/docs/tags/exceptions"},{"inline":true,"label":"exception-handling","permalink":"/docs/tags/exception-handling"},{"inline":true,"label":"blocking","permalink":"/docs/tags/blocking"}],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_label":"7. Implement DELETE","type":"step","tags":["rest","request","request-converter","exceptions","exception-handling","blocking"],"level":"basic"},"sidebar":"docsSidebar","previous":{"title":"6. Implement UPDATE","permalink":"/docs/tutorials/rest/implement-update"},"next":{"title":"gRPC tutorial introduction","permalink":"/docs/tutorials/grpc/"}}');var r=n(74848),o=n(28453);const i={sidebar_label:"7. Implement DELETE",type:"step",tags:["rest","request","request-converter","exceptions","exception-handling","blocking"],level:"basic"},s="Implementing DELETE operation",l={},c=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Map HTTP method",id:"1-map-http-method",level:2},{value:"2. Handle parameters",id:"2-handle-parameters",level:2},{value:"3. Implement service code",id:"3-implement-service-code",level:2},{value:"Delete a blog post",id:"delete-a-blog-post",level:3},{value:"Handle exceptions",id:"handle-exceptions",level:3},{value:"Add blocking",id:"add-blocking",level:3},{value:"4. Return response",id:"4-return-response",level:2},{value:"5. Test an error case",id:"5-test-an-error-case",level:2},{value:"Next step",id:"next-step",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{TutorialSteps:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"implementing-delete-operation",children:"Implementing DELETE operation"})}),"\n",(0,r.jsxs)(t.p,{children:["In this step, we'll write a method for deleting a blog post. By completing this step, you'll learn to map your service with the HTTP DELETE (",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Delete.html",children:"@Delete"}),") method, customize an exception handler, and use a blocking task executor."]}),"\n",(0,r.jsx)(n,{current:7}),"\n",(0,r.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,r.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,r.jsx)(t.a,{href:"https://github.com/line/armeria-examples/blob/main/tutorials/rest-api-annotated-service/src/main/java/example/armeria/server/blog/",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"Main.java"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"BlogPost.java"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"BlogService.java"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"1-map-http-method",children:"1. Map HTTP method"}),"\n",(0,r.jsxs)(t.p,{children:["Let's start ",(0,r.jsx)(t.a,{href:"/docs/server/annotated-service#mapping-http-service-methods",children:"mapping the HTTP DELETE method"})," with our service method:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Declare a service method, ",(0,r.jsx)(t.code,{children:"deleteBlogPost()"})," in the class ",(0,r.jsx)(t.code,{children:"BlogService"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Map this service method with the HTTP DELETE method by adding the ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Delete.html",children:"@Delete"})," annotation."]}),"\n",(0,r.jsxs)(t.li,{children:["Bind the endpoint ",(0,r.jsx)(t.code,{children:"/blogs"})," to the method."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {6}',children:'import com.linecorp.armeria.server.annotation.Delete;\n\npublic final class BlogService {\n  ...\n\n  @Delete("/blogs")\n  public void deleteBlogPost(int id) {\n    // Delete a blog post\n  }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"2-handle-parameters",children:"2. Handle parameters"}),"\n",(0,r.jsxs)(t.p,{children:["Let's take the blog post ID (",(0,r.jsx)(t.code,{children:"id"}),") as a path parameter for identifying the post to delete."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Take in the ID value as a path parameter by adding ",(0,r.jsx)(t.code,{children:"/blogs/:id"})," to the ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Delete.html",children:"@Delete"})," annotation."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/server/annotated-service#parameter-injection",children:"Inject the path parameter"})," to the service method by annotating the parameter with ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {6}-7',children:'import com.linecorp.armeria.server.annotation.Param;\n\npublic final class BlogService {\n  ...\n\n  @Delete("/blogs/:id")\n  public void deleteBlogPost(@Param int id) {\n    // Delete a blog post\n  }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"3-implement-service-code",children:"3. Implement service code"}),"\n",(0,r.jsx)(t.p,{children:"In this step, write the code to delete a blog post, handle an exception, and block the operation."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"#delete-a-blog-post",children:"Delete a blog post"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"#handle-exceptions",children:"Handle exceptions"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"#add-blocking",children:"Add blocking"})}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"delete-a-blog-post",children:"Delete a blog post"}),"\n",(0,r.jsxs)(t.p,{children:["Deleting a given blog post in this tutorial means removing a blog post from the map, ",(0,r.jsx)(t.code,{children:"blogPosts"}),". However, in real services you would be performing this action on a database."]}),"\n",(0,r.jsxs)(t.p,{children:["To delete a blog post, copy line 3 into the ",(0,r.jsx)(t.code,{children:"deleteBlogPost()"})," method."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.Java" {3} showLineNumbers',children:'@Delete("/blogs/:id")\npublic void deleteBlogPost(@Param int id) {\n  BlogPost removed = blogPosts.remove(id);\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"handle-exceptions",children:"Handle exceptions"}),"\n",(0,r.jsx)(t.p,{children:"What if there is no such post to delete? We can check if the blog exists before attempting to remove the blog post. Here, let's handle it after the attempt."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Throw an ",(0,r.jsx)(t.code,{children:"IllegalArgumentException"})," if no blog post exists with a given ID."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:'@Delete("/blogs/:id")\npublic void deleteBlogPost(@Param int id) {\n  ...\n\n  if (removed == null) {\n    throw new IllegalArgumentException("The blog post does not exist. ID: " + id);\n  }\n}\n'})}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Create an exception handler for the blog service:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Create a file, ",(0,r.jsx)(t.code,{children:"BadRequestExceptionHandler.java"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["In the file, declare a custom exception handler implementing Armeria's ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ExceptionHandlerFunction.html",children:"ExceptionHandlerFunction"})," interface."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BadRequestExceptionHandler.java"',children:"package example.armeria.server.blog;\n\nimport com.linecorp.armeria.server.annotation.ExceptionHandlerFunction;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\npublic class BadRequestExceptionHandler implements ExceptionHandlerFunction {\n  private static final ObjectMapper mapper = new ObjectMapper();\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Implement your own exception handler by overriding the default ",(0,r.jsx)(t.code,{children:"handleException()"})," method. Add a code block for handling the ",(0,r.jsx)(t.code,{children:"IllegalArgumentException"})," thrown. For this tutorial, return a BAD REQUEST as the response."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BadRequesExceptionHandler.java" {11,15,17}',children:'import com.fasterxml.jackson.databind.node.ObjectNode;\nimport com.linecorp.armeria.common.HttpResponse;\nimport com.linecorp.armeria.common.HttpStatus;\nimport com.linecorp.armeria.server.ServiceRequestContext;\n\npublic class BadRequestExceptionHandler implements ExceptionHandlerFunction {\n  ...\n\n  @Override\n  public HttpResponse handleException(ServiceRequestContext ctx, HttpRequest req, Throwable cause) {\n    if (cause instanceof IllegalArgumentException) {\n        String message = cause.getMessage();\n        ObjectNode objectNode = mapper.createObjectNode();\n        objectNode.put("error", message);\n        return HttpResponse.ofJson(HttpStatus.BAD_REQUEST, objectNode);\n    }\n    return ExceptionHandlerFunction.fallthrough();\n  }\n}\n'})}),"\n",(0,r.jsxs)(t.ol,{start:"4",children:["\n",(0,r.jsxs)(t.li,{children:["Assign the exception handler to the ",(0,r.jsx)(t.code,{children:"deleteBlogPost()"})," method by annotating the ",(0,r.jsx)(t.code,{children:"deletePost()"})," method with the ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ExceptionHandler.html",children:"@ExceptionHandler"})," as follows."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {2}',children:'import com.linecorp.armeria.server.annotation.ExceptionHandler;\n\n@Delete("/blogs/:id")\n@ExceptionHandler(BadRequestExceptionHandler.class)\npublic void deleteBlogPost(@Param int id) { ... }\n'})}),"\n",(0,r.jsx)(t.h3,{id:"add-blocking",children:"Add blocking"}),"\n",(0,r.jsxs)(t.p,{children:["With real services, accessing and operating on a database takes time. We need to hand over such blocking tasks to ",(0,r.jsx)(t.a,{href:"/docs/server/annotated-service#specifying-a-blocking-task-executor",children:"blocking task executor"})," so that the EventLoop isn't blocked. There are a few options to implement this; we'll annotate our service method with the ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Blocking.html",children:"@Blocking"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {6}',children:'import com.linecorp.armeria.server.annotation.Blocking;\n\npublic final class BlogService {\n  ...\n\n  @Blocking\n  @Delete("/blogs/:id")\n  @ExceptionHandler(BadRequestExceptionHandler.class)\n  public void deleteBlogPost(@Param int id) { ... }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"4-return-response",children:"4. Return response"}),"\n",(0,r.jsxs)(t.p,{children:["We've already handled returning the not found error in the ",(0,r.jsx)(t.a,{href:"#handle-exceptions",children:"exception handling section"}),". Here, we'll return a response for successful deletion."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Replace the return type of the ",(0,r.jsx)(t.code,{children:"deleteBlogPost()"})," method from ",(0,r.jsx)(t.code,{children:"void"})," to ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpResponse.html",children:"HttpResponse"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Return a response using Armeria's ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpResponse.html",children:"HttpResponse"}),", containing ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpStatus.html#NO_CONTENT",children:"HttpStatus#NO_CONTENT"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {9,11}',children:'import com.linecorp.armeria.common.HttpResponse;\n\npublic final class BlogService {\n  ...\n\n  @Blocking\n  @Delete("/blogs/:id")\n  @ExceptionHandler(BadRequestExceptionHandler.class)\n  public HttpResponse deleteBlogPost(@Param int id) {\n    ...\n    return HttpResponse.of(HttpStatus.NO_CONTENT);\n  }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"5-test-an-error-case",children:"5. Test an error case"}),"\n",(0,r.jsx)(t.p,{children:"Add a test method as follows to test if our exception handler is working properly."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import static org.assertj.core.api.Assertions.assertThat;\n\n@Test\n@Order(5)\nvoid badRequestExceptionHandlerWhenTryingDeleteMissingBlogPost() throws JsonProcessingException {\n    final WebClient client = WebClient.of(server.httpUri());\n    final AggregatedHttpResponse res = client.delete("/blogs/100").aggregate().join();\n    assertThat(res.status()).isSameAs(HttpStatus.BAD_REQUEST);\n    assertThatJson(res.contentUtf8()).isEqualTo("{\\"error\\":\\"The blog post does not exist. ID: 100\\"}");\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,r.jsxs)(t.p,{children:["You can test this also with Armeria's ",(0,r.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"}),". See ",(0,r.jsx)(t.a,{href:"/docs/tutorials/rest/add-services-to-server#using-docservice-after-adding-service-methods",children:"Using DocService after adding service methods"})," for instructions."]}),"\n",(0,r.jsx)(t.h2,{id:"next-step",children:"Next step"}),"\n",(0,r.jsxs)(t.p,{children:["In this step, we've written a method for a DELETE operation and used Armeria's annotations; ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Delete.html",children:"@Delete"}),", ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"}),", ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ExceptionHandler.html",children:"@ExceptionHandler"})," and ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Blocking.html",children:"@Blocking"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"We've come to the end of this tutorial. Next, try adding more service methods to the tutorial or have a go at developing a service of your own."}),"\n",(0,r.jsx)(n,{current:7})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);