"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[6491],{28453:(e,r,a)=>{a.d(r,{R:()=>t,x:()=>l});var i=a(96540);const o={},n=i.createContext(o);function t(e){const r=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(n.Provider,{value:r},e.children)}},98375:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"advanced/flags-provider","title":"Configuring global flags","description":"What flags in Armeria are","source":"@site/src/content/docs/advanced/flags-provider.mdx","sourceDirName":"advanced","slug":"/advanced/flags-provider","permalink":"/docs/advanced/flags-provider","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/advanced/flags-provider.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"ScalaPB integration","permalink":"/docs/advanced/scalapb"},"next":{"title":"Zipkin integration","permalink":"/docs/advanced/zipkin"}}');var o=a(74848),n=a(28453);const t={},l="Configuring global flags",s={},c=[{value:"What flags in Armeria are",id:"what-flags-in-armeria-are",level:2},{value:"Implementing your own FlagsProvider",id:"implementing-your-own-flagsprovider",level:2}];function d(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"configuring-global-flags",children:"Configuring global flags"})}),"\n",(0,o.jsx)(r.h2,{id:"what-flags-in-armeria-are",children:"What flags in Armeria are"}),"\n",(0,o.jsx)(r.p,{children:"Flags are global variables that control the behavior of Armeria.\nThese variables mostly serve one of the following two purposes:"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["Overriding the default system values.","\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#defaultRequestTimeoutMillis()",children:"FlagsProvider#defaultRequestTimeoutMillis()"})," changes the server-side timeout of a request."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#defaultMaxServerNumRequestsPerConnection()",children:"FlagsProvider#defaultMaxServerNumRequestsPerConnection()"})," changes the server-side maximum number of requests\nallowed that can be served concurrently through one connection."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#transportType()",children:"FlagsProvider#transportType()"})," changes the transport type that will be used for socket I/O in Armeria."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#fileServiceCacheSpec()",children:"FlagsProvider#fileServiceCacheSpec()"})," changes the cache specification of ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html",children:"FileService"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["Enhanced debugging or monitoring.","\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#reportBlockedEventLoop()",children:"FlagsProvider#reportBlockedEventLoop()"})," enables to log a warning if blocking calls\nsuch as ",(0,o.jsx)(r.code,{children:"CompletableFuture.join()"})," are called from an event loop thread."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#verboseSocketExceptions()",children:"FlagsProvider#verboseSocketExceptions()"})," enables logging for socket exceptions which are mostly harmless."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#meterRegistry()",children:"FlagsProvider#meterRegistry()"})," changes the default ",(0,o.jsx)(r.code,{children:"MeterRegistry"})," where Armeria records metrics."]}),"\n",(0,o.jsxs)(r.li,{children:["Overriding ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#requestContextLeakDetectionSampler()",children:"FlagsProvider#requestContextLeakDetectionSampler()"})," enables to request context leak tracing by specifying\na ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/util/Sampler.html",children:"Sampler"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"You can also override these properties by setting JVM system properties. For example:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.code,{children:"-Dcom.linecorp.armeria.defaultRequestTimeoutMillis=<long>"})}),"\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.code,{children:"-Dcom.linecorp.armeria.defaultMaxServerNumRequestsPerConnection=<integer>"})}),"\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.code,{children:"-Dcom.linecorp.armeria.reportBlockedEventLoop=<boolean>"})}),"\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.code,{children:"-Dcom.linecorp.armeria.verboseSocketExceptions=<boolean>"})}),"\n"]}),"\n",(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsxs)(r.p,{children:["Please refer to ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html",children:"FlagsProvider"})," for the complete list of global flags."]})}),"\n",(0,o.jsxs)(r.h2,{id:"implementing-your-own-flagsprovider",children:["Implementing your own ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html",children:"FlagsProvider"})]}),"\n",(0,o.jsxs)(r.p,{children:["Create your own ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html",children:"FlagsProvider"})," and load it via ",(0,o.jsx)(r.a,{href:"https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html",children:"Java SPI"}),".\nIf there are multiple implementations of ",(0,o.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html",children:"FlagsProvider"}),", the implementation with the highest priority will take precedence over the others."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",metastring:'title="MyFlagsProvider.java"',children:"package com.example.providers;\n\npublic class MyFlagsProvider implements FlagsProvider {\n\n  @Override\n  public int priority() {\n    // The provider with higher value will be evaluated first.\n    return 100;\n  }\n\n  @Override\n  public Long defaultRequestTimeoutMillis() {\n      return 5000L;\n  }\n\n  @Override\n  public TransportType transportType() {\n      return TransportType.EPOLL;\n  }\n\n  @Override\n  public Boolean reportBlockedEventLoop() {\n      return true;\n  }\n\n  @Override\n  public Sampler<? super RequestContext> requestContextLeakDetectionSampler() {\n      // Samples all request contexts.\n      return Sampler.always();\n  }\n\n  @Override\n  public MeterRegistry meterRegistry() {\n      return PrometheusMeterRegistries.newRegistry();\n  }\n\n}\n"})}),"\n",(0,o.jsx)(r.p,{children:"Add the following text file to your classpath or JAR file."}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-text",metastring:'title="META-INF/services/com.linecorp.armeria.common.FlagsProvider"',children:"com.example.providers.MyFlagsProvider\n"})})]})}function m(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);