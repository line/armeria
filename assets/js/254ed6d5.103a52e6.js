"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[4666],{13207:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"tutorials/grpc/define-service","title":"Defining a blog service and messages","description":"Let\'s begin by defining our gRPC blog service in a proto file.","source":"@site/src/content/docs/tutorials/grpc/01-define-service.mdx","sourceDirName":"tutorials/grpc","slug":"/tutorials/grpc/define-service","permalink":"/docs/tutorials/grpc/define-service","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/tutorials/grpc/01-define-service.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"1. Define a service","type":"step","targetLang":"java"},"sidebar":"docsSidebar","previous":{"title":"gRPC tutorial introduction","permalink":"/docs/tutorials/grpc/"},"next":{"title":"2. Run a service","permalink":"/docs/tutorials/grpc/run-service"}}');var s=o(74848),n=o(28453);const i={sidebar_label:"1. Define a service",type:"step",targetLang:"java"},l="Defining a blog service and messages",a={},d=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Create a proto file",id:"1-create-a-proto-file",level:2},{value:"2. Define a blog post",id:"2-define-a-blog-post",level:2},{value:"3. Add service methods",id:"3-add-service-methods",level:2},{value:"4. Add request types",id:"4-add-request-types",level:2},{value:"5. Add a response type",id:"5-add-a-response-type",level:2},{value:"6. Compile the proto file",id:"6-compile-the-proto-file",level:2},{value:"Next step",id:"next-step",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,n.R)(),...e.components},{TutorialSteps:o}=t;return o||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"defining-a-blog-service-and-messages",children:"Defining a blog service and messages"})}),"\n",(0,s.jsx)(t.p,{children:"Let's begin by defining our gRPC blog service in a proto file."}),"\n",(0,s.jsx)(o,{current:1}),"\n",(0,s.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,s.jsxs)(t.p,{children:["No preparation is required for this step. Do check that you've prepared the ",(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/#prerequisites",children:"prerequisites"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"1-create-a-proto-file",children:"1. Create a proto file"}),"\n",(0,s.jsxs)(t.p,{children:["Create a file, ",(0,s.jsx)(t.code,{children:"blog.proto"})," inside the directory, ",(0,s.jsx)(t.code,{children:"{project_root}/src/main/proto"}),". This tutorial uses ",(0,s.jsx)(t.a,{href:"https://developers.google.com/protocol-buffers/docs/proto3",children:"Protocol Buffers version 3"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-protobuf",metastring:'title="blog.proto"',children:'syntax = "proto3";\n\npackage example.armeria.blog.grpc;\noption java_package = "example.armeria.blog.grpc";\noption java_multiple_files = true;\n'})}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc#sample-service",children:"Sample service structure"})," for the overall folder structure."]})}),"\n",(0,s.jsx)(t.h2,{id:"2-define-a-blog-post",children:"2. Define a blog post"}),"\n",(0,s.jsxs)(t.p,{children:["In the proto file, define the ",(0,s.jsx)(t.code,{children:"BlogPost"})," message type with minimal data."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-protobuf",metastring:'title="blog.proto"',children:"message BlogPost {\n  int32 id = 1;\n  string title = 2;\n  string content = 3;\n  int64 createdAt = 4;\n  int64 modifiedAt = 5;\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"3-add-service-methods",children:"3. Add service methods"}),"\n",(0,s.jsx)(t.p,{children:"Add service methods to the blog service. We have two methods for retrieving blog posts; one is for retrieving a single post and another for multiple posts."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["The APIs are designed based on the ",(0,s.jsx)(t.a,{href:"https://google.aip.dev/general",children:"Google's API design decisions"}),"."]})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-protobuf",metastring:'title="blog.proto"',children:'import "google/protobuf/empty.proto";\n\nservice BlogService {\n  rpc CreateBlogPost (CreateBlogPostRequest) returns (BlogPost) {}\n  rpc GetBlogPost (GetBlogPostRequest) returns (BlogPost) {}\n  rpc ListBlogPosts (ListBlogPostsRequest) returns (ListBlogPostsResponse) {}\n  rpc UpdateBlogPost (UpdateBlogPostRequest) returns (BlogPost) {}\n  rpc DeleteBlogPost (DeleteBlogPostRequest) returns (google.protobuf.Empty) {}\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"4-add-request-types",children:"4. Add request types"}),"\n",(0,s.jsx)(t.p,{children:"Add request types for create, retrieve, update, and delete operations."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-protobuf",metastring:'title="blog.proto"',children:"message CreateBlogPostRequest {\n  string title = 1;\n  string content = 2;\n}\n\nmessage GetBlogPostRequest {    // For retrieving a single post\n  int32 id = 1;\n}\n\nmessage ListBlogPostsRequest {  // For retrieving multiple posts\n  bool descending = 1;\n}\n\nmessage UpdateBlogPostRequest {\n  int32 id = 1;\n  string title = 2;\n  string content = 3;\n}\n\nmessage DeleteBlogPostRequest {\n  int32 id = 1;\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"5-add-a-response-type",children:"5. Add a response type"}),"\n",(0,s.jsx)(t.p,{children:"Add a response type to return multiple blog posts."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-protobuf",metastring:'title="blog.proto"',children:"message ListBlogPostsResponse {\n    repeated BlogPost blogs = 1;\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"6-compile-the-proto-file",children:"6. Compile the proto file"}),"\n",(0,s.jsxs)(t.p,{children:["Compile the ",(0,s.jsx)(t.code,{children:"blog.proto"})," file to generate Java code.\nYou can refer to the full ",(0,s.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/grpc/build.gradle",children:"build.gradle"})," file for generating code with ",(0,s.jsx)(t.a,{href:"https://github.com/google/protobuf-gradle-plugin",children:"protobuf-gradle-plugin"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"./gradlew generateProto\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You'll see the generated Java code in the ",(0,s.jsx)(t.code,{children:"{project_root}/build/generated/source/proto/main"})," folder."]}),"\n",(0,s.jsx)(t.h2,{id:"next-step",children:"Next step"}),"\n",(0,s.jsxs)(t.p,{children:["In this step, we've defined a proto file for our service and generated Java code. Next, we'll ",(0,s.jsx)(t.a,{href:"/docs/tutorials/grpc/run-service",children:"run a service"})," and test the connection."]}),"\n",(0,s.jsx)(o,{current:1})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>i,x:()=>l});var r=o(96540);const s={},n=r.createContext(s);function i(e){const t=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);