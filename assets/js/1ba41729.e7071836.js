"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[4118],{28453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var i=n(96540);const t={},c=i.createContext(t);function a(e){const r=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(c.Provider,{value:r},e.children)}},67706:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"advanced/production-checklist","title":"Production checklist","description":"Note that the advice on this page is not always applicable for every use case and thus should be","source":"@site/src/content/docs/advanced/production-checklist.mdx","sourceDirName":"advanced","slug":"/advanced/production-checklist","permalink":"/docs/advanced/production-checklist","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/advanced/production-checklist.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Unit-testing Client and Service","permalink":"/docs/advanced/unit-testing"},"next":{"title":"SAML Single Sign-On","permalink":"/docs/advanced/saml"}}');var t=n(74848),c=n(28453);const a={},o="Production checklist",l={},s=[];function d(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"production-checklist",children:"Production checklist"})}),"\n",(0,t.jsx)(r.admonition,{type:"warning",children:(0,t.jsx)(r.p,{children:"Note that the advice on this page is not always applicable for every use case and thus should be\napplied with caution. Do not apply the changes you really do not need."})}),"\n",(0,t.jsx)(r.p,{children:"You may want to consider the following options before putting your Armeria application into production."}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Specify the maximum number of accepted connections. The default is ",(0,t.jsx)(r.em,{children:"unbounded"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.ServerBuilder;\n\nServerBuilder sb = Server.builder();\nsb.maxNumConnections(500);\n"})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Specify an alternative ",(0,t.jsx)(r.code,{children:"blockingTaskExecutor"})," based on expected workload if your server has\na service that uses it, such as ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/tomcat/TomcatService.html",children:"TomcatService"}),", ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/jetty/JettyService.html",children:"JettyService"})," and ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/thrift/THttpService.html",children:"THttpService"})," with\nsynchronous service implementation. The default is a simple ",(0,t.jsx)(r.code,{children:"ScheduledThreadPoolExecutor"})," with maximum\n200 threads, provided by ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/CommonPools.html",children:"CommonPools"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import com.linecorp.armeria.server.ServerBuilder;\n\nServerBuilder sb = Server.builder();\nsb.blockingTaskExecutor(myScheduledExecutorService);\n"})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"Specify the default limits of an HTTP request or response."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import java.time.Duration;\nimport com.linecorp.armeria.client.ClientBuilder;\nimport com.linecorp.armeria.server.ServerBuilder;\n\n// Server-side\nServerBuilder sb = Server.builder();\nsb.maxRequestLength(1048576); // bytes (default: 10 MiB)\nsb.requestTimeout(Duration.ofSeconds(7)); // (default: 10 seconds)\n\n// Client-side\nClientBuilder cb = Clients.builder(...); // or WebClient.builder(...)\ncb.maxResponseLength(1048576); // bytes (default: 10 MiB)\ncb.responseTimeout(Duration.ofSeconds(10)); // (default: 15 seconds)\n"})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Decorate your services with ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/throttling/ThrottlingService.html",children:"ThrottlingService"})," which lets you fail the incoming requests based on a\npolicy, such as 'fail if the rate of requests exceed a certain threshold."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.throttling.ThrottlingService;\nimport com.linecorp.armeria.server.throttling.ThrottlingStrategy;\n\nServerBuilder sb = Server.builder();\nsb.service("/my_service", // Allow up to 1000 requests/sec.\n           myService.decorate(ThrottlingService.newDecorator(\n                   ThrottlingStrategy.rateLimiting(1000.0))));\n'})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Decorate your clients with ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html",children:"RetryingClient"}),". See ",(0,t.jsx)(r.a,{href:"/docs/client/retry",children:"Automatic retry"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Decorate your clients with ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerClient.html",children:"CircuitBreakerClient"}),". See ",(0,t.jsx)(r.a,{href:"/docs/client/circuit-breaker",children:"Circuit breaker"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["You can use Armeria's ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/CircuitBreaker.html",children:"CircuitBreaker"})," API for non-Armeria clients without circuit breaker support.\nSee ",(0,t.jsx)(r.a,{href:"/docs/client/circuit-breaker#using-circuitbreaker-with-non-armeria-client",children:"Using CircuitBreaker with non-Armeria client"}),"."]})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"Tune the socket options."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import com.linecorp.armeria.client.ClientBuilder;\nimport com.linecorp.armeria.client.ClientFactory;\nimport com.linecorp.armeria.client.ClientFactoryBuilder;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport io.netty.channel.ChannelOption;\n\n// Server-side\nServerBuilder sb = Server.builder();\nsb.channelOption(ChannelOption.SO_BACKLOG, ...);\nsb.channelOption(ChannelOption.SO_REUSEADDR, ...);\nsb.childChannelOption(ChannelOption.SO_SNDBUF, ...);\nsb.childChannelOption(ChannelOption.SO_RCVBUF, ...);\n\n// Client-side\nClientFactoryBuilder cfb = ClientFactory.builder();\ncfb.channelOption(ChannelOption.SO_REUSEADDR, ...);\ncfb.channelOption(ChannelOption.SO_SNDBUF, ...);\ncfb.channelOption(ChannelOption.SO_RCVBUF, ...);\nClientFactory cf = cfb.build();\nClientBuilder cb = Clients.builder(...);\ncb.factory(cf);\n"})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Consider increasing ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactoryBuilder.html#maxNumEventLoopsPerEndpoint(int)",children:"ClientFactoryBuilder#maxNumEventLoopsPerEndpoint(int)"}),"\nand ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactoryBuilder.html#maxNumEventLoopsPerHttp1Endpoint(int)",children:"ClientFactoryBuilder#maxNumEventLoopsPerHttp1Endpoint(int)"})," when a\nclient needs to send a large number of requests to a specific endpoint. The client\nwill assign more CPU resources and create more connections by increasing the number\nof event loops up to the quantity in ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html#eventLoopGroup()",children:"ClientFactory#eventLoopGroup()"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"import com.linecorp.armeria.client.Clients;\nimport com.linecorp.armeria.client.ClientBuilder;\nimport com.linecorp.armeria.client.ClientFactory;\nimport com.linecorp.armeria.client.ClientFactoryBuilder;\n\nClientFactoryBuilder cfb = ClientFactory.builder();\ncfb.maxNumEventLoopsPerEndpoint(16); // default: 1\ncfb.maxNumEventLoopsPerHttp1Endpoint(16); // default: 1\nClientFactory cf = cfb.build();\nClientBuilder cb = Clients.builder(...);\ncb.factory(cf);\n"})}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);