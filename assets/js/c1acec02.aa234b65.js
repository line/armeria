"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[1677],{28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>r});var n=s(96540);const o={},l=n.createContext(o);function i(e){const t=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(l.Provider,{value:t},e.children)}},76674:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"tutorials/thrift/implement-read","title":"Implementing READ operation","description":"In the earlier step, we created blog posts.","source":"@site/src/content/docs/tutorials/thrift/04-implement-read.mdx","sourceDirName":"tutorials/thrift","slug":"/tutorials/thrift/implement-read","permalink":"/docs/tutorials/thrift/implement-read","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/tutorials/thrift/04-implement-read.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_label":"4. Implement READ","type":"step","category":"thrift","tags":["server"],"level":"basic"},"sidebar":"docsSidebar","previous":{"title":"3. Implement CREATE","permalink":"/docs/tutorials/thrift/implement-create"},"next":{"title":"5. Implement UPDATE","permalink":"/docs/tutorials/thrift/implement-update"}}');var o=s(74848),l=s(28453);const i={sidebar_label:"4. Implement READ",type:"step",category:"thrift",tags:["server"],level:"basic"},r="Implementing READ operation",a={},d=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"2. Implement client-side",id:"2-implement-client-side",level:2},{value:"3. Test retrieving a single post",id:"3-test-retrieving-a-single-post",level:2},{value:"4. Test an error case",id:"4-test-an-error-case",level:2},{value:"5. Test retrieving multiple posts",id:"5-test-retrieving-multiple-posts",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components},{TabItem:s,Tabs:n,TutorialSteps:i}=t;return s||g("TabItem",!0),n||g("Tabs",!0),i||g("TutorialSteps",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"implementing-read-operation",children:"Implementing READ operation"})}),"\n",(0,o.jsx)(t.p,{children:"In the earlier step, we created blog posts.\nIn this step, we'll implement a read operation and make a call to read blog posts.\nWe'll write two service methods, one for reading a single post and another for multiple posts."}),"\n",(0,o.jsx)(i,{current:4}),"\n",(0,o.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,o.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,o.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/thrift",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/docs/tutorials/thrift/define-service#3-compile-the-thrift-file",children:"Generated Java code"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"BlogServiceImpl.java"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"Main.java"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"BlogClient.java"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,o.jsx)(t.p,{children:"Let's write two methods for retrieving blog posts; one for a single post and another for multiple posts."}),"\n",(0,o.jsxs)(n,{groupId:"thrift-read",children:[(0,o.jsxs)(s,{label:"Single post",value:"1",children:[(0,o.jsxs)(t.p,{children:["In the ",(0,o.jsx)(t.code,{children:"BlogServiceImpl"})," class, implement the ",(0,o.jsx)(t.code,{children:"getBlogPost()"})," method to retrieve a single post.\nLet's throw an exception in case there is no blog post for the given ID."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceImpl.java"',children:'import example.armeria.blog.thrift.BlogNotFoundException;\n...\n@Override\npublic void getBlogPost(GetBlogPostRequest request, AsyncMethodCallback<BlogPost> resultHandler)\n        throws TException {\n  final BlogPost blogPost = blogPosts.get(request.getId());\n  if (blogPost == null) {\n    // throwing an exception will also have the same effect\n    // throw new BlogNotFoundException("The blog post does not exist. ID: " + request.getId());\n    resultHandler.onError(\n            new BlogNotFoundException("The blog post does not exist. ID: " + request.getId()));\n  } else {\n    resultHandler.onComplete(blogPost);\n  }\n}\n'})})]}),(0,o.jsxs)(s,{label:"Multiple posts",value:"2",children:[(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Implement the ",(0,o.jsx)(t.code,{children:"listBlogPosts()"})," method in the ",(0,o.jsx)(t.code,{children:"BlogServiceImpl"})," class to retrieve multiple posts."]}),"\n"]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceImpl.java"',children:"import java.util.List;\nimport java.util.stream.Collectors;\n...\n@Override\npublic void listBlogPosts(ListBlogPostsRequest request,\n                          AsyncMethodCallback<ListBlogPostsResponse> resultHandler) throws TException {\n  final List<BlogPost> blogPosts = this.blogPosts.values().stream().collect(Collectors.toList());\n  resultHandler.onComplete(new ListBlogPostsResponse().setBlogs(blogPosts));\n}\n"})}),(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsxs)(t.li,{children:["Add an if-else statement by adding line 9-16, to sort the blog posts based on the value of the ",(0,o.jsx)(t.code,{children:"descending"})," parameter."]}),"\n"]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceImpl.java" showLineNumbers',children:"import java.util.Collections;\nimport java.util.Comparator;\nimport java.util.Map.Entry;\n...\n@Override\npublic void listBlogPosts(ListBlogPostsRequest request,\n                          AsyncMethodCallback<ListBlogPostsResponse> resultHandler) throws TException {\n  final List<BlogPost> blogPosts;\n  if (request.isDescending()) {\n    blogPosts = this.blogPosts.entrySet()\n                              .stream()\n                              .sorted(Collections.reverseOrder(Comparator.comparingInt(Entry::getKey)))\n                              .map(Entry::getValue).collect(Collectors.toList());\n  } else {\n    blogPosts = this.blogPosts.values().stream().collect(Collectors.toList());\n  }\n  resultHandler.onComplete(new ListBlogPostsResponse().setBlogs(blogPosts));\n}\n"})})]})]}),"\n",(0,o.jsx)(t.h2,{id:"2-implement-client-side",children:"2. Implement client-side"}),"\n",(0,o.jsx)(t.p,{children:"This time, we'll implement the client-side for reading blog posts.\nLet's implement client methods for each corresponding server method."}),"\n",(0,o.jsxs)(n,{groupId:"thrift-read",children:[(0,o.jsxs)(s,{label:"Single post",value:"1",children:[(0,o.jsxs)(t.p,{children:["In the ",(0,o.jsx)(t.code,{children:"BlogClient"})," class, add a method to retrieve a single post."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogClient.java"',children:"import example.armeria.blog.thrift.GetBlogPostRequest;\n...\nBlogPost getBlogPost(int id) throws TException {\n  final GetBlogPostRequest request =\n              new GetBlogPostRequest().setId(id);\n  return blogService.getBlogPost(request);\n}\n"})})]}),(0,o.jsxs)(s,{label:"Multiple posts",value:"2",children:[(0,o.jsxs)(t.p,{children:["In the ",(0,o.jsx)(t.code,{children:"BlogClient"})," class, add a method to retrieve a list of posts."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogClient.java"',children:"import example.armeria.blog.thrift.ListBlogPostsRequest;\nimport example.armeria.blog.thrift.ListBlogPostsResponse;\n...\nList<BlogPost> listBlogPosts(boolean descending) throws TException {\n  return blogService.listBlogPosts(new ListBlogPostsRequest().setDescending(descending))\n                    .getBlogs();\n}\n"})})]})]}),"\n",(0,o.jsx)(t.h2,{id:"3-test-retrieving-a-single-post",children:"3. Test retrieving a single post"}),"\n",(0,o.jsx)(t.p,{children:"Let's test if we can retrieve a blog post we created."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["In the ",(0,o.jsx)(t.code,{children:"BlogServiceTest"})," class, add a test method to retrieve the first blog post with ID ",(0,o.jsx)(t.code,{children:"0"}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\nvoid getBlogPost() throws TException {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  final BlogPost blogPost = client.getBlogPost(0);\n\n  assertThat(blogPost.getTitle()).isEqualTo("My first blog");\n  assertThat(blogPost.getContent()).isEqualTo("Hello Armeria!");\n}\n'})}),"\n",(0,o.jsxs)(t.ol,{start:"2",children:["\n",(0,o.jsxs)(t.li,{children:["Add annotations to configure the order our test methods will be executed.\nThe annotations guarantee that the first blog post will be created in the ",(0,o.jsx)(t.code,{children:"createBlogPost()"})," method before we try to retrieve it in the ",(0,o.jsx)(t.code,{children:"getBlogPost()"})," method."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;\nimport org.junit.jupiter.api.Order;\nimport org.junit.jupiter.api.TestMethodOrder;\n\n@TestMethodOrder(OrderAnnotation.class) // Add this\nclass BlogServiceTest {\n  ...\n\n  @Test\n  @Order(1) // Add this\n  void createBlogPost() throws TException {\n    ...\n  }\n\n  @Test\n  @Order(2) // Add this\n  void getBlogPost() throws TException {\n    ...\n  }\n}\n"})}),"\n",(0,o.jsxs)(t.ol,{start:"3",children:["\n",(0,o.jsx)(t.li,{children:"Run all the test cases on your IDE or using Gradle."}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Your client retrieved a blog post from the server successfully if the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"4-test-an-error-case",children:"4. Test an error case"}),"\n",(0,o.jsx)(t.p,{children:"Let's try retrieving a blog post that does not exist.\nAdd a test method to retrieve a blog post with an invalid ID, asserting an exception is thrown."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import static org.assertj.core.api.Assertions.catchThrowable;\nimport example.armeria.blog.thrift.BlogNotFoundException;\n...\n@Test\n@Order(3)\nvoid getInvalidBlogPost() {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  final Throwable exception = catchThrowable(() -> {\n    client.getBlogPost(Integer.MAX_VALUE);\n  });\n  assertThat(exception)\n    .isInstanceOf(BlogNotFoundException.class)\n    .extracting("reason")\n    .asString()\n    .isEqualTo("The blog post does not exist. ID: " + Integer.MAX_VALUE);\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"5-test-retrieving-multiple-posts",children:"5. Test retrieving multiple posts"}),"\n",(0,o.jsx)(t.p,{children:"Finally, let's test if we can retrieve multiple posts.\nAdd a test method like the following to create the second blog post and test retrieving the list of blog posts."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import java.util.List;\n...\n@Test\n@Order(4)\nvoid listBlogPosts() throws TException {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  client.createBlogPost("My second blog", "Armeria is awesome!");\n\n  final List<BlogPost> blogs = client.listBlogPosts(false);\n  assertThat(blogs).hasSize(2);\n  final BlogPost firstBlog = blogs.get(0);\n  assertThat(firstBlog.getTitle()).isEqualTo("My first blog");\n  assertThat(firstBlog.getContent()).isEqualTo("Hello Armeria!");\n\n  final BlogPost secondBlog = blogs.get(1);\n  assertThat(secondBlog.getTitle()).isEqualTo("My second blog");\n  assertThat(secondBlog.getContent()).isEqualTo("Armeria is awesome!");\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,o.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,o.jsx)(t.p,{children:"In this step, we've implemented service methods and client methods to retrieve blog posts."}),"\n",(0,o.jsxs)(t.p,{children:["Next, at ",(0,o.jsx)(t.a,{href:"/docs/tutorials/thrift/implement-update",children:"Step 5. Implement UPDATE"}),", we'll implement an UPDATE operation to update a blog post."]}),"\n",(0,o.jsx)(i,{current:4})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}function g(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);