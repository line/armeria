"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[5214],{9193:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"advanced/understanding-timeouts","title":"Understanding timeout and cancellation origins","description":"When working with Armeria\'s timeout mechanisms, it\'s important to understand that timeouts and cancellations","source":"@site/src/content/docs/advanced/understanding-timeouts.mdx","sourceDirName":"advanced","slug":"/advanced/understanding-timeouts","permalink":"/docs/advanced/understanding-timeouts","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/advanced/understanding-timeouts.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Request Context","permalink":"/docs/advanced/request-context"},"next":{"title":"Sending a streaming response with back pressure","permalink":"/docs/advanced/streaming-backpressure"}}');var r=t(74848),s=t(28453);const o={},a="Understanding timeout and cancellation origins",c={},l=[{value:"Timeout origins",id:"timeout-origins",level:2},{value:"Client perspective",id:"client-perspective",level:3},{value:"Server perspective",id:"server-perspective",level:3},{value:"Cancellation propagation",id:"cancellation-propagation",level:2},{value:"Client-to-server cancellation",id:"client-to-server-cancellation",level:3},{value:"Server-to-client timeout notification",id:"server-to-client-timeout-notification",level:3},{value:"Debugging timeout issues",id:"debugging-timeout-issues",level:2},{value:"Related documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"understanding-timeout-and-cancellation-origins",children:"Understanding timeout and cancellation origins"})}),"\n",(0,r.jsx)(n.p,{children:"When working with Armeria's timeout mechanisms, it's important to understand that timeouts and cancellations\ncan originate from either the client or server side, and these signals propagate between them. This page\nexplains how timeout and cancellation signals flow between clients and servers."}),"\n",(0,r.jsx)(n.h2,{id:"timeout-origins",children:"Timeout origins"}),"\n",(0,r.jsx)(n.h3,{id:"client-perspective",children:"Client perspective"}),"\n",(0,r.jsxs)(n.p,{children:["When a client receives a timeout-related error, the timeout may not have originated on the client side.\nA ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html",children:"ResponseTimeoutException"})," on the client can occur in two scenarios:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client-side timeout"}),": The client's response timeout expired before receiving a complete response."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server-side timeout"}),": The server's request timeout expired, and the server sent a ",(0,r.jsx)(n.code,{children:"503 Service Unavailable"}),"\nresponse (or closed the connection), which the client then receives as an error."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["By default, Armeria configures the client response timeout (15 seconds) to be slightly greater than the\nserver request timeout (10 seconds). This ensures that when a server-side timeout occurs, the client\nreceives a proper ",(0,r.jsx)(n.code,{children:"503 Service Unavailable"})," response rather than experiencing its own timeout first."]}),"\n",(0,r.jsx)(n.h3,{id:"server-perspective",children:"Server perspective"}),"\n",(0,r.jsxs)(n.p,{children:["When a server experiences a request cancellation, the cancellation may not have originated on the server side.\nA ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/RequestTimeoutException.html",children:"RequestTimeoutException"})," or request cancellation on the server can occur\nin multiple scenarios:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server-side timeout"}),": The server's request timeout expired before the response was fully sent.\nThis results in a ",(0,r.jsx)(n.code,{children:"503 Service Unavailable"})," response being sent to the client."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client-side cancellation"}),": The client cancelled the request (e.g., due to its own response timeout,\nuser action, or connection closure), and this cancellation propagated back to the server."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"cancellation-propagation",children:"Cancellation propagation"}),"\n",(0,r.jsx)(n.h3,{id:"client-to-server-cancellation",children:"Client-to-server cancellation"}),"\n",(0,r.jsxs)(n.p,{children:["When a client cancels a request (due to timeout, user action, or any other reason), the cancellation is\npropagated to the server. This applies to ",(0,r.jsx)(n.strong,{children:"both unary (request-response) and streaming calls"})," as long as\nthe underlying connection/stream is still open:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"HTTP/2"}),": The client sends an ",(0,r.jsx)(n.code,{children:"RST_STREAM"})," frame with the ",(0,r.jsx)(n.code,{children:"CANCEL"})," error code to notify the server.\nThe server receives this as a ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/stream/ClosedStreamException.html",children:"ClosedStreamException"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"HTTP/1.1"}),": The client closes the connection, which the server detects as a closed session,\nresulting in a ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/ClosedSessionException.html",children:"ClosedSessionException"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This propagation allows the server to stop processing the request early and free up resources. For example,\nif a client times out while waiting for a slow database query, the server can detect the cancellation and\nabort the query instead of completing unnecessary work."}),"\n",(0,r.jsx)(n.h3,{id:"server-to-client-timeout-notification",children:"Server-to-client timeout notification"}),"\n",(0,r.jsxs)(n.p,{children:["When a server-side timeout occurs, the server sends a ",(0,r.jsx)(n.code,{children:"503 Service Unavailable"})," response to the client\n(if the response headers haven't been sent yet) or closes the connection/stream. The client then receives\nthis as an error, which may appear as a ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html",children:"ResponseTimeoutException"})," or\nconnection-related exception depending on the timing."]}),"\n",(0,r.jsx)(n.h2,{id:"debugging-timeout-issues",children:"Debugging timeout issues"}),"\n",(0,r.jsx)(n.p,{children:"Due to Armeria's highly asynchronous nature, it can be challenging to determine whether a timeout or\ncancellation was initiated by the client or server side."}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["When debugging timeout issues, set a breakpoint in\n",(0,r.jsx)(n.code,{children:"com.linecorp.armeria.internal.common.DefaultCancellationScheduler#invokeTask"})," to determine where the\ncancellation was initiated. This is often the most reliable way to trace the origin of a timeout or\ncancellation."]})}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/client/timeouts",children:"Overriding client timeouts"})," - Configure client-side timeout settings"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/server/timeouts",children:"Configuring server timeouts"})," - Configure server-side timeout settings"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/advanced/request-context#timeout-control",children:"Timeout control"})," - Dynamically adjust timeouts using\n",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/util/TimeoutMode.html",children:"TimeoutMode"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);