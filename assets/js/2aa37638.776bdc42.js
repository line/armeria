"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[2762],{28453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>c});var n=a(96540);const r={},i=n.createContext(r);function s(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:t},e.children)}},75887:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"advanced/custom-attributes","title":"RequestContext custom attributes","description":"When you are using multiple decorators, you might want to pass some value to the next decorator.","source":"@site/src/content/docs/advanced/custom-attributes.mdx","sourceDirName":"advanced","slug":"/advanced/custom-attributes","permalink":"/docs/advanced/custom-attributes","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/advanced/custom-attributes.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Structured logging","permalink":"/docs/advanced/structured-logging"},"next":{"title":"Sending a streaming response with back pressure","permalink":"/docs/advanced/streaming-backpressure"}}');var r=a(74848),i=a(28453);const s={},c="RequestContext custom attributes",o={},l=[{value:"Setting attributes using WebClientRequestPreparation",id:"setting-attributes-using-webclientrequestpreparation",level:2},{value:"Setting attributes using RequestOptions",id:"setting-attributes-using-requestoptions",level:2}];function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsxs)(t.h1,{id:"requestcontext-custom-attributes",children:[(0,r.jsx)(t.code,{children:"RequestContext"})," custom attributes"]})}),"\n",(0,r.jsxs)(t.p,{children:["When you are using multiple decorators, you might want to pass some value to the next decorator.\nYou can do this by attaching attributes to a ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/RequestContext.html",children:"RequestContext"}),". To attach an attribute,\nyou need to define an ",(0,r.jsx)(t.code,{children:"AttributeKey"})," first:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'import io.netty.util.AttributeKey;\n\npublic final class MyAttributeKeys {\n    public static final AttributeKey<Integer> INT_ATTR =\n            AttributeKey.valueOf(MyAttributeKeys.class, "INT_ATTR");\n    public static final AttributeKey<MyBean> BEAN_ATTR =\n            AttributeKey.valueOf(MyAttributeKeys.class, "BEAN_ATTR");\n    ...\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Then, you can access them via ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/RequestContext.html#attr(io.netty.util.AttributeKey)",children:"RequestContext#attr(AttributeKey)"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"// Setting\nctx.setAttr(INT_ATTR, 42);\nMyBean myBean = new MyBean();\nctx.setAttr(BEAN_ATTR, new MyBean());\n\n// Getting\nInteger i = ctx.attr(INT_ATTR); // i == 42\nMyBean bean = ctx.attr(BEAN_ATTR); // bean == myBean\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You can also iterate over all the attributes in a context using ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/RequestContext.html#attrs()",children:"RequestContext#attrs()"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'ctx.attrs().forEachRemaining(e -> {\n    System.err.println(e.getKey() + ": " + e.getValue());\n});\n'})}),"\n",(0,r.jsxs)(t.h2,{id:"setting-attributes-using-webclientrequestpreparation",children:["Setting attributes using ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClientRequestPreparation.html",children:"WebClientRequestPreparation"})]}),"\n",(0,r.jsxs)(t.p,{children:["You can set attributes when building a request using ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html#prepare()",children:"WebClient#prepare()"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'import com.linecorp.armeria.client.WebClient;\n\nstatic final AttributeKey<Integer> USER_ID = AttributeKey.valueOf(MyAttributeKeys.class, "USER_ID");\nstatic final AttributeKey<String> USER_SECRET = AttributeKey.valueOf(MyAttributeKeys.class, "USER_SECRET");\n\nWebClient client = WebClient.of("http://example.com");\nclient.prepare()\n      .get("/my-service")\n      .attr(USER_ID, userId)\n      .attr(USER_SECRET, secret)\n      .execute();\n'})}),"\n",(0,r.jsxs)(t.h2,{id:"setting-attributes-using-requestoptions",children:["Setting attributes using ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})]}),"\n",(0,r.jsxs)(t.p,{children:["You can also create a ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})," and pass it\nto ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html#execute(com.linecorp.armeria.common.HttpRequest,com.linecorp.armeria.client.RequestOptions)?full",children:"WebClient#execute(HttpRequest,RequestOptions)"})," with an ",(0,r.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpRequest.html",children:"HttpRequest"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'import com.linecorp.armeria.client.RequestOptions;\nimport com.linecorp.armeria.common.HttpRequest;\n\nHttpRequest req = HttpRequest.of(HttpMethod.GET, "/my-service");\nRequestOptions options = RequestOptions.builder()\n                                       .attr(USER_ID, userId)\n                                       .attr(USER_SECRET, secret)\n                                       .build();\nclient.execute(req, options);\n'})})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);