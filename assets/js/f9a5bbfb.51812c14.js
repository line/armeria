"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[3874],{1241:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_thrift_docservice_start-5ac4fe9369d2cdf66ecb60cd196df973.png"},5082:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tutorials/thrift/implement-delete","title":"Implementing DELETE operation","description":"So far, we created, read, and updated a blog post.","source":"@site/src/content/docs/tutorials/thrift/06-implement-delete.mdx","sourceDirName":"tutorials/thrift","slug":"/tutorials/thrift/implement-delete","permalink":"/docs/tutorials/thrift/implement-delete","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/tutorials/thrift/06-implement-delete.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_label":"6. Implement DELETE","category":"thrift","tags":["server"],"level":"basic","type":"step"},"sidebar":"docsSidebar","previous":{"title":"5. Implement UPDATE","permalink":"/docs/tutorials/thrift/implement-update"}}');var s=n(74848),i=n(28453);const o={sidebar_label:"6. Implement DELETE",category:"thrift",tags:["server"],level:"basic",type:"step"},l="Implementing DELETE operation",a={},c=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"2. Implement client-side",id:"2-implement-client-side",level:2},{value:"3. Test deleting a blog post",id:"3-test-deleting-a-blog-post",level:2},{value:"4. Test an error case",id:"4-test-an-error-case",level:2},{value:"5. Add the Documentation service",id:"5-add-the-documentation-service",level:2},{value:"6. Check the DocService page",id:"6-check-the-docservice-page",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{TutorialSteps:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"implementing-delete-operation",children:"Implementing DELETE operation"})}),"\n",(0,s.jsxs)(t.p,{children:["So far, we created, read, and updated a blog post.\nNow, let's implement and make a call to delete a blog post.\nAlso, we'll add Armeria's ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation Service"})," for testing our blog service."]}),"\n",(0,s.jsx)(r,{current:6}),"\n",(0,s.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,s.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,s.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/thrift",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/docs/tutorials/thrift/define-service#3-compile-the-thrift-file",children:"Generated Java code"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogServiceImpl.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"Main.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogClient.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BlogServiceExceptionHandler.java"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"BlogServiceImpl"})," class, implement the ",(0,s.jsx)(t.code,{children:"deleteBlogPost()"})," method to delete a blog post.\nLet's throw an exception in case there is no blog post for the given ID."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceImpl.java"',children:'@Override\npublic void deleteBlogPost(DeleteBlogPostRequest request, AsyncMethodCallback<Void> resultHandler)\n      throws TException {\n  final BlogPost removed = blogPosts.remove(request.getId());\n  if (removed == null) {\n    resultHandler.onError(\n            new IllegalArgumentException("The blog post does not exist. ID: " + request.getId()));\n  } else {\n    resultHandler.onComplete(null);\n  }\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"2-implement-client-side",children:"2. Implement client-side"}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"BlogClient"})," class, add the ",(0,s.jsx)(t.code,{children:"deleteBlogPost()"})," method to send a request deleting a blog post."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogClient.java"',children:"import example.armeria.blog.thrift.DeleteBlogPostRequest;\n...\nvoid deleteBlogPost(int id) throws TException {\n  final DeleteBlogPostRequest request = new DeleteBlogPostRequest().setId(id);\n  blogService.deleteBlogPost(request);\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"3-test-deleting-a-blog-post",children:"3. Test deleting a blog post"}),"\n",(0,s.jsxs)(t.p,{children:["Let's test deleting a blog post.\nWe'll delete the blog post with ID ",(0,s.jsx)(t.code,{children:"1"}),", and try retrieving with the same ID to verify it is indeed deleted.\nAdd a test method like the following."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(7)\nvoid deleteBlogPost() throws TException {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  client.deleteBlogPost(1);\n  final Throwable exception = catchThrowable(() -> {\n    client.getBlogPost(1);\n  });\n  assertThat(exception)\n    .isInstanceOf(BlogNotFoundException.class)\n    .extracting("reason")\n    .asString()\n    .isEqualTo("The blog post does not exist. ID: 1");\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,s.jsx)(t.h2,{id:"4-test-an-error-case",children:"4. Test an error case"}),"\n",(0,s.jsx)(t.p,{children:"Let's test deleting a blog post that does not exist.\nAdd a test method like the following."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(8)\nvoid deleteInvalidBlogPost() {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  final Throwable exception = catchThrowable(() -> {\n    client.deleteBlogPost(100);\n  });\n  assertThat(exception)\n    .isInstanceOf(BlogNotFoundException.class)\n    .extracting("reason")\n    .asString()\n    .isEqualTo("The blog post does not exist. ID: 100");\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,s.jsx)(t.h2,{id:"5-add-the-documentation-service",children:"5. Add the Documentation service"}),"\n",(0,s.jsxs)(t.p,{children:["This time, we'll add Armeria's ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"}),".\nThe Documentation service automatically creates documentation of your service methods, as well as providing means to test out the methods."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.code,{children:"newServer()"})," method, add a ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," and a request example for ",(0,s.jsx)(t.a,{href:"/docs/tutorials/thrift/implement-create",children:"creating blog posts"}),",\nusing ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocServiceBuilder.html#exampleRequests(java.lang.Class,java.lang.String,java.lang.Iterable)",children:"DocServiceBuilder#exampleRequests(Class,String,Iterable)"}),". Feel free to add more examples for other service methods."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'import com.linecorp.armeria.server.docs.DocService;\nimport example.armeria.blog.thrift.CreateBlogPostRequest;\n...\nprivate static Server newServer(int port) throws Exception {\n  ...\n  final CreateBlogPostRequest exampleRequest = new CreateBlogPostRequest()\n          .setTitle("Example title")\n          .setContent("Example content");\n  final DocService docService = DocService\n          .builder()\n          .exampleRequests(List.of(new BlogService.createBlogPost_args(exampleRequest)))\n          .build();\n  ...\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["In the ",(0,s.jsx)(t.code,{children:"newServer()"})," method, add the ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," to our server builder."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'private static Server newServer(int port) throws Exception {\n  ...\n  return Server.builder()\n           .http(port)\n           .service("/thrift", tHttpService)\n           // You can access the documentation service at http://127.0.0.1:8080/docs.\n           // See https://armeria.dev/docs/server/docservice for more information.\n           .serviceUnder("/docs", docService)\n           .build();\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["(Optional) To access the Documentation service result easily, edit the log message in the ",(0,s.jsx)(t.code,{children:"main()"})," method."]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'public static void main(String[] args) throws Exception {\n  ...\n  logger.info("Server has been started. Serving DocService at http://127.0.0.1:{}/docs",\n              server.activeLocalPort());\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:["Now, ",(0,s.jsx)(t.a,{href:"/docs/tutorials/thrift/run-service#4-run-the-server",children:"re-run the server"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The server and services are launched successfully if you see this message."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:" Server has been started. Serving DocService at http://127.0.0.1:8080/docs\n"})}),"\n",(0,s.jsx)(t.h2,{id:"6-check-the-docservice-page",children:"6. Check the DocService page"}),"\n",(0,s.jsx)(t.p,{children:"Let's test and call our service operations using Armeria's Documentation service."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Click the URL ",(0,s.jsx)(t.a,{href:"http://127.0.0.1:8080/docs",children:"http://127.0.0.1:8080/docs"})," from the log message or open up the URL on a web browser."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["If you see the Document service page, you've successfully launched the ",(0,s.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/docs/DocService.html",children:"DocService"})," and server."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(1241).A+"",width:"1297",height:"692"})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["Click the ",(0,s.jsx)(t.strong,{children:"createBlogPost()"})," method link in the left panel. You can make calls to the method by clicking on the ",(0,s.jsx)(t.code,{children:"Debug"})," button on the top right."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(44740).A+"",width:"500",height:"460"})}),"\n",(0,s.jsxs)(t.p,{children:["Note that in the ",(0,s.jsx)(t.strong,{children:"REQUEST BODY"})," section the values specified in the ",(0,s.jsx)(t.code,{children:"exampleRequest"})," are automatically displayed on the page."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:'final CreateBlogPostRequest exampleRequest = new CreateBlogPostRequest()\n        .setTitle("Example title")\n        .setContent("Example content");\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Click the ",(0,s.jsx)(t.strong,{children:"SUBMIT"})," button, and you'll see the blog post information returned in the right panel."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(72065).A+"",width:"959",height:"363"})}),"\n",(0,s.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,s.jsxs)(t.p,{children:["In this step, we've implemented a service method and client method for deleting a blog post.\nWe've also added ",(0,s.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"})," to our server."]}),"\n",(0,s.jsx)(t.p,{children:"We've finally come to the end of this tutorial.\nNext, try adding more service methods to the tutorial or have a go at developing a service of your own."}),"\n",(0,s.jsx)(r,{current:6})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var r=n(96540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}},44740:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_thrift_reqex-ca7e61ad7986a29c18c29770dc69055d.png"},72065:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/tutorial_blogservice_thrift_return-c34c22998a7aae4573afca7876b5e08f.png"}}]);