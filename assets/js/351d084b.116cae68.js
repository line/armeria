"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[8318],{14958:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"0.84.0","title":"v0.84.0","description":"New features","source":"@site/src/content/release-notes/0.84.0.mdx","sourceDirName":".","slug":"/0.84.0","permalink":"/release-notes/0.84.0","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/release-notes/0.84.0.mdx","tags":[],"version":"current","frontMatter":{"date":"2019-04-23T00:00:00.000Z"},"sidebar":"defaultSidebar","previous":{"title":"v0.85.0","permalink":"/release-notes/0.85.0"},"next":{"title":"v0.83.0","permalink":"/release-notes/0.83.0"}}');var s=i(74848),t=i(28453);const l={date:new Date("2019-04-23T00:00:00.000Z")},a="v0.84.0",c={},o=[{value:"New features",id:"new-features",level:2},{value:"Bug fixes",id:"bug-fixes",level:2},{value:"Deprecations",id:"deprecations",level:2},{value:"Breaking changes",id:"breaking-changes",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Thank you",id:"thank-you",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{ThankYou:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ThankYou",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.header,{children:[(0,s.jsx)(n.h1,{id:"v0840",children:"v0.84.0"}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"April 23, 2019"})})]}),"\n",(0,s.jsx)(n.h2,{id:"new-features",children:"New features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can now access the detailed timing information for the connection attempts made by Armeria via ",(0,s.jsx)(n.code,{children:"RequestLog"})," API, including DNS lookup and socket connect time. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1692",children:"#1692"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'HttpClient client = new HttpClientBuilder("https://example.com/")\n    .decorator((delegate, ctx, req) -> {\n        ctx.log().addListener(log -> {\n            ClientConnectionTimings timings = ClientConnectionTimings.get(log);\n            System.err.printf("Total time taken: %d ns%n",\n                              timings.connectionAcquisitionDurationNanos());\n            System.err.printf("DNS lookup: %d ns%n",\n                              timings.dnsResolutionDurationNanos());\n            System.err.printf("Socket connect:: %d ns%n",\n                              timings.socketConnectDurationNanos());\n        }, RequestLogAvailability.REQUEST_START);\n        return delegate.execute(ctx, req);\n    })\n    .build();\nclient.get("/");\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can now customize server-side ",(0,s.jsx)(n.code,{children:"SslContext"})," more conveniently. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1717",children:"#1717"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"ServerBuilder sb = new ServerBuilder();\nsb.tls(certChainFile, keyFile, tlsContextBuilder -> {\n    // Use JDK SSLEngine instead of OpenSSL.\n    tlsContextBuilder.sslProvider(SslProvider.JDK);\n});\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Server.stop()"})," is now able to stop its ",(0,s.jsx)(n.code,{children:"blockingTaskExecutor"}),". You have to specify whether to stop the ",(0,s.jsx)(n.code,{children:"blockingTaskExecutor"})," you specified or not when calling ",(0,s.jsx)(n.code,{children:"ServerBuilder.blockingTaskExecutor()"})," from this release. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1685",children:"#1685"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1707",children:"#1707"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"ServerBuilder sb = new ServerBuilder();\n// The thread pool will be terminated when the server stops.\nsb.blockingTaskExecutor(Executors.newFixedThreadPool(100), true);\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The usability of ",(0,s.jsx)(n.code,{children:"RedirectService"})," has been improved with some API changes. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1725",children:"#1725"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1726",children:"#1726"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RedirectService"})," preserves the query string by default. The query string of the old location was dropped previously."]}),"\n",(0,s.jsxs)(n.li,{children:["Added ",(0,s.jsx)(n.code,{children:"preserveQueryString"})," constructor parameter. Specifying ",(0,s.jsx)(n.code,{children:"false"})," will let you go back to the previous behavior."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The usability of ",(0,s.jsx)(n.code,{children:"SettableHealthChecker"})," has been improved with some API changes. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1714",children:"#1714"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SettableHealthChecker"}),"'s initial healthiness is now ",(0,s.jsx)(n.code,{children:"true"}),". It was ",(0,s.jsx)(n.code,{children:"false"})," previously."]}),"\n",(0,s.jsxs)(n.li,{children:["You can now specify the initial healthiness when instantiating ",(0,s.jsx)(n.code,{children:"SettableHealthChecker"}),".","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'SettableHealthChecker myHealthChecker = new SettableHealthChecker(false);\nServerBuilder sb = new ServerBuilder();\nsb.service("/monitor/health", new HttpHealthCheckService(myHealthChecker));\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SettableHealthChecker.setHealthy(boolean)"})," is now chainable. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1714",children:"#1714"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// Same with: new SettableHealthChecker(false)\nSettableHealthChecker myHealthChecker = new SettableHealthChecker().setHealthy(false);\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can now specify different path mappings for different CORS policies. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1698",children:"#1698"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1699",children:"#1699"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Using a builder pattern:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'ServerBuilder sb = new ServerBuilder();\n// Add two services under /foo and /bar.\nsb.service("prefix:/foo", fooService);\nsb.service("prefix:/bar", barService);\n\n// Enable CORS for:\n// - GET and POST requests for all resources under http://example.com/foo/\n// - GET request for all resources under http://example.com/bar/\nsb.decorator(CorsServiceBuilder.forOrigins("http://example.com")\n                               .pathMapping("prefix:/foo")\n                               .allowCredentials()\n                               .allowRequestMethods(HttpMethod.GET, HttpMethod.POST)\n                               .andForOrigins("http://example.com")\n                               .pathMapping("prefix:/bar")\n                               .allowCredentials()\n                               .allowRequestMethods(HttpMethod.GET)\n                               .and()\n                               .newDecorator());\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Using annotations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'sb.annotatedService(\n    @CorsDecorator(\n        origins = "http://example.com",\n        pathPatterns = "prefix:/foo",\n        credentialsAllowed = true,\n        allowedRequestMethods = { HttpMethod.GET, HttpMethod.POST })\n    @CorsDecorator(\n        origins = "http://example.com",\n        pathPatterns = "prefix:/bar",\n        credentialsAllowed = true,\n        allowedRequestMethods = { HttpMethod.GET })\n    new Object() {\n        ...\n    });\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can now build a gRPC service without depending on upstream gRPC API. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1720",children:"#1720"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1727",children:"#1727"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Added ",(0,s.jsx)(n.code,{children:"armeria-grpc-protocol"})," which provides a core functionality required for building a gRPC service, which does not depend on ",(0,s.jsx)(n.code,{children:"io.grpc:grpc-java"})," but only on ",(0,s.jsx)(n.code,{children:"com.google.protobuf:protobuf-java"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Added ",(0,s.jsx)(n.code,{children:"AbstractUnaryGrpcService"})," which allows you to implement a unary gRPC easily without depending on ",(0,s.jsx)(n.code,{children:"io.grpc:grpc-java"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"class MyUnaryGrpcService extends AbstractUnaryGrpcService {\n    @Override\n    protected CompletableFuture<byte[]> handleMessage(byte[] message) {\n        final MyGrpcRequest req;\n        try {\n            req = MyGrpcRequest.parseFrom(message);\n        } catch (InvalidProtocolBufferException e) {\n            throw new UncheckedIOException(e);\n        }\n\n        MyGrpcResponse res = MyGrpcResponse.newBuilder()...build();\n        return UnmodifiableFuture.completedFuture(res.toByteArray());\n    }\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Spring Boot integration now has content encoding options. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1716",children:"#1716"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Your application.yml:\narmeria:\n  ports:\n    - port: 8080\n      protocols: HTTP\n  compression:\n    enabled: true\n    mime-types: text/*, application/json\n    excluded-user-agents: some-user-agent, another-user-agent\n    minResponseSize: 1KB\n"})}),"\n"]}),"\n"]}),"\n","\n",(0,s.jsx)(n.h2,{id:"bug-fixes",children:"Bug fixes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The default path pattern now handles a trailing slash properly. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1730",children:"#1730"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1735",children:"#1735"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TwoElementFixedStreamMessage"})," no longer throws an ",(0,s.jsx)(n.code,{children:"IllegalReferenceCountException"}),". ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1687",children:"#1687"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1695",children:"#1695"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DnsEndpointGroup"})," does not ignore the ",(0,s.jsx)(n.code,{children:"search"})," directive in ",(0,s.jsx)(n.code,{children:"/etc/resolv.conf"})," anymore. This fix should be useful for users in Kubernetes environment. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1694",children:"#1694"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1697",children:"#1697"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DocService"})," no longer raises a ",(0,s.jsx)(n.code,{children:"NullPointerException"})," for a certain gRPC service metadata. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1705",children:"#1705"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1715",children:"#1715"})]}),"\n",(0,s.jsxs)(n.li,{children:["An unframed gRPC service no longer becomes unresponsive when sending a response without content ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1723",children:"#1723"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"THttpService"})," no longer fails to load the service metadata when ",(0,s.jsx)(n.code,{children:".thrift"})," file was compiled with the ",(0,s.jsx)(n.code,{children:"private-members"})," option. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1728",children:"#1728"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1729",children:"#1729"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"THttpService"})," no longer fails to load the service metadata when ",(0,s.jsx)(n.code,{children:".thrift"})," file defines a service that extends other service. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1734",children:"#1734"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"HttpTracingClient"})," and ",(0,s.jsx)(n.code,{children:"HttpTracingService"})," do not fill service name automatically with host names or IP addresses anymore. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1706",children:"#1706"})]}),"\n",(0,s.jsxs)(n.li,{children:["Spring integration module now respects the ",(0,s.jsx)(n.code,{children:"com.linecorp.armeria.useOpenSsl"})," flag properly. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1713",children:"#1713"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deprecations",children:"Deprecations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ServerBuilder.blockingTaskExecutor(Executor)"})," has been deprecated. Use ",(0,s.jsx)(n.code,{children:"ServerBuilder.blockingTaskExecutor(Executor, boolean)"}),". ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1685",children:"#1685"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1707",children:"#1707"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TextFormatter.epoch()"})," and ",(0,s.jsx)(n.code,{children:"appendEpoch()"})," have been deprecated. Use ",(0,s.jsx)(n.code,{children:"TextFormatter.epochMillis()"})," and ",(0,s.jsx)(n.code,{children:"appendEpochMillis()"}),". ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1692",children:"#1692"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"breaking-changes",children:"Breaking changes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The initial healthiness of ",(0,s.jsx)(n.code,{children:"SettableHealthChecker"})," is now ",(0,s.jsx)(n.code,{children:"true"}),". ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1714",children:"#1714"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RedirectService"})," preserves the query string by default. The query string of the old location was dropped previously. ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1725",children:"#1725"})," ",(0,s.jsx)(n.a,{href:"https://github.com/line/armeria/issues/1726",children:"#1726"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["gRPC 1.19.0 -> 1.20.0","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Protobuf 3.6.1 -> 3.7.1"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Jetty 9.4.15 -> 9.4.17"}),"\n",(0,s.jsx)(n.li,{children:"Micrometer 1.1.3 -> 1.1.4"}),"\n",(0,s.jsx)(n.li,{children:"Spring Boot 2.1.3 -> 2.1.4, 1.5.19 -> 1.5.20"}),"\n",(0,s.jsx)(n.li,{children:"Tomcat 9.0.17 -> 9.0.19, 8.5.39 -> 8.5.40"}),"\n",(0,s.jsx)(n.li,{children:"ZooKeeper 3.4.13 -> 3.4.14"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"thank-you",children:"Thank you"}),"\n",(0,s.jsx)(i,{usernames:["anuraaga","codefromthecrypt","dawnbreaks","edgao","geminiKim","gquintana","huydx","hyangtack","minwoox","syleeeee","tacigar","trustin"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var r=i(96540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);