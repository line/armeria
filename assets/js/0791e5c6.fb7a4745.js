"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[9915],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(96540);const l={},o=i.createContext(l);function s(e){const t=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(o.Provider,{value:t},e.children)}},39086:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tutorials/thrift/implement-update","title":"Implementing UPDATE operation","description":"Previously, we created and read blog posts.","source":"@site/src/content/docs/tutorials/thrift/05-implement-update.mdx","sourceDirName":"tutorials/thrift","slug":"/tutorials/thrift/implement-update","permalink":"/docs/tutorials/thrift/implement-update","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/tutorials/thrift/05-implement-update.mdx","tags":[{"inline":true,"label":"server","permalink":"/docs/tags/server"}],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_label":"5. Implement UPDATE","category":"thrift","tags":["server"],"level":"basic","type":"step"},"sidebar":"docsSidebar","previous":{"title":"4. Implement READ","permalink":"/docs/tutorials/thrift/implement-read"},"next":{"title":"6. Implement DELETE","permalink":"/docs/tutorials/thrift/implement-delete"}}');var l=n(74848),o=n(28453);const s={sidebar_label:"5. Implement UPDATE",category:"thrift",tags:["server"],level:"basic",type:"step"},r="Implementing UPDATE operation",a={},d=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Implement server-side",id:"1-implement-server-side",level:2},{value:"Add an exception handler",id:"add-an-exception-handler",level:3},{value:"Implement the service method",id:"implement-the-service-method",level:3},{value:"2. Implement client-side",id:"2-implement-client-side",level:2},{value:"3. Test updating a blog post",id:"3-test-updating-a-blog-post",level:2},{value:"4. Test an error case",id:"4-test-an-error-case",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{TutorialSteps:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TutorialSteps",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"implementing-update-operation",children:"Implementing UPDATE operation"})}),"\n",(0,l.jsx)(t.p,{children:"Previously, we created and read blog posts.\nNow, let's implement and make a call to update a blog post.\nWe'll also learn how to handle an exception with a custom exception handler."}),"\n",(0,l.jsx)(n,{current:5}),"\n",(0,l.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,l.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,l.jsx)(t.a,{href:"https://github.com/line/armeria-examples/tree/main/tutorials/thrift",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"/docs/tutorials/thrift/define-service#3-compile-the-thrift-file",children:"Generated Java code"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"BlogServiceImpl.java"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"Main.java"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"BlogClient.java"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"1-implement-server-side",children:"1. Implement server-side"}),"\n",(0,l.jsx)(t.p,{children:"Let's implement the server-side for updating blog posts.\nThis time, we'll use a custom exception handler."}),"\n",(0,l.jsx)(t.h3,{id:"add-an-exception-handler",children:"Add an exception handler"}),"\n",(0,l.jsx)(t.p,{children:"First, add a custom exception handler for the blog service."}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Add an exception handler class to convert an ",(0,l.jsx)(t.code,{children:"IllegalArgumentException"})," into a ",(0,l.jsx)(t.code,{children:"BlogNotFoundException"}),"."]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceExceptionHandler.java"',children:"package example.armeria.server.blog.thrift;\n\nimport java.util.function.BiFunction;\n\nimport com.linecorp.armeria.common.RpcResponse;\nimport com.linecorp.armeria.server.ServiceRequestContext;\n\nimport example.armeria.blog.thrift.BlogNotFoundException;\n\npublic class BlogServiceExceptionHandler implements BiFunction<ServiceRequestContext, Throwable, RpcResponse> {\n\n  @Override\n  public RpcResponse apply(ServiceRequestContext serviceRequestContext, Throwable cause) {\n    if (cause instanceof IllegalArgumentException) {\n      return RpcResponse.ofFailure(new BlogNotFoundException(cause.getMessage()));\n    }\n    return RpcResponse.ofFailure(cause);\n  }\n}\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["In the ",(0,l.jsx)(t.code,{children:"Main"})," class, bind the ",(0,l.jsx)(t.code,{children:"BlogServiceExceptionHandler"})," to our service."]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="Main.java"',children:"...\nprivate static Server newServer(int port) throws Exception {\n  final THttpService tHttpService =\n    THttpService.builder()\n                .addService(new BlogServiceImpl())\n                .exceptionHandler(new BlogServiceExceptionHandler()) // Add this\n                .build();\n  ...\n}\n"})}),"\n",(0,l.jsx)(t.h3,{id:"implement-the-service-method",children:"Implement the service method"}),"\n",(0,l.jsxs)(t.p,{children:["In the ",(0,l.jsx)(t.code,{children:"BlogServiceImpl"})," class, implement the ",(0,l.jsx)(t.code,{children:"updateBlogPost()"})," method to update a blog post.\nThis time, let's use the ",(0,l.jsx)(t.code,{children:"IllegalArgumentException"})," instead of the ",(0,l.jsx)(t.code,{children:"BlogNotFoundException"}),"."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceImpl.java"',children:'@Override\npublic void updateBlogPost(UpdateBlogPostRequest request, AsyncMethodCallback<BlogPost> resultHandler)\n        throws TException {\n  final BlogPost oldBlogPost = blogPosts.get(request.getId());\n  if (oldBlogPost == null) {\n    resultHandler.onError(\n            new IllegalArgumentException("The blog post does not exist. ID: " + request.getId()));\n  } else {\n    final BlogPost newBlogPost = oldBlogPost\n            .deepCopy()\n            .setTitle(request.getTitle())\n            .setContent(request.getContent())\n            .setModifiedAt(Instant.now().toEpochMilli());\n    blogPosts.put(request.getId(), newBlogPost);\n    resultHandler.onComplete(newBlogPost);\n  }\n}\n'})}),"\n",(0,l.jsx)(t.h2,{id:"2-implement-client-side",children:"2. Implement client-side"}),"\n",(0,l.jsxs)(t.p,{children:["Add a method ",(0,l.jsx)(t.code,{children:"updateBlogPost()"})," to send a request to update a blog post."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogClient.java"',children:"import example.armeria.blog.thrift.UpdateBlogPostRequest;\n...\nBlogPost updateBlogPost(int id, String newTitle, String newContent) throws TException {\n  final UpdateBlogPostRequest request = new UpdateBlogPostRequest().setId(id).setTitle(newTitle).setContent(newContent);\n  return blogService.updateBlogPost(request);\n}\n"})}),"\n",(0,l.jsx)(t.h2,{id:"3-test-updating-a-blog-post",children:"3. Test updating a blog post"}),"\n",(0,l.jsx)(t.p,{children:"Let's try updating the content of the first blog post.\nAdd a method like the following."}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(5)\nvoid updateBlogPosts() throws TException {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  final BlogPost updated = client.updateBlogPost(0, "My first blog", "Hello awesome Armeria!");\n  assertThat(updated.getId()).isZero();\n  assertThat(updated.getTitle()).isEqualTo("My first blog");\n  assertThat(updated.getContent()).isEqualTo("Hello awesome Armeria!");\n}\n'})}),"\n",(0,l.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,l.jsx)(t.h2,{id:"4-test-an-error-case",children:"4. Test an error case"}),"\n",(0,l.jsx)(t.p,{children:"To check that our exception handler is working, let's try updating a post which does not exist."}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"Bind the exception handler to the service for the test server."}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@RegisterExtension\nstatic final ServerExtension server = new ServerExtension() {\n  @Override\n  protected void configure(ServerBuilder sb) throws Exception {\n    sb.service("/thrift", THttpService.builder()\n        .exceptionHandler(new BlogServiceExceptionHandler()) // Add this\n        .addService(new BlogServiceImpl())\n        .build());\n  }\n};\n'})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["Add a test method to update a blog post with an invalid ID, asserting a ",(0,l.jsx)(t.code,{children:"BlogNotFoundException"})," is thrown."]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\n@Order(6)\nvoid updateInvalidBlogPost() {\n  final BlogClient client = new BlogClient(server.httpUri(), "/thrift");\n  final Throwable exception = catchThrowable(() -> {\n    final BlogPost updated = client.updateBlogPost(Integer.MAX_VALUE, "My first blog", "Hello awesome Armeria!");\n  });\n  assertThat(exception)\n    .isInstanceOf(BlogNotFoundException.class)\n    .extracting("reason")\n    .asString()\n    .isEqualTo("The blog post does not exist. ID: " + Integer.MAX_VALUE);\n}\n'})}),"\n",(0,l.jsxs)(t.ol,{start:"3",children:["\n",(0,l.jsx)(t.li,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"whats-next",children:"What's next"}),"\n",(0,l.jsx)(t.p,{children:"In this step, we've implemented a service method and client method for updating a blog post.\nWe've also added an exception handler."}),"\n",(0,l.jsxs)(t.p,{children:["Next, at ",(0,l.jsx)(t.a,{href:"/docs/tutorials/thrift/implement-delete",children:"Step 6. Implement DELETE"}),", we'll implement a method\nfor deleting a blog post and add a ",(0,l.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation Service"})," to our service."]}),"\n",(0,l.jsx)(n,{current:5})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);