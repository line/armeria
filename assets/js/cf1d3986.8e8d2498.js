"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[1881],{28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>s});var i=n(96540);const t={},a=i.createContext(t);function o(e){const r=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:r},e.children)}},53100:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"advanced/spring-webflux-integration","title":"Using Armeria with Spring WebFlux","description":"Visit armeria-examples to find a fully working example.","source":"@site/src/content/docs/advanced/spring-webflux-integration.mdx","sourceDirName":"advanced","slug":"/advanced/spring-webflux-integration","permalink":"/docs/advanced/spring-webflux-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/advanced/spring-webflux-integration.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Spring Boot integration","permalink":"/docs/advanced/spring-boot-integration"},"next":{"title":"Using Armeria with Dropwizard","permalink":"/docs/advanced/dropwizard-integration"}}');var t=n(74848),a=n(28453);const o={},s="Using Armeria with Spring WebFlux",c={},l=[];function d(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{RequiredDependencies:n}=r;return n||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("RequiredDependencies",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"using-armeria-with-spring-webflux",children:"Using Armeria with Spring WebFlux"})}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["Visit ",(0,t.jsx)(r.a,{href:"https://github.com/line/armeria-examples",children:"armeria-examples"})," to find a fully working example."]})}),"\n",(0,t.jsx)(r.p,{children:"Spring framework provides powerful features which are necessary for building a web application, such as\ndependency injection, data binding, AOP, transaction, etc. In addition, if your Spring application integrates\nwith Armeria, you can leverage the following:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Rich support for Apache ",(0,t.jsx)(r.a,{href:"https://thrift.apache.org/",children:"Thrift"})," and ",(0,t.jsx)(r.a,{href:"https://grpc.io/",children:"gRPC"}),",\nincluding ",(0,t.jsx)(r.a,{href:"/docs/server/docservice",children:"the fancy web console"})," that enables you to send Thrift and gRPC requests\nfrom a web browser"]}),"\n",(0,t.jsx)(r.li,{children:"Ability to run HTTP REST service and RPC service in the same port"}),"\n",(0,t.jsxs)(r.li,{children:["Full HTTP/2 support for both server-side and client-side, including ",(0,t.jsx)(r.code,{children:"h2c"})," (plaintext HTTP/2)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt",children:"PROXY protocol"})," support which provides\ninteroperability with load balancers such as ",(0,t.jsx)(r.a,{href:"https://www.haproxy.org/",children:"HAProxy"})," and\n",(0,t.jsx)(r.a,{href:"https://aws.amazon.com/elasticloadbalancing/",children:"AWS ELB"})]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Armeria can be plugged in as the underlying HTTP server for a Spring Boot 2 WebFlux application by adding\nthe following dependency:"}),"\n",(0,t.jsx)(n,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"},{groupId:"io.netty",artifactId:"netty-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-spring-boot2-webflux-starter"}]}),"\n",(0,t.jsxs)(r.p,{children:["The above starter configures Armeria as the HTTP server for WebFlux to run on by referring to ",(0,t.jsx)(r.code,{children:"application.yml"}),"\nwhen the application starts up. A user can customize the server configuration with the same properties\nprovided by Spring Boot as for other servers supported with WebFlux such as Tomcat or Reactor Netty.\nThe following is a simple example for configuring the server:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"server:\n  address: 127.0.0.1\n  port: 8080\n"})}),"\n",(0,t.jsxs)(r.p,{children:["For a user who wants to customize the web server, ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/spring/ArmeriaServerConfigurator.html",children:"ArmeriaServerConfigurator"})," is provided.\nThe user can customize the server by defining a bean of the type in the configuration as follows:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'@Configuration\npublic class ArmeriaConfiguration {\n    // A user can configure the server by providing an ArmeriaServerConfigurator bean.\n    @Bean\n    public ArmeriaServerConfigurator armeriaServerConfigurator() {\n        // Customize the server using the given ServerBuilder. For example:\n        return builder -> {\n            // Add DocService that enables you to send Thrift and gRPC requests\n            // from web browser.\n            builder.serviceUnder("/docs", new DocService());\n\n            // Log every message which the server receives and responds.\n            builder.decorator(LoggingService.newDecorator());\n\n            // Write access log after completing a request.\n            builder.accessLogWriter(AccessLogWriter.combined(), false);\n\n            // You can also bind asynchronous RPC services such as Thrift and gRPC:\n            // builder.service(THttpService.of(...));\n            // builder.service(GrpcService.builder()...build());\n        };\n    }\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Armeria can also be plugged as the underlying HTTP client for the Spring ",(0,t.jsx)(r.code,{children:"WebClient"}),". To customize\nclient settings for the Armeria HTTP client, simply define an ",(0,t.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/spring/web/reactive/ArmeriaClientConfigurator.html",children:"ArmeriaClientConfigurator"})," bean\nin your configuration as follows:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"@Configuration\npublic class ArmeriaConfiguration {\n    // Returns a custom ClientFactory with TLS certificate validation disabled,\n    // which means any certificate received from the server will be accepted\n    // without any verification. It is used for an example which makes the client\n    // send an HTTPS request to the server running on localhost with a self-signed\n    // certificate. Do NOT use ClientFactory.insecure() or\n    // ClientFactoryBuilder.tlsNoVerify() in production.\n    @Bean\n    public ClientFactory clientFactory() {\n        return ClientFactory.insecure();\n    }\n\n    // A user can configure a Client by providing an ArmeriaClientConfigurator bean.\n    @Bean\n    public ArmeriaClientConfigurator\n            armeriaClientConfigurator(ClientFactory clientFactory) {\n\n        // Customize the client using the given WebClientBuilder. For example:\n        return builder -> {\n            // Use a circuit breaker for each remote host.\n            final CircuitBreakerRule rule =\n                    CircuitBreakerRule.onServerErrorStatus();\n            builder.decorator(CircuitBreakerClient.builder(rule)\n                                                  .newDecorator());\n\n            // Set a custom client factory.\n            builder.factory(clientFactory);\n        };\n    }\n}\n"})}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["If you are not familiar with Spring Boot and Spring WebFlux, please refer to\n",(0,t.jsx)(r.a,{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/",children:"Spring Boot Reference Guide"})," and\n",(0,t.jsx)(r.a,{href:"https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html",children:"Web on Reactive Stack"}),"."]})})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);