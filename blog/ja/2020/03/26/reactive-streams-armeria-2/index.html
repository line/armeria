<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog-ja" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Let’s play Reactive Streams with Armeria vol.2 | Armeria</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://armeria.dev/img/og-image.png"><meta data-rh="true" name="twitter:image" content="https://armeria.dev/img/og-image.png"><meta data-rh="true" property="og:url" content="https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="og:site_name" content="Armeria - Your go-to microservice framework"><meta data-rh="true" name="og:type" content="website"><meta data-rh="true" name="og:image:width" content="1280"><meta data-rh="true" name="og:image:height" content="640"><meta data-rh="true" name="twitter:site" content="@armeria_project"><meta data-rh="true" name="twitter:creator" content="@armeria_project"><meta data-rh="true" property="og:title" content="Let’s play Reactive Streams with Armeria vol.2 | Armeria"><meta data-rh="true" name="description" content="こんにちは。LINE Plus でオープンソースソフトウェアの Armeria と Central Dogma を開発している UM IKHUN です。前回の記事では、Reactive Streams の概念を解説しました。今回の記事では、Reactive Streams をオープンソース非同期の HTTP/2、RPC、REST クライアント／サーバーライブラリーである Armeria で使用する方法について紹介したいと思います。"><meta data-rh="true" property="og:description" content="こんにちは。LINE Plus でオープンソースソフトウェアの Armeria と Central Dogma を開発している UM IKHUN です。前回の記事では、Reactive Streams の概念を解説しました。今回の記事では、Reactive Streams をオープンソース非同期の HTTP/2、RPC、REST クライアント／サーバーライブラリーである Armeria で使用する方法について紹介したいと思います。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-05-06T11:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2"><link data-rh="true" rel="alternate" href="https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2" hreflang="en"><link data-rh="true" rel="alternate" href="https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2","mainEntityOfPage":"https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2","url":"https://armeria.dev/blog/ja/2020/03/26/reactive-streams-armeria-2","headline":"Let’s play Reactive Streams with Armeria vol.2","name":"Let’s play Reactive Streams with Armeria vol.2","description":"こんにちは。LINE Plus でオープンソースソフトウェアの Armeria と Central Dogma を開発している UM IKHUN です。前回の記事では、Reactive Streams の概念を解説しました。今回の記事では、Reactive Streams をオープンソース非同期の HTTP/2、RPC、REST クライアント／サーバーライブラリーである Armeria で使用する方法について紹介したいと思います。","datePublished":"2020-05-06T11:00:00.000Z","author":{"@type":"Person","name":"Um Ikhun","description":"Ikhun is developing for open-source Armeria and Central Dogma at LINE Plus.","image":"https://github.com/ikhoon.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://armeria.dev/blog/ja","name":"Armeria Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Armeria Newsletter RSS Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CY9YHLJ0K6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CY9YHLJ0K6",{anonymize_ip:!0})</script>





<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Armeria Blog RSS Feed">
<link rel="alternate" type="application/rss+xml" href="/blog/ja/rss.xml" title="Armeria Blog - Japanese RSS Feed">
<link rel="alternate" type="application/rss+xml" href="/blog/ko/rss.xml" title="Armeria Blog - Korean RSS Feed">

<link rel="manifest" href="/manifest.json">


<link rel="alternate" type="application/rss+xml" href="/release-notes/rss.xml" title="Armeria Release Notes RSS Feed">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Armeria RSS Feed"><link rel="stylesheet" href="/assets/css/styles.884c8684.css">
<script src="/assets/js/runtime~main.b4c203e9.js" defer="defer"></script>
<script src="/assets/js/main.00e561a2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/armeria_logo_horiz.svg"><link rel="preload" as="image" href="https://github.com/ikhoon.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/armeria_logo_horiz.svg" alt="Armeria Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/armeria_logo_horiz.svg" alt="Armeria Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">News</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/news/20231208-newsletter-6">Newsletter</a></li><li><a class="dropdown__link" href="/release-notes/1.35.0">Release notes</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/">Documentation</a><a class="navbar__item navbar__link" href="/community/">Community</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/line/armeria" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a class="navbar__item navbar__link header-discord-link" aria-label="Discord" href="/s/discord"></a><a href="https://x.com/armeria_project" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-x-link" aria-label="X"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS darkNavbarColorModeToggle_X3D1" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md"> </div><button type="button" class="ant-btn css-198drv2 ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-btn-lg ant-dropdown-trigger blogLanguageSelector__AnM"><a href="/blog">English</a><span role="img" aria-label="down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></span></button><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/ja/2020/03/26/reactive-streams-armeria-2">Let’s play Reactive Streams with Armeria vol.2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2020/03/26/reactive-streams-armeria-1">Let’s play Reactive Streams with Armeria vol.1</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2020/01/14/monitoring-a-spring-boot-app-in-kubernetes-what-i-learned-from-devoxx-belgium-2019">Devoxx Belgiumで学んだ方法でKubernetes上のSpring Bootをモニタリングする</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2019</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2019/06/21/armeria-sprint-1">GitHub Contributions グラフを緑豊かにしてみましょう(feat. Armeria Sprint)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2019/05/23/thank-you-for-contributing-to-armeria">オープンソース「Armeria」のコントリビュータのためのイベントを開催しました</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2017</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2017/12/01/asynchronous-micro-service-in-rxjava-2-armeria">RxJava 2とArmeriaでマイクロサービスを非同期化してみた</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2016</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2016/08/04/applying-circuitbreaker-to-channel-gateway">チャネルゲートウェイへのCircuitBreakerの適用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2016/07/14/circuit-breakers-for-distributed-services">分散サービス環境へのCircuit Breakerの適用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ja/2016/04/13/open-sourcing-armeria">社内プロジェクト「Armeria」をオープンソース化するために行った６つのステップ</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><div><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This post is also available in<!-- --> <a href="/blog/ko/2020/02/19/reactive-streams-armeria-2">Korean</a> and <a href="/blog/2020/07/03/reactive-streams-armeria-2">English</a>.</p></div></div></div><h1 class="title_f1Hy">Let’s play Reactive Streams with Armeria vol.2</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-05-06T11:00:00.000Z">May 6, 2020</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ikhoon.png" alt="Um Ikhun"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp" translate="no">Um Ikhun</span></div><small class="authorTitle_nd0D" title="Ikhun is developing for open-source Armeria and Central Dogma at LINE Plus.">Ikhun is developing for open-source Armeria and Central Dogma at LINE Plus.</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>こんにちは。LINE Plus でオープンソースソフトウェアの Armeria と Central Dogma を開発している UM IKHUN です。<a class="" href="/blog/ja/2020/03/26/reactive-streams-armeria-1">前回の記事</a>では、Reactive Streams の概念を解説しました。今回の記事では、Reactive Streams をオープンソース非同期の HTTP/2、RPC、REST クライアント／サーバーライブラリーである Armeria で使用する方法について紹介したいと思います。</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-armeria">What’s Armeria?<a href="#whats-armeria" class="hash-link" aria-label="Direct link to What’s Armeria?" title="Direct link to What’s Armeria?" translate="no">​</a></h2>
<p>Armeria は、Java 8 および Netty、Thrift、gRPC をベースにしたオープンソース非同期 HTTP/2、RPC、REST クライアント／サーバーライブラリーです。Armeria は、軽量（Lightweight）のマイクロサービスフレームワークですが、サポートする機能は、他のフルスタック（full stack）ウェブフレームワークと比較しても劣りません。</p>
<p>まず、Armeria で Reactive Streams を活用したサーバーを実現するために、基本的に知っておくべきことを説明します。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="サポートするプロトコル">サポートするプロトコル<a href="#サポートするプロトコル" class="hash-link" aria-label="Direct link to サポートするプロトコル" title="Direct link to サポートするプロトコル" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-1-b8df78267813bd6db4a7146dc18e2f91.png" width="3030" height="1468" class="img_ev3q"></p>
<p>Armeria では、HTTP/1 と HTTP/2 を両方ともサポートしており、この 2 つのプロトコルは<a href="https://simple.wikipedia.org/wiki/Cleartext" target="_blank" rel="noopener noreferrer" class="">cleartext</a>と TLS（Transport Layer Security）暗号化通信をすべてサポートしています。HTTP/1 から HTTP/2 への互換性をサポートするためのプロトコルアップグレードについては、HTTP/2 の「connection preface」と HTTP/1 の「upgrade request」を両方ともサポートしています。</p>
<p>また、Armeria では gRPC と Thrift が、HTTP/1 と HTTP/2 の両方で動作します。これは Armeria ならではの特別な機能です。gRPC は HTTP/1 をサポートせず、既存の Thrift では HTTP/2 をサポートしません。しかし、Armeria ではすべてサポートしており、多様なビジネス環境で柔軟に使用できます。また、Linux 環境では、JNI（Java Native Interface）ベースのソケット IO と BoringSSL ベースの TLS により、一層スピーディに本番環境で使用できます。</p>
<p>では、サンプルコードを見ながら Armeria について 1 つずつ説明します。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="サンプルコードで見る-armeria">サンプルコードで見る Armeria<a href="#サンプルコードで見る-armeria" class="hash-link" aria-label="Direct link to サンプルコードで見る Armeria" title="Direct link to サンプルコードで見る Armeria" translate="no">​</a></h3>
<p>Armeria は、ユーザーに優しい API です。コードが簡潔で使いやすくなっています。「Hello world」サーバーを実行したいときは、以下のように 5 行を作成するたけで済みます。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Build your own server under 5 lines.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var server = Server.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .http(8080)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .service(&quot;/&quot;, (ctx, req) -&gt; HttpResponse.of(&quot;Hello, World!&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.start();</span><br></span></code></pre></div></div>
<p>サーバーを簡単に実行できるというのは、マイクロサービス環境において各ビジネスコンポーネントを分離し、独立したサーバーとして管理するときにポイントになることです。</p>
<p>また、サーバーのアーキテクチャをシンプルにすることができます。HTTPS や HTTP/2 を使用するために別途の<a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar" target="_blank" rel="noopener noreferrer" class="">サイドカー</a>（sidecar）である Nginx や Apache Httpd のような静的 Web サーバーを実行する必要がありません。前述のように、Linux 環境では JNI ベースのソケット IO と BoringSSL をサポートするため、別途の性能低下を考慮する必要はありません。なお、JS や CSS、画像のような静的ファイルをホストする機能も提供しています（<a href="https://line.github.io/armeria/server-http-file.html" target="_blank" rel="noopener noreferrer" class="">参照</a>）。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var server = Server.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .http(8080)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .https(8443) // HTTPS support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .tlsSelfSigned()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .service(&quot;/&quot;, (ctx, req) -&gt; HttpResponse.of(&quot;Hello, World!&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.start();</span><br></span></code></pre></div></div>
<p>ネットワークホップ（hop）を追加せずに済むため、障害点を減らすことができ、リソースを節約できるので効率よく通信できます。さらに、アーキテクチャがシンプルでモニタリングが簡単になり、サーバーを柔軟に拡張できます。</p>
<p>その他にも有効な機能が多くあります。その 1 つが、Armeria でビルトインで提供するアノテーション（annotation）です。アノテーションを利用すると、Armeria の機能をより簡単に使用できます。例えば、以下のように hello をプリフィックス（prefix）として、name を経路変数として設定し、ルーティングするコードを簡単に作成できます（<a href="https://line.github.io/armeria/server-annotated-service.html" target="_blank" rel="noopener noreferrer" class="">Armeria の公式文書</a>を参照すると、その他に多様なアノテーションをより詳しく見ることができます）。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.annotation.Get;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.annotation.Param;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.annotation.PathPrefix;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use built-in annotations for mapping path and parameter injection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PathPrefix(&quot;/hello&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class HelloService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   @Get(&quot;/:name&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   public String hello(@Param String name) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       return String.format(&quot;Hello, %s!&quot;, name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Armeria には、他の種類の RPC プロトコルを同時に扱える特別な機能もあります。1 つのサーバーで REST API と gRPC、Thrift をすべて提供できるため、ビジネスの要望やアーキテクチャの変化に柔軟に対応できます。また、単一ポートで提供しているので、リソースを効率よく使用してセキュリティの面で不要な露出を最低限に抑え、管理ポイントを削減できるメリットがあります。<a href="#footnotes" class="">[1]</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var server = Server.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .http(8080)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .service(&quot;/hello/rest&quot;, (ctx, req) -&gt; HttpResponse.of(&quot;Hello, world!&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .service(&quot;/hello/thrift&quot;, THttpService.of(new ThriftHelloService()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .service(&quot;/hello/grpc&quot;, GrpcService.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      .addService(new GrpcHelloService())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      .build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .build();</span><br></span></code></pre></div></div>
<p>エンタープライズソフトウェアの開発者は一般的に、認証やロギングなどをいかに効率よく処理できるかに関心を持って悩むと思います。Armeria では、<a href="https://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank" rel="noopener noreferrer" class="">separation of concerns</a>と呼んでいるこのような部分を別途<a href="https://line.github.io/armeria/server-decorator.html" target="_blank" rel="noopener noreferrer" class="">decorator</a>で管理できる機能を提供しています。<a href="#footnotes" class="">[2]</a></p>
<p>また、標準で提供されていない decorator が必要であれば、直接簡単に実装し、特定経路やサービスにバインディングして使用することもできます。例えば、下図で実装した AuthService では、request に認証情報が含まれているときのみサービスを呼び出し、そうでなければ「401 unauthorized」エラーを発生させるようにしました。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-2-651dfe37d84cf70fa56b6314072fc869.png" width="3316" height="1652" class="img_ev3q"></p>
<p>次に、Armeria で Reactive Streams をどのようにサポートしているかを説明します。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="armeria-内の-http2-ストーリム">Armeria 内の HTTP/2 ストーリム<a href="#armeria-内の-http2-ストーリム" class="hash-link" aria-label="Direct link to Armeria 内の HTTP/2 ストーリム" title="Direct link to Armeria 内の HTTP/2 ストーリム" translate="no">​</a></h3>
<p>ストリーム（stream）は流れている水のように、有機的に繋がり続ける必要があります。ある 1 か所だけ開いていて他のところは詰まっていると、すぐ溢れてしまいます。Armeria では、データの流れを有機的にコントロールするために、サーバー内では Reactive Streams のバックプレッシャーを利用してトラフィックをコントロールします。また、<a href="https://http2.github.io/http2-spec/#WINDOW_UPDATE" target="_blank" rel="noopener noreferrer" class="">WINDOW_UPDATE</a>を利用した<a href="https://tools.ietf.org/html/rfc7540#section-5.2" target="_blank" rel="noopener noreferrer" class="">HTTP/2 stream flow control</a>で、バックプレッシャーが配下のネットワークレイヤーで Armeria のサーバーと皆さんが実装したサービス、そしてデータのリポジトリまで有機的に繋げられるようにしました。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-3-19c9d7f507f0cc7efb072673431792ff.png" width="3336" height="1792" class="img_ev3q"></p>
<p>もし皆さんのサービスで使用しているサーバーを、今すぐ Armeria の Reactive サーバーに取り換えることができない事情があるなら、以下のように Armeria を Reactive プロキシサーバーとして活用することもできます（<a href="https://github.com/line/armeria-examples/tree/master/proxy-server" target="_blank" rel="noopener noreferrer" class="">参照</a>）。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use Armeria’s async &amp; reactive HTTP/2 client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var client = HttpClient.of(&quot;h2c://backend&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var server = Server.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .http(8080)          // Forward all requests reactively</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .service(&quot;prefix:/&quot;, (ctx, req) -&gt; client.execute(req))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span></code></pre></div></div>
<p>Armeria プロキシサーバーを前に配置すると、皆さんのサーバーを厳しい外部のインターネットから安全に保護できます。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-4-d1176606f39d7cc2951b0a21a74b80c6.png" width="2310" height="716" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="reactive-streams-と-armeria-の統合">Reactive Streams と Armeria の統合<a href="#reactive-streams-と-armeria-の統合" class="hash-link" aria-label="Direct link to Reactive Streams と Armeria の統合" title="Direct link to Reactive Streams と Armeria の統合" translate="no">​</a></h2>
<p>Armeria で直接 Reactive Streams をサポートするサーバーを作ると、より多様な機能を使用できます。Armeria で Reactive Streams を活用する方法とビルトイン publisher についてより詳しく説明します。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="armeria-http-レスポンスの-publisher">Armeria HTTP レスポンスの Publisher<a href="#armeria-http-レスポンスの-publisher" class="hash-link" aria-label="Direct link to Armeria HTTP レスポンスの Publisher" title="Direct link to Armeria HTTP レスポンスの Publisher" translate="no">​</a></h3>
<p>Armeria のレスポンスは、ヘッダーを表現する<a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/common/HttpHeaders.html" target="_blank" rel="noopener noreferrer" class="">HttpHeaders</a>とデータを表現する<a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/common/HttpData.html" target="_blank" rel="noopener noreferrer" class="">HttpData</a>で構成されています。ここでは、RxJava の<a href="http://reactivex.io/RxJava/javadoc/io/reactivex/Observable.html" target="_blank" rel="noopener noreferrer" class="">Observable</a>を Armeria の<a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/common/HttpResponse.html" target="_blank" rel="noopener noreferrer" class="">HttpResponse</a>に取り換える過程を、ステップごとに見てみましょう。</p>
<p>データの準備が終わったら、まず Observable の map 演算子を利用して dataStream を HttpData でラップします。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. Fetch data from Reactive Streams Publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Observable&lt;String&gt; dataStream = Observable.just(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Convert string to Armeria HttpData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Observable&lt;HttpData&gt; httpDataStream = dataStream.map(HttpData::ofUtf8);</span><br></span></code></pre></div></div>
<p>どのようにレスポンスするかを決めてレスポンスヘッダーを準備した後、concat 演算子を利用して、上記で準備した httpDataStream と合わせると、HttpHeaders から HttpData に繋がる 1 つのストリームが完成します。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 3. Prepare response headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ResponseHeaders httpHeaders = ResponseHeaders.of(HttpStatus.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4. Concat http header and body stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Observable&lt;HttpObject&gt; responseStream = Observable.concat(Observable.just(httpHeaders), httpDataStream);</span><br></span></code></pre></div></div>
<p>完成したストリームを Observable の toFlowable 関数を利用して Reactive Streams の<a href="https://www.baeldung.com/rxjava-2-flowable" target="_blank" rel="noopener noreferrer" class="">Flowable</a>に変換した後、最終的に Armeria の HttpResponse でラップすれば終わりです。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 5. Convert Observable to Armeria Response Stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpResponse response = HttpResponse.of(responseStream.toFlowable(BackpressureStrategy.BUFFER));</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="armeria-のビルトイン-publisher">Armeria のビルトイン Publisher<a href="#armeria-のビルトイン-publisher" class="hash-link" aria-label="Direct link to Armeria のビルトイン Publisher" title="Direct link to Armeria のビルトイン Publisher" translate="no">​</a></h3>
<p>上記の過程がやや複雑に、あるいは長くて退屈に感じられたかもしれません。そこで、Armeria では Web でストリームデータを送信する方法の標準である<a href="https://tools.ietf.org/html/rfc7464" target="_blank" rel="noopener noreferrer" class="">JSON Text Sequences（RFC 7464）</a>と HTML5 の規格である<a href="https://en.wikipedia.org/wiki/Server-sent_events" target="_blank" rel="noopener noreferrer" class="">Server-sent events</a>に対するビルトイン Publisher を提供します。この publisher を利用すると、Reactive Streams をより便利に Web で送信できます。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Fetch data from Reactive Streams Publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Publisher&lt;String&gt; dataStream = Flux.just(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Convert Publisher to JSON Text Sequences with Armeria HttpResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// with &quot;application/json-seq&quot; MIME type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpResponse httpResponse = JsonTextSequences.fromPublisher(dataStream);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Convert Publisher to Server-sent Events with Armeria HttpResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// with &quot;text/event-stream&quot; MIME type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpResponse httpResponse = ServerSentEvents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .fromPublisher(dataStream, SeverSentEvent::ofData);</span><br></span></code></pre></div></div>
<p>また、ビルトイン publisher をより簡単に使用できるように RxJava 統合をサポートしています。アノテーションのサービスに@ProducesJsonSequences アノテーションを追加し、Observable をそのまま返すと、Armeria で当該プロトコルで自動的に変換します。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import io.reactivex.Observable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.annotation.ProducesJsonSequences;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class RxJavaService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Get(&quot;/json-streaming&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Generate JSON Text Sequences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ProducesJsonSequences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Observable&lt;String&gt; json() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Just return RxJava Observable!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Observable.just(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>以下のように「JsonTextSequences」でエンコードすると、JSON 文字列の最初と最後のところにレコード分離文字（separator）とラインフィード（line feed）が追加されます。また、現在のプロトコルによって HTTP/1 や HTTP/2 に送信される際、違う動作になるべきです。Armeria では現在繋がっているプロトコルに従って、適したタイプのデータを送信します。HTTP/2 の場合は、<a href="https://http2.github.io/http2-spec/#DATA" target="_blank" rel="noopener noreferrer" class="">Data frame</a>の中に JSON データを分けて送り、HTTP/1 の場合は<a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding" target="_blank" rel="noopener noreferrer" class="">chunked transfer encoding</a>を利用して分けて送ります。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-5-b047c88a956d6aea2e8163ea08fd3590.png" width="3278" height="1818" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="spring-webflux-の統合">Spring WebFlux の統合<a href="#spring-webflux-の統合" class="hash-link" aria-label="Direct link to Spring WebFlux の統合" title="Direct link to Spring WebFlux の統合" translate="no">​</a></h2>
<p>Armeria は、さまざまなライブラリーおよびフレームワークとの連携をサポートします。Reactive Streams を使用するために、すでに<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html" target="_blank" rel="noopener noreferrer" class="">Spring WebFlux</a>を使用している場合は、コードを別途修正せずに「armeria-spring-boot-webflux-starter」を依存性に追加（<a href="http://wiki.linecorp.com/" target="_blank" rel="noopener noreferrer" class="">参照</a>）するだけで、Armeria へのマイグレーションを完了できます。このような方法で、WebFlux のネットワークレイヤーである<a href="https://github.com/reactor/reactor-netty" target="_blank" rel="noopener noreferrer" class="">Reactor-Netty</a>を Armeria の Reactive エンジンに取り換えることができます。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-6-0408b3405e56818eebd1d7b8471bbc75.png" width="3120" height="1346" class="img_ev3q"></p>
<p>単にエンジンを取り換えるだけなら「ただ WebFlux だけ使用すればいいんじゃないか」という疑問が湧くかもしれません。エンジンを取り換えることに、果たしてどのようなメリットがあるのでしょう。</p>
<p>エンジンを取り換えると、<a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/spring/ArmeriaServerConfigurator.html" target="_blank" rel="noopener noreferrer" class="">ArmeriaServerConfigurator</a>により Spring で Armeria の機能を追加できるため、既存の Spring ではサポートしない Armeria ならではの機能を活用できます。例えば、以下のように REST API で構成される既存の Spring Webflux サーバーに gRPC や Thrift 機能を追加し、従来と同じく単一ポートでサービスできます。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ArmeriaConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // Configure the server by providing an ArmeriaServerConfigurator bean.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   public ArmeriaServerConfigurator armeriaServerConfigurator() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // Customize the server using the given ServerBuilder. For example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       return builder -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // Add DocService that enables you to send gRPC and Thrift requests from web browser.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           builder.serviceUnder(&quot;/docs&quot;, new DocService());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // Log every message which the server receives and responds.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           builder.decorator(LoggingService.newDecorator());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // Write access log after completing a request.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           builder.accessLogWriter(AccessLogWriter.combined(), false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // You can also bind asynchronous RPC services such as Thrift and gRPC:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           builder.service(THttpService.of(…));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           builder.service(GrpcService.builder()…build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>なお、他にも前述で説明したように decorator 機能を活用し、さらに機能が豊富なサービスを構築できます。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="grpc-のストリームサポート">gRPC のストリームサポート<a href="#grpc-のストリームサポート" class="hash-link" aria-label="Direct link to gRPC のストリームサポート" title="Direct link to gRPC のストリームサポート" translate="no">​</a></h2>
<p>gRPC は、<a href="https://grpc.github.io/grpc-java/javadoc/io/grpc/stub/StreamObserver.html" target="_blank" rel="noopener noreferrer" class="">StreamObserver</a>を利用してストリームをサポートします（<a href="https://grpc.io/docs/tutorials/basic/java/#server-side-streaming-rpc" target="_blank" rel="noopener noreferrer" class="">参照</a>）。Reactive Streams で発行（publish）されるデータを<a href="https://grpc.github.io/grpc-java/javadoc/io/grpc/stub/StreamObserver.html" target="_blank" rel="noopener noreferrer" class="">S</a><a href="https://grpc.github.io/grpc-java/javadoc/io/grpc/stub/StreamObserver.html" target="_blank" rel="noopener noreferrer" class="">t</a><a href="https://grpc.github.io/grpc-java/javadoc/io/grpc/stub/StreamObserver.html" target="_blank" rel="noopener noreferrer" class="">reamObserver</a>で簡単に送信できます。サンプルで見てみます。</p>
<p>まず以下のように protobuf を利用してデータをどのようにやり取りするか、インターフェースを定義します。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package users;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option java_package = &quot;users&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service UserService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Returns all user information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc getAllUsers(UserRequest) returns (stream User) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Push to stream of users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc pushToUsers(stream User) returns (Result) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>会員全体にメールまたはプッシュメッセージを送信したいときは、まずすべてのユーザー情報を取得する必要があります。もし会員数があまりにも多い場合、データを一度に送信することは難しいかもしれません。そのような場合は、以下のような方法で大量のユーザー情報を返すストリームサーバーを gRPC で構築することができます。</p>
<ol>
<li class="">ProjectReactor の Flux を Publisher として使用し、リポジトリからストリームでデータを取得します。</li>
<li class="">データを、gRPC の StreamObservser に変換して外部へ送信します。</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Implement interfaces generated by gRPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public final class UserServiceImpl extends UserServiceImplBase {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void getAllUsers(UserRequest request, StreamObserver&lt;User&gt; responseObserver) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final Flux&lt;User&gt; userPublisher = userRepo.findAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publisher.subscribe(responseObserver::onNext,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            responseObserver::onError,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            responseObserver::onCompleted);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>StreamObserver にも Reactive Streams と同様に onNext、onError、onCompleted 関数が存在するため、それぞれの API に委譲するだけで終わります。</p>
<p>今度は受信する側で、すべてのユーザー情報をストリームで受けることを考えてみましょう。ストリームで受けるには、<a href="https://www.reactive-streams.org/reactive-streams-1.0.0-javadoc/org/reactivestreams/Processor.html" target="_blank" rel="noopener noreferrer" class="">Processor</a>を活用します。Processor は別途の API を持っておらず、Subscriber と Publisher、この 2 つのインターフェースを継承しているだけです。Processor は、データを購読し、購読したデータを再度発行する際に役に立ちます。StreamObserver の onNext で入ってきた新しいユーザー情報を Processor の onNext 関数で送信でき、それを再度購読して必要な作業を追加で行うことができます。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public StreamObserver&lt;User&gt; pushToUsers(StreamObserver&lt;Result&gt; responseObserver) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Processor&lt;User, User&gt; processor = EmitterProcessor.create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Publisher&lt;User&gt; publisher = processor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Subscriber&lt;User&gt; subscriber = processor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Push one-by-one by subscribing publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return new StreamObserver&lt;User&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // subscribe user data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override public void onNext(User user) { processor.onNext(user); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override public void onError(Throwable throwable) { processor.onError(throwable); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override public void onCompleted() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseObserver.onNext(Result.newBuilder().setStatus(200).build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            responseObserver.onCompleted();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>作成した gRPC コードを Armeria で実行してみます。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.Server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.linecorp.armeria.server.grpc.GrpcService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add your grpc service to Armeria GrpcService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var grpcService = GrpcService.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             .addService(new UserServiceImpl())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var server = Server.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   .http(8080)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   .serviceUnder(&quot;/grpc&quot;, grpcService)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   .serviceUnder(&quot;/docs&quot;, new DocService())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   .build();</span><br></span></code></pre></div></div>
<p>このようにして作ったストリームサーバーを利用し、小さいメモリーでも大量のデータをストリームで処理することができます。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="マイクロサービスのための-armeria-の機能">マイクロサービスのための Armeria の機能<a href="#マイクロサービスのための-armeria-の機能" class="hash-link" aria-label="Direct link to マイクロサービスのための Armeria の機能" title="Direct link to マイクロサービスのための Armeria の機能" translate="no">​</a></h2>
<p>Armeria により Reactive Streams を活用すると、大量のデータとトラフィックを柔軟に処理できます。また、RPC でマイクロサービス間の通信も簡単に処理できます。</p>
<p>他にも以下のように、マイクロサービスに必要なさまざまな機能を提供しています。</p>
<ul>
<li class="">クラウド環境でサーバーの位置を把握するため、Kubernetes タイプの DNS（Domain Name System）と ZooKeeper を活用したサービス検索（discovery）を提供（<a href="https://line.github.io/armeria/advanced-zookeeper.html" target="_blank" rel="noopener noreferrer" class="">参照</a>）しています。</li>
<li class="">検索されたサービスは、クライアント側のロードバランシングで直接負荷を分散してサーバーと通信します。それにより障害点を減らすことができます。</li>
<li class=""><a href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/" target="_blank" rel="noopener noreferrer" class="">L7</a>ではないクライアントが、直接サーバーの状態をチェックできます。</li>
<li class="">ログを確認する際、分散されたサーバーにアクセスせずに確認できるように、Kafka でアクセスログを送信します。</li>
<li class="">Micrometer を活用して必要な数値を設定・収集し、Prometheus や Netflix の Atlas のようなアプリケーションモニタリングツールで送信できます。<br>
<img decoding="async" loading="lazy" src="/assets/images/reactive-streams-armeria-2-7-da8c2428f8f86f6212efef177ca57d88.png" width="3076" height="1428" class="img_ev3q"></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="おわりに">おわりに<a href="#おわりに" class="hash-link" aria-label="Direct link to おわりに" title="Direct link to おわりに" translate="no">​</a></h2>
<p>2 回に渡って Reactive Streams と Armeria について紹介しました。一緒に見てみたように Armeria を利用すると、Reactive Streams と高性能、非同期、RPC、HTTP/2 をサポートするうえ障害に柔軟な、より安全なサーバーを構築できます。</p>
<p>Armeria では、記事で触れた機能以外にもさらに多くの機能を提供しています。それに関しては、Armeria の<a href="https://line.github.io/armeria/index.html" target="_blank" rel="noopener noreferrer" class="">公式ホームページ</a>と以下のリンクをご参照ください。</p>
<ul>
<li class="">GitHub: <a href="https://github.com/line/armeria" target="_blank" rel="noopener noreferrer" class="">line/armeria</a></li>
<li class="">Twitter: <a href="https://twitter.com/armeria_project" target="_blank" rel="noopener noreferrer" class="">@armeria_project</a></li>
<li class="">Chat: <a href="https://armeria.dev/s/discord" target="_blank" rel="noopener noreferrer" class="">Discord</a></li>
<li class=""><a href="https://line.github.io/armeria/apidocs/index.html#://" target="_blank" rel="noopener noreferrer" class="">API documentation</a></li>
<li class="">Armeria examples: <a href="https://github.com/line/armeria-examples" target="_blank" rel="noopener noreferrer" class="">line/armeria-examples</a></li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="footnotes">Footnotes<a href="#footnotes" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes" translate="no">​</a></h4>
<ol>
<li class="">
<p><a href="https://line.github.io/armeria/server-grpc.html" target="_blank" rel="noopener noreferrer" class="">gRPC サーバーを Armeria で起動する方法</a>と<a href="https://line.github.io/armeria/server-thrift.html" target="_blank" rel="noopener noreferrer" class="">Thrift サーバーを Armeria で起動する方法</a>をご参照ください。</p>
</li>
<li class="">
<p>Armeria で標準提供するさまざまな decorator は、公式文書と以下の Javadoc でご確認できます。</p>
</li>
</ol>
<ul>
<li class=""><a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/server/SimpleDecoratingHttpService.html" target="_blank" rel="noopener noreferrer" class="">SimpleDecoratingHttpService</a>と<a href="https://line.github.io/armeria/apidocs/com/linecorp/armeria/client/SimpleDecoratingClient.html" target="_blank" rel="noopener noreferrer" class="">SimpleDecoratingClient</a>の Direct Known Subsclasses 項目</li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/line/armeria/edit/main/site-new/src/content/blog/ja/2020-03-26-reactive-streams-armeria-2.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/ja/2020/03/26/reactive-streams-armeria-1"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Let’s play Reactive Streams with Armeria vol.1</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#whats-armeria" class="table-of-contents__link toc-highlight">What’s Armeria?</a><ul><li><a href="#サポートするプロトコル" class="table-of-contents__link toc-highlight">サポートするプロトコル</a></li><li><a href="#サンプルコードで見る-armeria" class="table-of-contents__link toc-highlight">サンプルコードで見る Armeria</a></li><li><a href="#armeria-内の-http2-ストーリム" class="table-of-contents__link toc-highlight">Armeria 内の HTTP/2 ストーリム</a></li></ul></li><li><a href="#reactive-streams-と-armeria-の統合" class="table-of-contents__link toc-highlight">Reactive Streams と Armeria の統合</a><ul><li><a href="#armeria-http-レスポンスの-publisher" class="table-of-contents__link toc-highlight">Armeria HTTP レスポンスの Publisher</a></li><li><a href="#armeria-のビルトイン-publisher" class="table-of-contents__link toc-highlight">Armeria のビルトイン Publisher</a></li></ul></li><li><a href="#spring-webflux-の統合" class="table-of-contents__link toc-highlight">Spring WebFlux の統合</a></li><li><a href="#grpc-のストリームサポート" class="table-of-contents__link toc-highlight">gRPC のストリームサポート</a></li><li><a href="#マイクロサービスのための-armeria-の機能" class="table-of-contents__link toc-highlight">マイクロサービスのための Armeria の機能</a></li><li><a href="#おわりに" class="table-of-contents__link toc-highlight">おわりに</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container--fluid"><div class="row"><div class="newsletterForm_kJQ8 col"><p>Sign up for our newsletters:</p><span class="ant-input-group-wrapper ant-input-group-wrapper-outlined css-198drv2 ant-input-search ant-input-search-with-button signUpForm_fXdf"><span class="ant-input-wrapper ant-input-group css-198drv2"><span class="ant-input-affix-wrapper css-198drv2 ant-input-outlined"><span class="ant-input-prefix"><span role="img" aria-label="mail" class="anticon anticon-mail"><svg viewBox="64 64 896 896" focusable="false" data-icon="mail" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></span></span><input type="search" placeholder="Your e-mail" required="" aria-required="true" class="ant-input css-198drv2" value=""></span><span class="ant-input-group-addon"><button title="Sign up for our newsletters" type="button" class="ant-btn css-198drv2 ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-input-search-button"><span>Subscribe</span></button></span></span></span></div><div class="copyright_C6JK col"><div>© 2015-<!-- -->2026<!-- -->, LY Corporation<br><br><a href="https://terms.line.me/line_rules?lang=en" target="_blank" rel="noopener noreferrer">Privacy policy</a></div><div><span role="img" aria-label="Armeria project logo" aria-hidden="false"><svg class="" style="width:4rem;overflow:hidden;vertical-align:middle" viewBox="20 70 70 70" version="1.1"><title>Armeria project logo</title><g id="layer1" transform="translate(0,-87)"><g id="g4208" transform="matrix(1.3217499,0,0,1.3217499,-49.437761,-33.946772)"><g transform="matrix(0.35277777,0,0,-0.35277777,80.962517,162.47851)" id="g46"><path id="path48" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="M 0,0 -20.785,-12 V -36 L 0,-48 20.785,-36 v 24 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,95.627238,162.47851)" id="g50"><path id="path52" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="M 0,0 V 24 L -20.785,12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,66.297787,170.94517)" id="g54"><path id="path56" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="M 0,0 V 24 L -20.784,12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,88.294897,192.11184)" id="g58"><path id="path60" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="M 0,0 V 24 L -20.785,12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,66.297787,154.01184)" id="g62"><path id="path64" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="m 0,0 v -24 l 20.785,12 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,95.627238,162.47851)" id="g66"><path id="path68" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="m 0,0 v -24 l 20.785,12 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,73.630137,183.64517)" id="g70"><path id="path72" class="secondary_XIgw" style="fill:rgba(255, 255, 255, 0.55)" d="m 0,0 v -24 l 20.785,12 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,73.630137,149.77851)" id="g74"><path id="path76" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 -20.785,-12 0,-24 20.785,-12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,95.627238,154.01184)" id="g78"><path id="path80" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 -20.785,12 -41.569,0 -20.785,-12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,88.294897,166.71184)" id="g82"><path id="path84" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="m 0,0 v 0 -24 l 20.785,12 V 12 L 0,24 -20.785,12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,73.630137,166.71184)" id="g86"><path id="path88" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 20.785,12 0,24 -20.785,12 V -12 L 0,-24 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,88.294897,192.11184)" id="g90"><path id="path92" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 20.785,12 V 36 L 0,24 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,95.627238,170.94517)" id="g94"><path id="path96" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="m 0,0 v -24 l 20.785,12 v 24 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,66.297787,187.8785)" id="g98"><path id="path100" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 20.785,-12 V 12 L 0,24 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,58.965587,166.71184)" id="g102"><path id="path104" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="m 0,0 v -24 l 20.784,-12 v 24 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,80.962517,179.41184)" id="g106"><path id="path108" class="primary_UCAP" style="fill:rgba(255, 255, 255, 1.0)" d="M 0,0 -20.785,12 V -12 L 0,-24 20.785,-12 v 24 z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,88.294897,158.24517)" id="g110"><path id="path112" class="tertiary_B5zC" style="fill:transparent" d="M 0,0 -20.785,12 -41.569,0 -20.785,-12 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,95.627238,170.94517)" id="g114"><path id="path116" class="tertiary_B5zC" style="fill:transparent" d="M 0,0 -20.785,-12 V -36 L 0,-24 Z"></path></g><g transform="matrix(0.35277777,0,0,-0.35277777,66.297787,170.94517)" id="g118"><path id="path120" class="tertiary_B5zC" style="fill:transparent" d="M 0,0 20.785,-12 V -36 L 0,-24 Z"></path></g></g></g></svg></span></div></div></div></div></footer><div id="starBegging_pb0B" class="off_vUOf"><p>Like Armeria?<br>Star us ⭐️</p><span role="button" tabindex="0" class="close_CaW0">×</span> <iframe id="starFrame" class="githubStar" title="github-stars" src="https://ghbtns.com/github-btn.html?user=line&amp;repo=armeria&amp;type=star&amp;count=true&amp;size=large" width="150px" height="30px"></iframe></div></div>
</body>
</html>