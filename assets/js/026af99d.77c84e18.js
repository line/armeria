"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[3634],{28453:(e,r,i)=>{i.d(r,{R:()=>n,x:()=>s});var o=i(96540);const a={},t=o.createContext(a);function n(e){const r=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:n(e.components),o.createElement(t.Provider,{value:r},e.children)}},71615:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>n,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"server/service-registration","title":"Service registration for discovery","description":"You can use ServerListener to register the information of Armeria servers when they start so that","source":"@site/src/content/docs/server/service-registration.mdx","sourceDirName":"server","slug":"/server/service-registration","permalink":"/docs/server/service-registration","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/server/service-registration.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Serving Server-Sent Events","permalink":"/docs/server/sse"},"next":{"title":"Handling a multipart request","permalink":"/docs/server/multipart"}}');var a=i(74848),t=i(28453);const n={},s="Service registration for discovery",c={},d=[{value:"ZooKeeper-based service registration with <code>ZooKeeperUpdatingListener</code>",id:"zookeeper-based-service-registration-with-zookeeperupdatinglistener",level:2},{value:"Eureka-based service registration with <code>EurekaUpdatingListener</code>",id:"eureka-based-service-registration-with-eurekaupdatinglistener",level:2},{value:"Consul-based service registration with <code>ConsulUpdatingListener</code>",id:"consul-based-service-registration-with-consulupdatinglistener",level:2}];function l(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{RequiredDependencies:i}=r;return i||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("RequiredDependencies",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"service-registration-for-discovery",children:"Service registration for discovery"})}),"\n",(0,a.jsxs)(r.p,{children:["You can use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerListener.html",children:"ServerListener"})," to register the information of Armeria servers when they start so that\na client uses the information to distribute its requests to the servers autonomously, unlike\ntraditional server-side load balancing where the requests go through a dedicated load balancer such as\n",(0,a.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Multilayer_switch#Layer_4%E2%80%937_switch,_web_switch,_or_content_switch",children:"L4 and L7 switches"}),"."]}),"\n",(0,a.jsxs)(r.p,{children:["Armeria provides 2 ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerListener.html",children:"ServerListener"})," implementations for service registration:"]}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperUpdatingListener.html",children:"ZooKeeperUpdatingListener"})," which registers to ",(0,a.jsx)(r.a,{href:"https://zookeeper.apache.org/",children:"ZooKeeper"}),"\nas an ephemeral node."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/eureka/EurekaUpdatingListener.html",children:"EurekaUpdatingListener"})," which registers to ",(0,a.jsx)(r.a,{href:"https://github.com/Netflix/eureka/",children:"Eureka"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(r.h2,{id:"zookeeper-based-service-registration-with-zookeeperupdatinglistener",children:["ZooKeeper-based service registration with ",(0,a.jsx)(r.code,{children:"ZooKeeperUpdatingListener"})]}),"\n",(0,a.jsxs)(r.p,{children:["First, You need the ",(0,a.jsx)(r.code,{children:"armeria-zookeeper3"})," dependency:"]}),"\n",(0,a.jsx)(i,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-zookeeper3"}]}),"\n",(0,a.jsxs)(r.p,{children:["Then, use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperUpdatingListener.html",children:"ZooKeeperUpdatingListener"})," and ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperRegistrationSpec.html",children:"ZooKeeperRegistrationSpec"})," to register your server\nto a ZooKeeper cluster:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.zookeeper.ZooKeeperRegistrationSpec;\nimport com.linecorp.armeria.server.zookeeper.ZooKeeperUpdatingListener;\n\nString zkConnectionStr = "myZooKeeperHost:2181";\nString znodePath = "/myProductionEndpoints";\nString serviceName = "catalog";\nZooKeeperRegistrationSpec registrationSpec =\n        ZooKeeperRegistrationSpec.curator(serviceName);\nZooKeeperUpdatingListener listener =\n        ZooKeeperUpdatingListener.builder(zkConnectionStr, znodePath, registrationSpec)\n                                 .sessionTimeoutMillis(10000)\n                                 .build();\nServer server = ...\nserver.addListener(listener);\nserver.start();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["The ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperRegistrationSpec.html",children:"ZooKeeperRegistrationSpec"})," is used to convert the information of your server to a binary\nrepresentation. The ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperUpdatingListener.html",children:"ZooKeeperUpdatingListener"})," registers the binary representation to the specified\nznode as a member of the cluster when your server starts up. Each server will represent itself as\n",(0,a.jsx)(r.a,{href:"https://zookeeper.apache.org/doc/r3.4.10/zookeeperOver.html#Nodes+and+ephemeral+nodes",children:"an EPHEMERAL node"}),",\nwhich means when a server stops or a network partition between your server and ZooKeeper cluster occurs,\nthe node of the server that became unreachable will be deleted automatically by ZooKeeper."]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperRegistrationSpec.html#curator(java.lang.String)",children:"ZooKeeperRegistrationSpec#curator(String)"})," uses the format of\n",(0,a.jsx)(r.a,{href:"https://curator.apache.org/docs/service-discovery/",children:"Curator Service Discovery"})," which is compatible\nwith ",(0,a.jsx)(r.a,{href:"https://cloud.spring.io/spring-cloud-zookeeper/reference/html/",children:"Spring Cloud Zookeeper"}),".\nYou can use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperRegistrationSpec.html#serverSets()",children:"ZooKeeperRegistrationSpec#serverSets()"})," that applies the format of\n",(0,a.jsx)(r.a,{href:"https://twitter.github.io/finagle/docs/com/twitter/serverset.html",children:"Finagle ServerSets"}),".\nIf you want to use your own format, you can implement the ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperRegistrationSpec.html",children:"ZooKeeperRegistrationSpec"}),"."]}),"\n",(0,a.jsxs)(r.p,{children:["In the example above, we used the ZooKeeper connection string(",(0,a.jsx)(r.code,{children:'"myZooKeeperHost:2181"'}),") to connect to\nthe ZooKeeper cluster. Instead, you can use an existing\n",(0,a.jsx)(r.a,{href:"https://curator.apache.org/apidocs/org/apache/curator/framework/CuratorFramework.html",children:"CuratorFramework"}),"\ninstance."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:"import org.apache.curator.framework.CuratorFramework;\n\nCuratorFramework client = ...\nString znodePath = ...\nZooKeeperRegistrationSpec registrationSpec = ...\nZooKeeperUpdatingListener listener =\n        ZooKeeperUpdatingListener.builder(client, znodePath, registrationSpec)\n                                 .build();\nServer server = ...\nserver.addListener(listener);\nserver.start();\n"})}),"\n",(0,a.jsxs)(r.p,{children:["For more information, please refer to the API documentation of the\n",(0,a.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/package-summary.html",children:"com.linecorp.armeria.server.zookeeper"})," package."]}),"\n",(0,a.jsx)(r.admonition,{type:"tip",children:(0,a.jsxs)(r.p,{children:["See ",(0,a.jsx)(r.a,{href:"/docs/client/service-discovery#zookeeper-based-service-discovery-with-zookeeperendpointgroup",children:"ZooKeeper service discovery"}),"."]})}),"\n",(0,a.jsxs)(r.h2,{id:"eureka-based-service-registration-with-eurekaupdatinglistener",children:["Eureka-based service registration with ",(0,a.jsx)(r.code,{children:"EurekaUpdatingListener"})]}),"\n",(0,a.jsxs)(r.p,{children:["First, You need the ",(0,a.jsx)(r.code,{children:"armeria-eureka"})," dependency:"]}),"\n",(0,a.jsx)(i,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-eureka"}]}),"\n",(0,a.jsxs)(r.p,{children:["Then, use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/eureka/EurekaUpdatingListener.html",children:"EurekaUpdatingListener"})," to register your server to the Eureka:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.eureka.EurekaUpdatingListener;\n\nEurekaUpdatingListener listener =\n        EurekaUpdatingListener.of("https://eureka.com:8001/eureka/v2");\n\nServerBuilder sb = Server.builder();\nsb.serverListener(listener);\nsb.build().start();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["If you want to specify the ",(0,a.jsx)(r.a,{href:"https://github.com/Netflix/eureka/wiki/Eureka-REST-operations",children:"properties"}),"\nof the ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/Server.html",children:"Server"}),", use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/eureka/EurekaUpdatingListenerBuilder.html",children:"EurekaUpdatingListenerBuilder"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.eureka.EurekaUpdatingListenerBuilder;\n\nEurekaUpdatingListenerBuilder builder =\n        EurekaUpdatingListener.builder("https://eureka.com:8001/eureka/v2")\n                              .instanceId("i-00000000")\n                              .hostname("armeria.service.1")\n                              // If ipAddr is not specified, it\'s automatically filled\n                              // using SystemInfo.defaultNonLoopbackIpV4Address().\n                              .ipAddr("192.168.10.10")\n                              .vipAddress("armeria.service.com:8080");\n\nEurekaUpdatingListener listener = builder.build();\nServerBuilder sb = Server.builder();\nsb.serverListener(listener);\nsb.build().start();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["For more information, please refer to the API documentation of the\n",(0,a.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/eureka/package-summary.html",children:"com.linecorp.armeria.server.eureka"})," package."]}),"\n",(0,a.jsx)(r.admonition,{type:"tip",children:(0,a.jsxs)(r.p,{children:["See ",(0,a.jsx)(r.a,{href:"/docs/client/service-discovery#eureka-based-service-discovery-with-eurekaendpointgroup",children:"Eureka service discovery"}),"."]})}),"\n",(0,a.jsxs)(r.h2,{id:"consul-based-service-registration-with-consulupdatinglistener",children:[(0,a.jsx)(r.a,{href:"https://www.consul.io",children:"Consul"}),"-based service registration with ",(0,a.jsx)(r.code,{children:"ConsulUpdatingListener"})]}),"\n",(0,a.jsxs)(r.p,{children:["First, You need the ",(0,a.jsx)(r.code,{children:"armeria-consul"})," dependency:"]}),"\n",(0,a.jsx)(i,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-consul"}]}),"\n",(0,a.jsxs)(r.p,{children:["Then, use ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/consul/ConsulUpdatingListener.html",children:"ConsulUpdatingListener"})," to register your server to the Consul:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.consul.ConsulUpdatingListener;\n\nConsulUpdatingListener listener =\n    ConsulUpdatingListener.of("http://my-consul.com:8500", "my-service");\n\nServerBuilder sb = Server.builder();\nsb.serverListener(listener);\nsb.build().start();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["If you want to specify an ",(0,a.jsx)(r.a,{href:"https://www.consul.io/api/agent/check#http",children:"HTTP check"})," or\n",(0,a.jsx)(r.a,{href:"https://www.consul.io/api-docs/agent/service#tags",children:"tags"})," to the ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/Server.html",children:"Server"}),",\nuse ",(0,a.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/consul/ConsulUpdatingListenerBuilder.html",children:"ConsulUpdatingListenerBuilder"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.consul.ConsulUpdatingListenerBuilder;\n\nConsulUpdatingListenerBuilder builder =\n    ConsulUpdatingListener.builder("http://my-consul.com:8500", "my-service")\n                          .check("http://my.hostname.local:8080/internal/l7check")\n                          .tags("production", "v1");\n\nConsulUpdatingListener listener = builder.build();\nServerBuilder sb = Server.builder();\nsb.serverListener(listener);\nsb.build().start();\n'})}),"\n",(0,a.jsxs)(r.p,{children:["For more information, please refer to the API documentation of the\n",(0,a.jsx)(r.a,{href:"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/consul/package-summary.html",children:"com.linecorp.armeria.server.consul"})," package."]}),"\n",(0,a.jsx)(r.admonition,{type:"tip",children:(0,a.jsxs)(r.p,{children:["See ",(0,a.jsx)(r.a,{href:"/docs/client/service-discovery#consul-based-service-discovery-with-consulendpointgroup",children:"Consul service discovery"}),"."]})})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);