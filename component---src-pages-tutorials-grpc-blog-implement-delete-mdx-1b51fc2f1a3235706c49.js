"use strict";(self.webpackChunkarmeria_site=self.webpackChunkarmeria_site||[]).push([[7631],{72834:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return p},default:function(){return h},pageTitle:function(){return s}});var n,r=a(63366),l=(a(67294),a(64983)),i=a(89791),o=["components"],s="Implementing DELETE operation",p={},c=(n="TutorialSteps",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",e)}),m={pageTitle:s,_frontmatter:p},d=i.Z;function h(e){var t=e.components,a=(0,r.Z)(e,o);return(0,l.kt)(d,Object.assign({},m,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"implementing-delete-operation",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h1",href:"#implementing-delete-operation","aria-label":"implementing delete operation permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Implementing DELETE operation"),(0,l.kt)("h6",{className:"inlinePageToc",role:"navigation"},"Table of contents"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#what-you-need"},"What you need")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-implement-server-side"},"1. Implement server-side")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2-implement-client-side"},"2. Implement client-side")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#3-test-run"},"3. Test run")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#whats-next"},"What's next"))),(0,l.kt)("p",null,"So far, we've created, read, and updated a blog post. Now, let's implement\nand make a call to finally delete a blog post."),(0,l.kt)(c,{current:6,mdxType:"TutorialSteps"}),(0,l.kt)("h2",{id:"what-you-need",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h2",href:"#what-you-need","aria-label":"what you need permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"What you need"),(0,l.kt)("p",null,"You need to have the files obtained from previous steps:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/tutorials/grpc/blog/define-service#compile-proto-file"},"Java code generated")),(0,l.kt)("li",{parentName:"ul"},"Main.java"),(0,l.kt)("li",{parentName:"ul"},"BlogService.java"),(0,l.kt)("li",{parentName:"ul"},"BlogClient.java")),(0,l.kt)("h2",{id:"1-implement-server-side",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h2",href:"#1-implement-server-side","aria-label":"1 implement server side permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"1. Implement server-side"),(0,l.kt)("p",null,"Let's implement a service method ",(0,l.kt)("inlineCode",{parentName:"p"},"deleteBlogPost()")," in ",(0,l.kt)("inlineCode",{parentName:"p"},"BlogService.java")," we've been working on."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Add a service method, ",(0,l.kt)("inlineCode",{parentName:"p"},"deleteBlogPost()"),"."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:"filename=BlogService.java",filename:"BlogService.java"},'import example.armeria.blog.grpc.Blog.DeleteBlogPostRequest;\n\npublic class BlogService extends BlogServiceGrpc.BlogServiceImplBase {\n  @Override\n  public void deleteBlogPost(DeleteBlogPostRequest request, StreamObserver<Empty> responseObserver) {\n    try {\n      // Simulate a blocking API call.\n      Thread.sleep(100);\n    } catch (InterruptedException e) {\n      throw new RuntimeException(e);\n    }\n\n    final BlogPost removed = blogPosts.remove(request.getId());\n    if (removed == null) {\n      responseObserver.onError(\n        new BlogNotFoundException("The blog post does not exist. ID: " + request.getId()));\n    } else {\n        responseObserver.onNext(Empty.getDefaultInstance());\n        responseObserver.onCompleted();\n    }\n }\n}\n'))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Add Armeria's ",(0,l.kt)("a",{parentName:"p",href:"type://GrpcServiceBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/grpc/GrpcServiceBuilder.html"},"type://GrpcServiceBuilder"),"'s blocking task executor to make all gRPC methods executed in the blocking task executor's thread pool."),(0,l.kt)("p",{parentName:"li"},"By default, service methods are executed on the event loop and are expected to be implemented asynchronously. To implement blocking logic, call ",(0,l.kt)("inlineCode",{parentName:"p"},"useBlockingTaskExecutor(true)"),"."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:"filename=Main.java",filename:"Main.java"},"private static Server newServer(int port) throws Exception {\n  final GrpcService grpcService =\n          GrpcService.builder().addService(new BlogService())\n                               .exceptionMapping(new GrpcExceptionHandler())\n                               .useBlockingTaskExecutor(true)\n                               .build();\n}\n")))),(0,l.kt)("h2",{id:"2-implement-client-side",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h2",href:"#2-implement-client-side","aria-label":"2 implement client side permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"2. Implement client-side"),(0,l.kt)("p",null,"Add a method ",(0,l.kt)("inlineCode",{parentName:"p"},"deleteBlogPost()")," to send a request to update a blog post."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:"filename=BlogClient.java",filename:"BlogClient.java"},"import example.armeria.blog.grpc.Blog.DeleteBlogPostRequest;\n\nclass BlogClient {\n  static void deleteBlogPost(int id) {\n    final DeleteBlogPostRequest request = DeleteBlogPostRequest.newBuilder().setId(id).build();\n    try {\n      client.deleteBlogPost(request);\n    } catch (StatusRuntimeException statusException) {\n      // Handle exception\n    }\n  }\n}\n")),(0,l.kt)("h2",{id:"3-test-run",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h2",href:"#3-test-run","aria-label":"3 test run permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"3. Test run"),(0,l.kt)("p",null,"Let's test deleting a blog. We know that our client creates a blog post by default when it's executed and that the ID of the first one has been ",(0,l.kt)("inlineCode",{parentName:"p"},"0")," always."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Call the delete method we just implemented followed by ",(0,l.kt)("inlineCode",{parentName:"p"},"listBlogPosts()")," to see that no post with the ID ",(0,l.kt)("inlineCode",{parentName:"p"},"0")," exists after deleting the post."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:"filename=BlogClient.java",filename:"BlogClient.java"},'static void testRun() {\n  createBlogPost("Another blog post", "Creating a post via createBlogPost().");\n  deleteBlogPost(0);\n  listBlogPosts();\n}\n'))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"/tutorials/grpc/blog/run-service#3-serve-the-service"},"Re-run the server"),". Your server is running if you see the following message."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[armeria-boss-http-*:8080] INFO com.linecorp.armeria.server.Server - Serving HTTP at /[0:0:0:0:0:0:0:0]:8080 - http://127.0.0.1:8080/\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Run the client. The number of blog posts in the log depends on how you've tested so far. Anyhow, since we are attempting to delete the first post, you won't have a problem, unless you've deleted it already. You can check that the list of posts retrieved start from ",(0,l.kt)("inlineCode",{parentName:"p"},"1"),", which is the second post."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[armeria-common-worker-nio-2-1] DEBUG c.l.a.client.logging.LoggingClient - [creqId=8573ef34, ... \n[http://127.0.0.1:8080/example.armeria.blog.grpc.BlogService/ListBlogPosts#POST] \nResponse: ..., content=CompletableRpcResponse{blogs {\nid: 1\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Now, while keeping the server running, run the client again, attempting to delete the post with the ID ",(0,l.kt)("inlineCode",{parentName:"p"},"0"),", which does not exist any longer."),(0,l.kt)("p",{parentName:"li"},"You should see the exception logged as the following."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"io.grpc.StatusException: NOT_FOUND: The blog post does not exist. ID: 0\n")))),(0,l.kt)("h2",{id:"whats-next",style:{position:"relative"}},(0,l.kt)("a",{parentName:"h2",href:"#whats-next","aria-label":"whats next permalink",className:"anchor before"},(0,l.kt)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"What's next"),(0,l.kt)("p",null,"Here, we've implemented a service method and client method for deleting a blog post. Next, we'll finally ",(0,l.kt)("a",{parentName:"p",href:"/tutorials/grpc/blog/add-docservice"},"add")," Armeria's ",(0,l.kt)("a",{parentName:"p",href:"/docs/server-docservice"},"Documentation service")," to our service."),(0,l.kt)(c,{current:6,mdxType:"TutorialSteps"}))}h.isMDXComponent=!0},89791:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(25444),r=a(67294),l=JSON.parse('{"root":["index"],"Useful links":{"User manual":"/docs","API documentation":"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html","Release notes":"/release-notes"},"REST service":["rest/blog","rest/blog/create-server","rest/blog/prepare-data-object","rest/blog/add-services-to-server","rest/blog/implement-create","rest/blog/implement-read","rest/blog/implement-update","rest/blog/implement-delete"],"gRPC service":["grpc/blog","grpc/blog/define-service","grpc/blog/run-service","grpc/blog/implement-create","grpc/blog/implement-read","grpc/blog/implement-update","grpc/blog/implement-delete","grpc/blog/add-docservice"],"Thrift service":{"Coming soon":null}}'),i=a(46731),o=function(e){var t=(0,n.useStaticQuery)("3172452987").allMdx.nodes;return r.createElement(i.Z,Object.assign({},e,{candidateMdxNodes:t,index:l,prefix:"tutorials",menuTitle:!0,pageTitleSuffix:"Armeria tutorial"}))}}}]);
//# sourceMappingURL=component---src-pages-tutorials-grpc-blog-implement-delete-mdx-1b51fc2f1a3235706c49.js.map