"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[1423],{28453:(e,r,o)=>{o.d(r,{R:()=>t,x:()=>s});var i=o(96540);const n={},a=i.createContext(n);function t(e){const r=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),i.createElement(a.Provider,{value:r},e.children)}},53059:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"server/cors","title":"Configuring CORS","description":"Armeria provides a way to configure Cross-origin resource sharing (CORS) policy for specific origins or","source":"@site/src/content/docs/server/cors.mdx","sourceDirName":"server","slug":"/server/cors","permalink":"/docs/server/cors","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/server/cors.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Writing an access log","permalink":"/docs/server/access-log"},"next":{"title":"Serving Server-Sent Events","permalink":"/docs/server/sse"}}');var n=o(74848),a=o(28453);const t={},s="Configuring CORS",c={},l=[{value:"Allowing any origin",id:"allowing-any-origin",level:2},{value:"Allowing specific origins",id:"allowing-specific-origins",level:2},{value:"Applying different policies for different origins",id:"applying-different-policies-for-different-origins",level:2},{value:"Applying a policy to the specific paths",id:"applying-a-policy-to-the-specific-paths",level:2},{value:"Configuring CORS via annotation",id:"configuring-cors-via-annotation",level:2}];function d(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"configuring-cors",children:"Configuring CORS"})}),"\n",(0,n.jsxs)(r.p,{children:["Armeria provides a way to configure Cross-origin resource sharing (CORS) policy for specific origins or\nany origin via ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsServiceBuilder.html",children:"CorsServiceBuilder"}),". For more information about CORS,\nvisit ",(0,n.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing",children:"Wikipedia's CORS page"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"allowing-any-origin",children:"Allowing any origin"}),"\n",(0,n.jsxs)(r.p,{children:["To configure CORS Service allowing any origin (*), use ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsService.html#builderForAnyOrigin()",children:"CorsService#builderForAnyOrigin()"}),", e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.HttpMethod;\nimport com.linecorp.armeria.server.HttpService;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.cors.CorsService;\n\nHttpService myService = (ctx, req) -> ...;\nFunction<? super HttpService, CorsService> corsService =\n        CorsService.builderForAnyOrigin()\n                   .allowCredentials()\n                   .allowRequestMethods(HttpMethod.POST, HttpMethod.GET)\n                   .allowRequestHeaders("allow_request_header")\n                   .exposeHeaders("expose_header_1", "expose_header_2")\n                   .preflightResponseHeader("x-preflight-cors", "Hello CORS")\n                   .newDecorator();\n\nServerBuilder sb = Server.builder()\n                         .service("/message", myService.decorate(corsService));\n'})}),"\n",(0,n.jsx)(r.h2,{id:"allowing-specific-origins",children:"Allowing specific origins"}),"\n",(0,n.jsxs)(r.p,{children:["To configure CORS Service allowing specific origins, use ",(0,n.jsx)(r.code,{children:"CorsService.builder()"}),", e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'HttpService myService = (ctx, req) -> ...;\nFunction<? super HttpService, CorsService> corsService =\n        CorsService.builder("http://example.com")\n                   .allowCredentials()\n                   .allowNullOrigin() // \'Origin: null\' will be accepted.\n                   .allowRequestMethods(HttpMethod.POST, HttpMethod.GET)\n                   .allowRequestHeaders("allow_request_header")\n                   .exposeHeaders("expose_header_1", "expose_header_2")\n                   .preflightResponseHeader("x-preflight-cors", "Hello CORS")\n                   .newDecorator();\n\nServerBuilder sb = Server.builder()\n                         .service("/message", myService.decorate(corsService));\n'})}),"\n",(0,n.jsx)(r.h2,{id:"applying-different-policies-for-different-origins",children:"Applying different policies for different origins"}),"\n",(0,n.jsxs)(r.p,{children:["To configure different policies for different groups of origins, use ",(0,n.jsx)(r.code,{children:"andForOrigins()"})," or ",(0,n.jsx)(r.code,{children:"andForOrigin()"}),"\nmethod which creates a new ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/ChainedCorsPolicyBuilder.html",children:"ChainedCorsPolicyBuilder"})," with the specific origins.\nCall ",(0,n.jsx)(r.code,{children:"and()"})," to return to ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsServiceBuilder.html",children:"CorsServiceBuilder"})," once you are done with building a policy, e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'HttpService myService = (ctx, req) -> ...;\nFunction<? super HttpService, CorsService> corsService =\n        CorsService.builder("http://example.com")\n                   .allowCredentials()\n                   .allowNullOrigin() // \'Origin: null\' will be accepted.\n                   .allowRequestMethods(HttpMethod.POST, HttpMethod.GET)\n                   .allowRequestHeaders("allow_request_header")\n                   .exposeHeaders("expose_header_1", "expose_header_2")\n                   .preflightResponseHeader("x-preflight-cors", "Hello CORS")\n                   .maxAge(3600)\n                   .andForOrigins("http://example2.com")\n                   .allowCredentials()\n                   .allowRequestMethods(HttpMethod.GET)\n                   .allowRequestHeaders("allow_request_header2")\n                   .exposeHeaders("expose_header_3", "expose_header_4")\n                   .and()\n                   .newDecorator();\n\nServerBuilder sb = Server.builder()\n                         .service("/message", myService.decorate(corsService));\n'})}),"\n",(0,n.jsxs)(r.p,{children:["You can also directly add a ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsPolicy.html",children:"CorsPolicy"})," created by a ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsPolicyBuilder.html",children:"CorsPolicyBuilder"}),", e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.cors.CorsPolicyBuilder;\n\nHttpService myService = (ctx, req) -> ...;\nFunction<? super HttpService, CorsService> corsService =\n        CorsService.builder("http://example.com")\n                   .allowCredentials()\n                   .allowNullOrigin() // \'Origin: null\' will be accepted.\n                   .allowRequestMethods(HttpMethod.POST, HttpMethod.GET)\n                   .allowRequestHeaders("allow_request_header")\n                   .exposeHeaders("expose_header_1", "expose_header_2")\n                   .preflightResponseHeader("x-preflight-cors", "Hello CORS")\n                   .maxAge(3600)\n                   .addPolicy(CorsPolicy.builder("http://example2.com")\n                                        .allowCredentials()\n                                        .allowRequestMethods(HttpMethod.GET)\n                                        .allowRequestHeaders("allow_request_header2")\n                                        .exposeHeaders("expose_header_3", "expose_header_4")\n                                        .build())\n                   .newDecorator();\n\nServerBuilder sb = Server.builder()\n                         .service("/message", myService.decorate(corsService));\n'})}),"\n",(0,n.jsx)(r.h2,{id:"applying-a-policy-to-the-specific-paths",children:"Applying a policy to the specific paths"}),"\n",(0,n.jsxs)(r.p,{children:["To configure a policy to the specific paths, you can use ",(0,n.jsx)(r.code,{children:"route()"})," methods in the\n",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/CorsServiceBuilder.html",children:"CorsServiceBuilder"})," and ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/cors/ChainedCorsPolicyBuilder.html",children:"ChainedCorsPolicyBuilder"}),". They can help you to adjust the scope that\na policy is applied to, e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'HttpService myService = (ctx, req) -> ...;\nFunction<? super HttpService, CorsService> corsService =\n        CorsService.builder("http://example.com")\n                   // CORS policy will be applied for the path that starts with \'/message/web/api/\'.\n                   .route("prefix:/message/web/api/")\n                   .allowRequestMethods(HttpMethod.POST, HttpMethod.GET)\n                   .newDecorator();\nServerBuilder sb = Server.builder()\n                         .service("/message", myService.decorate(corsService));\n'})}),"\n",(0,n.jsx)(r.admonition,{type:"tip",children:(0,n.jsxs)(r.p,{children:["Please refer to the ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/Route.html",children:"Route"})," in order to learn how to specify a path pattern."]})}),"\n",(0,n.jsx)(r.h2,{id:"configuring-cors-via-annotation",children:"Configuring CORS via annotation"}),"\n",(0,n.jsxs)(r.p,{children:["You can also configure CORS for ",(0,n.jsx)(r.a,{href:"/docs/server/annotated-service",children:"Annotated services"})," using the\n",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/decorator/CorsDecorator.html",children:"@CorsDecorator"})," annotation, e.g."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.annotation.AdditionalHeader;\nimport com.linecorp.armeria.server.annotation.Get;\nimport com.linecorp.armeria.server.annotation.decorator.CorsDecorator;\n\nObject annotatedService = new Object() {\n    @Get("/get")\n    @CorsDecorator(origins = "http://example.com", credentialsAllowed = true,\n                   nullOriginAllowed = true, exposedHeaders = "expose_header",\n                   allowedRequestMethods = HttpMethod.GET, allowedRequestHeaders = "allow_header",\n                   preflightResponseHeaders = {\n                       @AdditionalHeader(name = "preflight_header", value = "preflight_value")\n                   })\n    // In case you want to configure different CORS policies for different origins.\n    @CorsDecorator(origins = "http://example2.com", credentialsAllowed = true)\n    public HttpResponse get() {\n        return HttpResponse.of(HttpStatus.OK);\n    }\n\n    @Post("/post")\n    // In case you want to allow any origin (*):\n    @CorsDecorator(origins = "*", exposedHeaders = "expose_header")\n    // You can not add a policy after adding the decorator allowing any origin (*).\n    public HttpResponse post() {\n        return HttpResponse.of(HttpStatus.OK)\n    }\n};\n\nServer s = Server.builder()\n                 .annotatedService("/example", annotatedService)\n                 .build();\n'})}),"\n",(0,n.jsxs)(r.p,{children:["You can also use ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/decorator/CorsDecorator.html",children:"@CorsDecorator"})," at the class level to apply the decorator to all service methods in the class.\nNote that the ",(0,n.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/decorator/CorsDecorator.html",children:"@CorsDecorator"})," annotation specified at the method level takes precedence over what's specified\nat the class level:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'// This decorator will be ignored for the path "/post".\n@CorsDecorator(origins = "http://example.com", credentialsAllowed = true)\nclass MyAnnotatedService {\n    @Get("/get")\n    public HttpResponse get() {\n        return HttpResponse.of(HttpStatus.OK);\n    }\n\n    @Post("/post")\n    @CorsDecorator(origins = "http://example2.com", credentialsAllowed = true)\n    public HttpResponse post() {\n        return HttpResponse.of(HttpStatus.OK);\n    }\n}\n'})}),"\n",(0,n.jsxs)(r.p,{children:["If you want to allow a CORS policy to the specific paths, you can use ",(0,n.jsx)(r.code,{children:"pathPatterns"})," property:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'// This policy will be applied only to the paths matched by the pattern.\n@CorsDecorator(origins = "http://example.com", pathPatterns = "glob:/**/web/api", credentialsAllowed = true)\nclass MyAnnotatedService {\n    ...\n}\n'})})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);