"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[9426],{16881:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"server/sse","title":"Serving Server-Sent Events","description":"Visit armeria-examples to find a fully working example.","source":"@site/src/content/docs/server/sse.mdx","sourceDirName":"server","slug":"/server/sse","permalink":"/docs/server/sse","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/server/sse.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Configuring CORS","permalink":"/docs/server/cors"},"next":{"title":"Service registration for discovery","permalink":"/docs/server/service-registration"}}');var s=t(74848),o=t(28453);const i={},a="Serving Server-Sent Events",c={},l=[{value:"Adjusting the request timeout",id:"adjusting-the-request-timeout",level:2}];function v(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"serving-server-sent-events",children:"Serving Server-Sent Events"})}),"\n",(0,s.jsx)(r.admonition,{type:"tip",children:(0,s.jsxs)(r.p,{children:["Visit ",(0,s.jsx)(r.a,{href:"https://github.com/line/armeria-examples",children:"armeria-examples"})," to find a fully working example."]})}),"\n",(0,s.jsxs)(r.p,{children:["A traditional web page has to send a request to the server in order to receive new data.\nWith ",(0,s.jsx)(r.a,{href:"https://www.w3.org/TR/eventsource/",children:"Server-Sent Events"}),", however, it is possible for a server to push a new data to\nthe web page whenever it wants to."]}),"\n",(0,s.jsxs)(r.p,{children:["Armeria provides several factory methods by ",(0,s.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/streaming/ServerSentEvents.html",children:"ServerSentEvents"})," class which help a user to easily send\nan event stream to the client. The following example shows how to build a server which serves services\nsending a response with ",(0,s.jsx)(r.a,{href:"https://www.w3.org/TR/eventsource/",children:"Server-Sent Events"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.sse.ServerSentEvent;\nimport com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.streaming.ServerSentEvents;\nimport reactor.core.publisher.Flux;\n\nServer server =\n        Server.builder()\n              // Emit Server-Sent Events with the SeverSentEvent instances published by a publisher.\n              .service("/sse1",\n                       (ctx, req) -> ServerSentEvents.fromPublisher(\n                               Flux.just(ServerSentEvent.ofData("foo"), ServerSentEvent.ofData("bar"))))\n              // Emit Server-Sent Events with converting instances published by a publisher into\n              // ServerSentEvent instances.\n              .service("/sse2",\n                       (ctx, req) -> ServerSentEvents.fromPublisher(\n                               Flux.just("foo", "bar"), ServerSentEvent::ofData))\n              .build();\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Of course, Armeria provides ",(0,s.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ProducesEventStream.html",children:"@ProducesEventStream"})," annotation in order to convert the result objects\nreturned from an annotated service method into ",(0,s.jsx)(r.a,{href:"https://www.w3.org/TR/eventsource/",children:"Server-Sent Events"}),".\nThe following example shows how to use the annotation."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.common.sse.ServerSentEvent;\nimport com.linecorp.armeria.server.annotation.Get;\nimport com.linecorp.armeria.server.annotation.ProducesEventStream;\nimport org.reactivestreams.Publisher;\n\n@Get("/sse")\n@ProducesEventStream\npublic Publisher<ServerSentEvent> sse() {\n    return Flux.just(ServerSentEvent.ofData("foo"), ServerSentEvent.ofData("bar"));\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"adjusting-the-request-timeout",children:"Adjusting the request timeout"}),"\n",(0,s.jsxs)(r.p,{children:["An event stream may be sent for a longer period than the configured timeout depending on the application.\nIt even can continue infinitely, for example streaming stock quotes. Such a long running stream may be\nterminated prematurely because Armeria has the default request timeout of ",(0,s.jsx)(r.code,{children:"10"})," seconds, i.e. your stream\nwill be broken after 10 seconds at most. Therefore, you must adjust the timeout if your event stream lasts\nlonger than the configured timeout. The following example shows how to adjust the timeout of a single request.\nAs you might know, it is not only for ",(0,s.jsx)(r.a,{href:"https://www.w3.org/TR/eventsource/",children:"Server-Sent Events"}),", so you can use this method for\nany requests which you want to adjust timeout for."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:'import java.time.Duration;\nimport com.linecorp.armeria.common.sse.ServerSentEvent;\nimport com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.streaming.ServerSentEvents;\nimport reactor.core.publisher.Flux;\n\nServer server =\n        Server.builder()\n              // This service infinitely sends numbers as the data of events every second.\n              .service("/long-sse", (ctx, req) -> {\n                  // Note that you MUST adjust the request timeout if you want to send events for a\n                  // longer period than the configured request timeout. The timeout can be disabled by\n                  // setting 0 like the below, but it is NOT RECOMMENDED in the real world application,\n                  // because it can leave a lot of unfinished requests.\n                  ctx.setRequestTimeout(Duration.ZERO);\n                  return ServerSentEvents.fromPublisher(\n                          Flux.interval(Duration.ofSeconds(1))\n                              .map(sequence -> ServerSentEvent.ofData(Long.toString(sequence))));\n              })\n              .build();\n'})})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(v,{...e})}):v(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>a});var n=t(96540);const s={},o=n.createContext(s);function i(e){const r=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);