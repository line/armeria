"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[3258],{28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>s});var n=i(96540);const o={},r=n.createContext(o);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},50784:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"client/timeouts","title":"Overriding client timeouts","description":"Sometimes, the default timeouts used by the Armeria clients do not suit a particular scenario well.","source":"@site/src/content/docs/client/timeouts.mdx","sourceDirName":"client","slug":"/client/timeouts","permalink":"/docs/client/timeouts","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/client/timeouts.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Sending custom HTTP headers","permalink":"/docs/client/custom-http-headers"},"next":{"title":"Automatic retry","permalink":"/docs/client/retry"}}');var o=i(74848),r=i(28453);const a={},s="Overriding client timeouts",c={},l=[{value:"Using ClientBuilder",id:"using-clientbuilder",level:2},{value:"Using WebClientRequestPreparation",id:"using-webclientrequestpreparation",level:2},{value:"Using RequestOptions",id:"using-requestoptions",level:2},{value:"Adjusting connection-level timeouts",id:"adjusting-connection-level-timeouts",level:2},{value:"Using JVM system properties",id:"using-jvm-system-properties",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"overriding-client-timeouts",children:"Overriding client timeouts"})}),"\n",(0,o.jsx)(t.p,{children:"Sometimes, the default timeouts used by the Armeria clients do not suit a particular scenario well.\nIn these cases, you might want to override the timeout settings."}),"\n",(0,o.jsxs)(t.h2,{id:"using-clientbuilder",children:["Using ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientBuilder.html",children:"ClientBuilder"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'import java.time.Duration;\n\nimport com.linecorp.armeria.client.Clients;\n\nint responseTimeout = 30;\nint writeTimeout = 10;\n\nHelloService.Iface client =\n    Clients.builder("tbinary+http://example.com/hello")\n           .responseTimeout(Duration.ofSeconds(responseTimeout))\n           .writeTimeout(Duration.ofSeconds(writeTimeout))\n           .build(HelloService.Iface.class);\n'})}),"\n",(0,o.jsxs)(t.h2,{id:"using-webclientrequestpreparation",children:["Using ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClientRequestPreparation.html",children:"WebClientRequestPreparation"})]}),"\n",(0,o.jsxs)(t.p,{children:["You can override the properties defined in ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})," at request level\nusing ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html#prepare()",children:"WebClient#prepare()"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'import com.linecorp.armeria.client.WebClient;\n\nWebClient client = WebClient.of("http://example.com");\nclient.prepare()\n      .get("/hello")\n      .responseTimeout(Duration.ofSeconds(30))\n      .writeTimeout(Duration.ofSeconds(10)\n      .maxResponseLength(1024)\n      .execute();\n'})}),"\n",(0,o.jsxs)(t.h2,{id:"using-requestoptions",children:["Using ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})]}),"\n",(0,o.jsxs)(t.p,{children:["You can also create a ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})," to override the properties at request level. The\ncreated ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/RequestOptions.html",children:"RequestOptions"})," could be passed to ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html#execute(com.linecorp.armeria.common.HttpRequest,com.linecorp.armeria.client.RequestOptions)?full",children:"WebClient#execute(HttpRequest,RequestOptions)"}),"\nwith an ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpRequest.html",children:"HttpRequest"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'import com.linecorp.armeria.client.RequestOptions;\nimport com.linecorp.armeria.common.HttpRequest;\n\nHttpRequest req = HttpRequest.of(HttpMethod.GET, "/hello");\nRequestOptions options =\n    RequestOptions.builder()\n                  .responseTimeout(Duration.ofSeconds(30))\n                  .writeTimeout(Duration.ofSeconds(10)\n                  .maxResponseLength(1024)\n                  .build();\nclient.execute(req, options);\n'})}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"/docs/advanced/structured-logging#response-properties",children:"Response properties"})," to understand when the\nresponse timeout is scheduled."]})}),"\n",(0,o.jsx)(t.h2,{id:"adjusting-connection-level-timeouts",children:"Adjusting connection-level timeouts"}),"\n",(0,o.jsxs)(t.p,{children:["You need to build a non-default ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html",children:"ClientFactory"})," using ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactoryBuilder.html",children:"ClientFactoryBuilder"})," to override the default\nconnection-level timeouts such as connect timeout and idle timeout programmatically:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:"import com.linecorp.armeria.client.ClientFactory;\n\nClientFactory factory =\n    ClientFactory.builder()\n                 // Increase the connect timeout from 3.2s to 10s.\n                 .connectTimeout(Duration.ofSeconds(10))\n                 // Shorten the idle connection timeout from 10s to 5s.\n                 .idleTimeout(Duration.ofSeconds(5))\n                 // Note that you can also adjust other connection-level\n                 // settings such as enabling HTTP/1 request pipelining.\n                 .useHttp1Pipelining(true)\n                 .build();\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Note that ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html",children:"ClientFactory"})," implements ",(0,o.jsx)(t.code,{children:"java.lang.AutoCloseable"})," and thus needs to be closed when you\nterminate your application. On ",(0,o.jsx)(t.code,{children:"close()"}),", ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientFactory.html",children:"ClientFactory"})," will close all the connections it manages\nand abort any requests in progress."]}),"\n",(0,o.jsx)(t.h2,{id:"using-jvm-system-properties",children:"Using JVM system properties"}),"\n",(0,o.jsx)(t.p,{children:"You can override the default client timeouts by specifying the following JVM system properties if you do not\nprefer setting it programmatically:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"-Dcom.linecorp.armeria.defaultClientIdleTimeoutMillis=<integer>"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["the default client-side idle timeout of a connection for keep-alive in milliseconds. Default: ",(0,o.jsx)(t.code,{children:"10000"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"-Dcom.linecorp.armeria.defaultConnectTimeoutMillis=<integer>"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["the default client-side timeout of a socket connection attempt in milliseconds. Default: ",(0,o.jsx)(t.code,{children:"3200"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"-Dcom.linecorp.armeria.defaultWriteTimeoutMillis=<integer>"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["the default client-side timeout of a socket write attempt in milliseconds. Default: ",(0,o.jsx)(t.code,{children:"1000"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"-Dcom.linecorp.armeria.defaultResponseTimeoutMillis=<integer>"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["the default client-side timeout of a response in milliseconds. Default: ",(0,o.jsx)(t.code,{children:"15000"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsxs)(t.p,{children:["The JVM system properties have effect only when you did not specify them programmatically.\nSee ",(0,o.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/Flags.html",children:"Flags"})," for the complete list of JVM system properties in Armeria."]})})]})}function m(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);