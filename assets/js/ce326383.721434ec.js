"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[1045],{26399:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"tutorials/rest/implement-read","title":"Implementing READ operation","description":"In this step, we\'ll implement two methods at once. One is for retrieving a single post and another for multiple blog","source":"@site/src/content/docs/tutorials/rest/05-implement-read.mdx","sourceDirName":"tutorials/rest","slug":"/tutorials/rest/implement-read","permalink":"/docs/tutorials/rest/implement-read","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/tutorials/rest/05-implement-read.mdx","tags":[{"inline":true,"label":"rest","permalink":"/docs/tags/rest"},{"inline":true,"label":"request-converter","permalink":"/docs/tags/request-converter"}],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_label":"5. Implement READ","type":"step","tags":["rest","request-converter"],"level":"basic"},"sidebar":"docsSidebar","previous":{"title":"4. Implement CREATE","permalink":"/docs/tutorials/rest/implement-create"},"next":{"title":"6. Implement UPDATE","permalink":"/docs/tutorials/rest/implement-update"}}');var i=r(74848),o=r(28453);const a={sidebar_label:"5. Implement READ",type:"step",tags:["rest","request-converter"],level:"basic"},s="Implementing READ operation",l={},c=[{value:"What you need",id:"what-you-need",level:2},{value:"1. Map HTTP method",id:"1-map-http-method",level:2},{value:"2. Handle parameters",id:"2-handle-parameters",level:2},{value:"3. Implement service code",id:"3-implement-service-code",level:2},{value:"4. Return response",id:"4-return-response",level:2},{value:"5. Test retrieving a single post",id:"5-test-retrieving-a-single-post",level:2},{value:"6. Test retrieving multiple posts",id:"6-test-retrieving-multiple-posts",level:2},{value:"Next step",id:"next-step",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{TabItem:r,Tabs:n,TutorialSteps:a}=t;return r||h("TabItem",!0),n||h("Tabs",!0),a||h("TutorialSteps",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"implementing-read-operation",children:"Implementing READ operation"})}),"\n",(0,i.jsxs)(t.p,{children:["In this step, we'll implement two methods at once. One is for retrieving a single post and another for multiple blog\nposts. By completing this step, you'll learn to map your service with the HTTP GET (",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"}),") method, use parameter injection (",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"}),"), set default parameter value (",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Default.html",children:"@Default"}),"), and return a JSON object (",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ProducesJson.html",children:"@ProducesJson"}),") as a response."]}),"\n",(0,i.jsx)(a,{current:5}),"\n",(0,i.jsx)(t.h2,{id:"what-you-need",children:"What you need"}),"\n",(0,i.jsxs)(t.p,{children:["You need to have the following files obtained from previous steps.\nYou can always ",(0,i.jsx)(t.a,{href:"https://github.com/line/armeria-examples/blob/main/tutorials/rest-api-annotated-service/src/main/java/example/armeria/server/blog/",children:"download"})," the full version, instead of creating one yourself."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"Main.java"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"BlogPost.java"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"BlogService.java"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"BlogServiceTest.java"})}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"1-map-http-method",children:"1. Map HTTP method"}),"\n",(0,i.jsxs)(t.p,{children:["Let's start ",(0,i.jsx)(t.a,{href:"/docs/server/annotated-service#mapping-http-service-methods",children:"mapping the HTTP GET method"})," with our service method:"]}),"\n",(0,i.jsxs)(n,{groupId:"rest-read",children:[(0,i.jsxs)(r,{label:"Single post",value:"1",children:[(0,i.jsx)(t.p,{children:"Map the HTTP GET method for retrieving a single post:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Declare a service method ",(0,i.jsx)(t.code,{children:"getBlogPost()"})," in the class ",(0,i.jsx)(t.code,{children:"BlogService"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Map this service method with the HTTP GET method by adding the ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"})," annotation as follows."]}),"\n",(0,i.jsxs)(t.li,{children:["Bind the endpoint ",(0,i.jsx)(t.code,{children:"/blogs"})," to the method."]}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {6}',children:'import com.linecorp.armeria.server.annotation.Get;\n\npublic final class BlogService {\n  ...\n\n  @Get("/blogs")\n  public void getBlogPost(int id) {\n    // Retrieve a single post\n  }\n}\n'})})]}),(0,i.jsxs)(r,{label:"Multiple posts",value:"2",children:[(0,i.jsx)(t.p,{children:"Map the HTTP GET method for retrieving multiple posts:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Declare a service method ",(0,i.jsx)(t.code,{children:"getBlogPosts()"})," in the class ",(0,i.jsx)(t.code,{children:"BlogService"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Map this service method with the HTTP GET method by adding the ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"})," annotation as follows."]}),"\n",(0,i.jsxs)(t.li,{children:["Bind the endpoint ",(0,i.jsx)(t.code,{children:"/blogs"})," to the method."]}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {6}',children:'import com.linecorp.armeria.server.annotation.Get;\n\npublic final class BlogService {\n  ...\n\n  @Get("/blogs")\n  public void getBlogPosts(boolean descending) {\n    // Retrieve multiple posts\n  }\n}\n'})})]})]}),"\n",(0,i.jsx)(t.h2,{id:"2-handle-parameters",children:"2. Handle parameters"}),"\n",(0,i.jsxs)(t.p,{children:["Take in information through ",(0,i.jsx)(t.em,{children:"path"})," and ",(0,i.jsx)(t.em,{children:"query"})," parameters for retrieving blog posts. For retrieving a single post, we'll take a blog post ID as the path parameter. For multiple posts, we'll take the sorting order as a query parameter."]}),"\n",(0,i.jsxs)(n,{groupId:"rest-read",children:[(0,i.jsxs)(r,{label:"Single post",value:"1",children:[(0,i.jsx)(t.p,{children:"Let's handle parameters for retrieving a single post:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["To take in a path parameter, add ",(0,i.jsx)(t.code,{children:"/:id"})," to the ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"})," annotation's parameter as in line 6."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/docs/server/annotated-service#parameter-injection",children:"Inject the path parameter"})," to the service method, annotate the parameter with ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"})," as in line 7."]}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" showLineNumbers',children:'import com.linecorp.armeria.server.annotation.Param;\n\npublic final class BlogService {\n ...\n\n @Get("/blogs/:id")\n public void getBlogPost(@Param int id) {\n   // Retrieve a single post\n }\n}\n'})})]}),(0,i.jsxs)(r,{label:"Multiple posts",value:"2",children:[(0,i.jsx)(t.p,{children:"Let's handle parameters for retrieving multiple posts:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Specify the endpoint for the service using the ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"})," annotation."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/docs/server/annotated-service#parameter-injection",children:"Inject the parameter"})," by annotating the parameter ",(0,i.jsx)(t.code,{children:"descending"})," with ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"})," as in line 8."]}),"\n",(0,i.jsxs)(t.li,{children:["Set the default sorting order to descending by annotating the parameter ",(0,i.jsx)(t.code,{children:"descending"})," with ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Default.html",children:"@Default"}),", with its parameter as ",(0,i.jsx)(t.code,{children:'"true"'}),"."]}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" showLineNumbers',children:'import com.linecorp.armeria.server.annotation.Param;\nimport com.linecorp.armeria.server.annotation.Default;\n\npublic final class BlogService {\n  ...\n\n  @Get("/blogs")\n  public void getBlogPosts(@Param @Default("true") boolean descending) {\n    // Retrieve multiple posts\n  }\n}\n'})})]})]}),"\n",(0,i.jsx)(t.h2,{id:"3-implement-service-code",children:"3. Implement service code"}),"\n",(0,i.jsx)(t.p,{children:"In this step, write the code required for service itself."}),"\n",(0,i.jsxs)(n,{groupId:"rest-read",children:[(0,i.jsxs)(r,{label:"Single post",value:"1",children:[(0,i.jsxs)(t.p,{children:["To retrieve a single blog post information, copy the following code inside the ",(0,i.jsx)(t.code,{children:"getBlogPost()"})," method."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {3}',children:'@Get("/blogs")\npublic void getBlogPost(@Param int id) {\n  BlogPost blogPost = blogPosts.get(id);\n}\n'})})]}),(0,i.jsxs)(r,{label:"Multiple posts",value:"2",children:[(0,i.jsxs)(t.p,{children:["To retrieve multiple blog posts, copy the following code inside the ",(0,i.jsx)(t.code,{children:"getBlogPosts()"})," method. Note that the return type has been changed from ",(0,i.jsx)(t.code,{children:"void"})," to ",(0,i.jsx)(t.code,{children:"Iterable<BlogPost>"}),"."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java"',children:'import java.util.Map.Entry;\nimport java.util.Collections;\nimport java.util.Comparator;\nimport java.util.stream.Collectors;\n\n@Get("/blogs")\npublic Iterable<BlogPost> getBlogPosts(@Param @Default("true") boolean descending) {\n  // Descending\n  if (descending) {\n      return blogPosts.entrySet()\n                      .stream()\n                      .sorted(Collections.reverseOrder(Comparator.comparingInt(Entry::getKey)))\n                      .map(Entry::getValue).collect(Collectors.toList());\n  }\n  // Ascending\n  return blogPosts.values().stream().collect(Collectors.toList());\n}\n'})})]})]}),"\n",(0,i.jsx)(t.h2,{id:"4-return-response",children:"4. Return response"}),"\n",(0,i.jsx)(t.p,{children:"Let's return a response for the service call."}),"\n",(0,i.jsxs)(n,{groupId:"rest-read",children:[(0,i.jsxs)(r,{label:"Single post",value:"1",children:[(0,i.jsx)(t.p,{children:"To return a response for getting a single post:"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Replace the return type of the ",(0,i.jsx)(t.code,{children:"getBlogPost()"})," method from ",(0,i.jsx)(t.code,{children:"void"})," to ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpResponse.html",children:"HttpResponse"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Return a response using Armeria's ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/HttpResponse.html",children:"HttpResponse"})," containing the content of the blog post retrieved."]}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {5,8}',children:'import com.linecorp.armeria.common.HttpResponse;\n\npublic final class BlogService {\n  @Get("/blogs/:id")\n  public HttpResponse getBlogPost(@Param int id) {\n    ...\n\n    return HttpResponse.ofJson(blogPost);\n  }\n}\n'})})]}),(0,i.jsxs)(r,{label:"Multiple posts",value:"2",children:[(0,i.jsxs)(t.p,{children:["We've already implemented returning multiple blog posts in the previous step. Here, annotate the method ",(0,i.jsx)(t.code,{children:"getBlogPosts()"})," with ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ProducesJson.html",children:"@ProducesJson"}),". This converts a list of ",(0,i.jsx)(t.code,{children:"BlogPost"})," objects into a JSON response."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogService.java" {4}',children:'import com.linecorp.armeria.server.annotation.ProducesJson;\n\n@Get("/blogs")\n@ProducesJson\npublic Iterable<BlogPost> getBlogPosts(@Param @Default("true") boolean descending) {\n  // Retrieve multiple blog posts\n}\n'})})]})]}),"\n",(0,i.jsx)(t.h2,{id:"5-test-retrieving-a-single-post",children:"5. Test retrieving a single post"}),"\n",(0,i.jsx)(t.p,{children:"Let's test if we can retrieve a blog post we created."}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["In the ",(0,i.jsx)(t.code,{children:"BlogServiceTest"})," class, add a test method to retrieve the first blog post with ID ",(0,i.jsx)(t.code,{children:"0"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'@Test\nvoid getBlogPost() throws JsonProcessingException {\n  final WebClient client = WebClient.of(server.httpUri());\n  final AggregatedHttpResponse res = client.get("/blogs/0").aggregate().join();\n  final Map<String, Object> expected = Map.of("id", 0,\n              "title", "My first blog",\n              "content", "Hello Armeria!");\n\n  assertThatJson(res.contentUtf8()).whenIgnoringPaths("createdAt", "modifiedAt")\n              .isEqualTo(mapper.writeValueAsString(expected));\n}\n'})}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsxs)(t.li,{children:["Add annotations to configure the order our test methods will be executed.\nThe annotations guarantee that the first blog post will be created in the ",(0,i.jsx)(t.code,{children:"createBlogPost()"})," method before we try to retrieve it in the ",(0,i.jsx)(t.code,{children:"getBlogPost()"})," method."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:"import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;\nimport org.junit.jupiter.api.Order;\nimport org.junit.jupiter.api.TestMethodOrder;\n\n@TestMethodOrder(OrderAnnotation.class) // Add this\nclass BlogServiceTest {\n  ...\n\n  @Test\n  @Order(1) // Add this\n  void createBlogPost() throws JsonProcessingException {\n    ...\n  }\n\n  @Test\n  @Order(2) // Add this\n  void getBlogPost() throws JsonProcessingException {\n    ...\n  }\n}\n"})}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsx)(t.li,{children:"Run all the test cases on your IDE or using Gradle."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Your client retrieved a blog post from the server successfully if the test is passed."}),"\n",(0,i.jsx)(t.h2,{id:"6-test-retrieving-multiple-posts",children:"6. Test retrieving multiple posts"}),"\n",(0,i.jsx)(t.p,{children:"Finally, let's test if we can retrieve multiple posts.\nAdd a test method like the following to create the second blog post and test retrieving the list of blog posts."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:'title="BlogServiceTest.java"',children:'import java.util.List;\n\n@Test\n@Order(3)\nvoid getBlogPosts() throws JsonProcessingException {\n  final WebClient client = WebClient.of(server.httpUri());\n  final HttpRequest request = createBlogPostRequest(Map.of("title", "My second blog",\n                "content", "Armeria is awesome!"));\n  client.execute(request).aggregate().join();\n  final AggregatedHttpResponse res = client.get("/blogs").aggregate().join();\n  final List<Map<String, Object>> expected = List.of(\n          Map.of("id", 1,\n                 "title", "My second blog",\n                 "content", "Armeria is awesome!"),\n          Map.of("id", 0,\n                 "title", "My first blog",\n                 "content", "Hello Armeria!"));\n  assertThatJson(res.contentUtf8()).whenIgnoringPaths("[*].createdAt", "[*].modifiedAt")\n                .isEqualTo(mapper.writeValueAsString(expected));\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Run all the test cases on your IDE or using Gradle.\nCheck that you see the test is passed."}),"\n",(0,i.jsxs)(t.p,{children:["You can test this also with Armeria's ",(0,i.jsx)(t.a,{href:"/docs/server/docservice",children:"Documentation service"}),". See ",(0,i.jsx)(t.a,{href:"/docs/tutorials/rest/add-services-to-server#using-docservice-after-adding-service-methods",children:"Using DocService after adding service methods"})," for instructions."]}),"\n",(0,i.jsx)(t.h2,{id:"next-step",children:"Next step"}),"\n",(0,i.jsxs)(t.p,{children:["In this step, we've implemented methods for a READ operation and used Armeria's annotations; ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Get.html",children:"@Get"}),", ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/ProducesJson.html",children:"@ProducesJson"}),", ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Param.html",children:"@Param"}),", and ",(0,i.jsx)(t.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/annotation/Default.html",children:"@Default"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Next, at ",(0,i.jsx)(t.a,{href:"/docs/tutorials/rest/implement-update",children:"Step 6. Implement UPDATE"}),", we'll implement an UPDATE operation to modify existing blog posts."]}),"\n",(0,i.jsx)(a,{current:5})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}function h(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>s});var n=r(96540);const i={},o=n.createContext(i);function a(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);