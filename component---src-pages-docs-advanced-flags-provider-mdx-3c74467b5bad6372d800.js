"use strict";(self.webpackChunkarmeria_site=self.webpackChunkarmeria_site||[]).push([[4851],{33115:function(e,r,a){a.r(r),a.d(r,{_frontmatter:function(){return c},default:function(){return g},pageTitle:function(){return l}});var t=a(80045),i=(a(96540),a(28619)),o=a(53747);const n=["components"],l="Configuring global flags",c={},s=(m="Tip",function(e){return console.warn("Component "+m+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.yg)("div",e)});var m;const p={pageTitle:l,_frontmatter:c},d=o.A;function g(e){let{components:r}=e,a=(0,t.A)(e,n);return(0,i.yg)(d,Object.assign({},p,a,{components:r,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"configuring-global-flags",style:{position:"relative"}},(0,i.yg)("a",{parentName:"h1",href:"#configuring-global-flags","aria-label":"configuring global flags permalink",className:"anchor before"},(0,i.yg)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Configuring global flags"),(0,i.yg)("h6",{className:"inlinePageToc",role:"navigation"},"Table of contents"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"#what-flags-in-armeria-are"},"What flags in Armeria are")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"#implementing-your-own-typeflagsprovider"},"Implementing your own type://FlagsProvider"))),(0,i.yg)("h2",{id:"what-flags-in-armeria-are",style:{position:"relative"}},(0,i.yg)("a",{parentName:"h2",href:"#what-flags-in-armeria-are","aria-label":"what flags in armeria are permalink",className:"anchor before"},(0,i.yg)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"What flags in Armeria are"),(0,i.yg)("p",null,"Flags are global variables that control the behavior of Armeria.\nThese variables mostly serve one of the following two purposes:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Overriding the default system values.",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#defaultRequestTimeoutMillis():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#defaultRequestTimeoutMillis()"},"type://FlagsProvider#defaultRequestTimeoutMillis()")," changes the server-side timeout of a request."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#defaultMaxServerNumRequestsPerConnection():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#defaultMaxServerNumRequestsPerConnection()"},"type://FlagsProvider#defaultMaxServerNumRequestsPerConnection()")," changes the server-side maximum number of requests\nallowed that can be served concurrently through one connection."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#transportType():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#transportType()"},"type://FlagsProvider#transportType()")," changes the transport type that will be used for socket I/O in Armeria."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#fileServiceCacheSpec():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#fileServiceCacheSpec()"},"type://FlagsProvider#fileServiceCacheSpec()")," changes the cache specification of ",(0,i.yg)("a",{parentName:"li",href:"type://FileService:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/file/FileService.html"},"type://FileService"),"."))),(0,i.yg)("li",{parentName:"ol"},"Enhanced debugging or monitoring.",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#reportBlockedEventLoop():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#reportBlockedEventLoop()"},"type://FlagsProvider#reportBlockedEventLoop()")," enables to log a warning if blocking calls\nsuch as ",(0,i.yg)("inlineCode",{parentName:"li"},"CompletableFuture.join()")," are called from an event loop thread."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#verboseSocketExceptions():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#verboseSocketExceptions()"},"type://FlagsProvider#verboseSocketExceptions()")," enables logging for socket exceptions which are mostly harmless."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#meterRegistry():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#meterRegistry()"},"type://FlagsProvider#meterRegistry()")," changes the default ",(0,i.yg)("inlineCode",{parentName:"li"},"MeterRegistry")," where Armeria records metrics."),(0,i.yg)("li",{parentName:"ul"},"Overriding ",(0,i.yg)("a",{parentName:"li",href:"type://FlagsProvider#requestContextLeakDetectionSampler():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html#requestContextLeakDetectionSampler()"},"type://FlagsProvider#requestContextLeakDetectionSampler()")," enables to request context leak tracing by specifying\na ",(0,i.yg)("a",{parentName:"li",href:"type://Sampler:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/util/Sampler.html"},"type://Sampler"),".")))),(0,i.yg)("p",null,"You can also override these properties by setting JVM system properties. For example:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"-Dcom.linecorp.armeria.defaultRequestTimeoutMillis=<long>")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"-Dcom.linecorp.armeria.defaultMaxServerNumRequestsPerConnection=<integer>")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"-Dcom.linecorp.armeria.reportBlockedEventLoop=<boolean>")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"-Dcom.linecorp.armeria.verboseSocketExceptions=<boolean>"))),(0,i.yg)(s,{mdxType:"Tip"},(0,i.yg)("p",null,"  Please refer to ",(0,i.yg)("a",{parentName:"p",href:"type://FlagsProvider:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html"},"type://FlagsProvider")," for the complete list of global flags.")),(0,i.yg)("h2",{id:"implementing-your-own-typeflagsprovider",style:{position:"relative"}},(0,i.yg)("a",{parentName:"h2",href:"#implementing-your-own-typeflagsprovider","aria-label":"implementing your own typeflagsprovider permalink",className:"anchor before"},(0,i.yg)("svg",{parentName:"a","aria-hidden":"true",focusable:"false",height:"16",version:"1.1",viewBox:"0 0 16 16",width:"16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"}))),"Implementing your own ",(0,i.yg)("a",{parentName:"h2",href:"type://FlagsProvider:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html"},"type://FlagsProvider")),(0,i.yg)("p",null,"Create your own ",(0,i.yg)("a",{parentName:"p",href:"type://FlagsProvider:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html"},"type://FlagsProvider")," and load it via ",(0,i.yg)("a",{parentName:"p",href:"https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html"},"Java SPI"),".\nIf there are multiple implementations of ",(0,i.yg)("a",{parentName:"p",href:"type://FlagsProvider:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/FlagsProvider.html"},"type://FlagsProvider"),", the implementation with the highest priority will take precedence over the others."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java",metastring:"filename=MyFlagsProvider.java",filename:"MyFlagsProvider.java"},"package com.example.providers;\n\npublic class MyFlagsProvider implements FlagsProvider {\n\n  @Override\n  public int priority() {\n    // The provider with higher value will be evaluated first.\n    return 100;\n  }\n\n  @Override\n  public Long defaultRequestTimeoutMillis() {\n      return 5000L;\n  }\n\n  @Override\n  public TransportType transportType() {\n      return TransportType.EPOLL;\n  }\n\n  @Override\n  public Boolean reportBlockedEventLoop() {\n      return true;\n  }\n\n  @Override\n  public Sampler<? super RequestContext> requestContextLeakDetectionSampler() {\n      // Samples all request contexts.\n      return Sampler.always();\n  }\n\n  @Override\n  public MeterRegistry meterRegistry() {\n      return PrometheusMeterRegistries.newRegistry();\n  }\n\n}\n")),(0,i.yg)("p",null,"Add the following text file to your classpath or JAR file."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-text",metastring:"filename=META-INF/services/com.linecorp.armeria.common.FlagsProvider",filename:"META-INF/services/com.linecorp.armeria.common.FlagsProvider"},"com.example.providers.MyFlagsProvider\n")))}g.isMDXComponent=!0},53747:function(e,r,a){a.d(r,{A:function(){return l}});var t=a(41015),i=a(96540),o=JSON.parse('{"root":["index","setup"],"Useful links":{"Tutorials":"/tutorials","Community articles":"/community/articles","API documentation":"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/index.html","Release notes":"/release-notes"},"Server":["server-basics","server-decorator","server-grpc","server-thrift","server-graphql","server-docservice","server-annotated-service","server-http-file","server-servlet","server-access-log","server-cors","server-sse","server-service-registration","server-multipart","server-timeouts"],"Client":["client-http","client-thrift","client-grpc","client-factory","client-decorator","client-retrofit","client-custom-http-headers","client-timeouts","client-retry","client-circuit-breaker","client-service-discovery"],"Advanced":["advanced-logging","advanced-structured-logging","advanced-custom-attributes","advanced-streaming-backpressure","advanced-structured-logging-kafka","advanced-metrics","advanced-unit-testing","advanced-production-checklist","advanced-saml","advanced-spring-boot-integration","advanced-spring-webflux-integration","advanced-dropwizard-integration","advanced-kotlin","advanced-scala","advanced-scalapb","advanced-flags-provider","advanced-zipkin","advanced-client-interoperability"]}'),n=a(61023);var l=e=>{const{allMdx:{nodes:r}}=(0,t.useStaticQuery)("1217743243");return i.createElement(n.A,Object.assign({},e,{candidateMdxNodes:r,index:o,prefix:"docs",pageTitleSuffix:"Armeria documentation"}))}}}]);
//# sourceMappingURL=component---src-pages-docs-advanced-flags-provider-mdx-3c74467b5bad6372d800.js.map