"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[4937],{28453:(e,r,a)=>{a.d(r,{R:()=>c,x:()=>s});var n=a(96540);const i={},t=n.createContext(i);function c(e){const r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),n.createElement(t.Provider,{value:r},e.children)}},53226:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>c,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"server/graphql","title":"Running a GraphQL service","description":"Visit armeria-examples to find a fully working example.","source":"@site/src/content/docs/server/graphql.mdx","sourceDirName":"server","slug":"/server/graphql","permalink":"/docs/server/graphql","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site/src/content/docs/server/graphql.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Running a Thrift service","permalink":"/docs/server/thrift"},"next":{"title":"Browsing and invoking services with DocService","permalink":"/docs/server/docservice"}}');var i=a(74848),t=a(28453);const c={},s="Running a GraphQL service",l={},o=[{value:"<code>GraphqlService</code>",id:"graphqlservice",level:2},{value:"Blocking service implementation",id:"blocking-service-implementation",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components},{RequiredDependencies:a}=r;return a||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("RequiredDependencies",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"running-a-graphql-service",children:"Running a GraphQL service"})}),"\n",(0,i.jsx)(r.admonition,{type:"tip",children:(0,i.jsxs)(r.p,{children:["Visit ",(0,i.jsx)(r.a,{href:"https://github.com/line/armeria-examples",children:"armeria-examples"})," to find a fully working example."]})}),"\n",(0,i.jsxs)(r.p,{children:["First, You need the ",(0,i.jsx)(r.code,{children:"armeria-graphql"})," dependency:"]}),"\n",(0,i.jsx)(a,{boms:[{groupId:"com.linecorp.armeria",artifactId:"armeria-bom"}],dependencies:[{groupId:"com.linecorp.armeria",artifactId:"armeria-graphql"}]}),"\n",(0,i.jsxs)(r.p,{children:["Let's assume we have the following ",(0,i.jsx)(r.a,{href:"https://graphql.org/learn/schema/",children:"GraphQL Schema"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-graphql",children:"type Query {\n  user(id: ID): User\n}\n\ntype User {\n  id: ID\n  name: String\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["The schema describes that if a client requests a ",(0,i.jsx)(r.code,{children:"User"})," data using the ",(0,i.jsx)(r.code,{children:"ID"})," field, the GraphQL server will\nreturn the ",(0,i.jsx)(r.code,{children:"User"})," data. The GraphQL engine uses a ",(0,i.jsx)(r.a,{href:"https://javadoc.io/doc/com.graphql-java/graphql-java/latest/graphql/schema/DataFetcher.html",children:"DataFetcher"}),"\nto resolve the ID and fetch the corresponding object. For the sake of simplicity, let's implement\n",(0,i.jsx)(r.code,{children:"UserDataFetcher"})," that stores ",(0,i.jsx)(r.code,{children:"User"}),"s in a ",(0,i.jsx)(r.code,{children:"Map"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'import graphql.schema.DataFetcher;\nimport graphql.schema.DataFetchingEnvironment;\n\nclass UserDataFetcher implements DataFetcher<User> {\n\n    private final Map<String, User> data = Map.of("1", new User("1", "hero"),\n                                                  "2", new User("2", "human"),\n                                                  "3", new User("3", "droid"));\n\n    @Override\n    public User get(DataFetchingEnvironment environment) throws Exception {\n        final String id = environment.getArgument("id");\n        return data.get(id);\n    }\n}\n'})}),"\n",(0,i.jsx)(r.admonition,{type:"tip",children:(0,i.jsxs)(r.p,{children:["Please note that this is entirely based on ",(0,i.jsx)(r.a,{href:"https://www.graphql-java.com/",children:"graphql-java"}),"."]})}),"\n",(0,i.jsx)(r.h2,{id:"graphqlservice",children:(0,i.jsx)(r.code,{children:"GraphqlService"})}),"\n",(0,i.jsxs)(r.p,{children:["Once you've finished the implementation of the ",(0,i.jsx)(r.a,{href:"https://javadoc.io/doc/com.graphql-java/graphql-java/latest/graphql/schema/DataFetcher.html",children:"DataFetcher"}),", you need to build a ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/graphql/GraphqlService.html",children:"GraphqlService"})," using\na ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/graphql/GraphqlServiceBuilder.html",children:"GraphqlServiceBuilder"})," and add it to the ",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/ServerBuilder.html",children:"ServerBuilder"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'import com.linecorp.armeria.server.Server;\nimport com.linecorp.armeria.server.ServerBuilder;\nimport com.linecorp.armeria.server.graphql.GraphqlService;\n\nServerBuilder sb = Server.builder();\n...\nsb.service("/graphql",\n           GraphqlService.builder()\n                         .runtimeWiring(c -> {\n                            c.type("Query",\n                                   typeWiring -> typeWiring.dataFetcher("user", new UserDataFetcher()));\n                         })\n                         .build());\n...\nServer server = sb.build();\nserver.start();\n'})}),"\n",(0,i.jsxs)(r.p,{children:["We used ",(0,i.jsx)(r.a,{href:"https://javadoc.io/doc/com.graphql-java/graphql-java/latest/graphql/schema/idl/RuntimeWiring.html",children:"RuntimeWiring"})," to wire the type with DataFetcher. Please see ",(0,i.jsx)(r.a,{href:"https://www.graphql-java.com/documentation/master/schema/#creating-a-schema-using-the-sdl",children:"Creating a schema using the SDL"})," to find more wiring examples."]}),"\n",(0,i.jsx)(r.h2,{id:"blocking-service-implementation",children:"Blocking service implementation"}),"\n",(0,i.jsxs)(r.p,{children:["Armeria does not run service logic in a separate thread pool by default. If your service implementation\nrequires blocking, either run the individual blocking logic in a thread pool, or set\n",(0,i.jsx)(r.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/graphql/GraphqlServiceBuilder.html#useBlockingTaskExecutor(boolean)",children:"GraphqlServiceBuilder#useBlockingTaskExecutor(boolean)"})," to ",(0,i.jsx)(r.code,{children:"true"})," so the service runs in\nall service methods and lifecycle callbacks."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'ServerBuilder sb = Server.builder();\nsb.service("/graphql",\n           GraphqlService.builder()\n                         .runtimeWiring(c -> {\n                            c.type("Query",\n                                   typeWiring -> typeWiring.dataFetcher("user", new UserDataFetcher()));\n                         })\n                         // All service methods will be run within\n                         // the blocking executor.\n                         .useBlockingTaskExecutor(true)\n                         .build());\n'})}),"\n",(0,i.jsx)(r.admonition,{type:"tip",children:(0,i.jsxs)(r.p,{children:["You can wrap a ",(0,i.jsx)(r.a,{href:"https://javadoc.io/doc/com.graphql-java/graphql-java/latest/graphql/schema/DataFetcher.html",children:"DataFetcher"})," using ",(0,i.jsx)(r.a,{href:"https://javadoc.io/doc/com.graphql-java/graphql-java/latest/graphql/schema/AsyncDataFetcher.html",children:"AsyncDataFetcher"})," to run it asynchronously."]})})]})}function d(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);