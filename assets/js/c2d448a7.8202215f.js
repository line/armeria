"use strict";(globalThis.webpackChunkarmeria_site=globalThis.webpackChunkarmeria_site||[]).push([[264],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(96540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},48641:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"client/custom-http-headers","title":"Sending custom HTTP headers","description":"When sending an RPC request, it is sometimes required to send HTTP headers with it, such as an authentication token.","source":"@site/src/content/docs/client/custom-http-headers.mdx","sourceDirName":"client","slug":"/client/custom-http-headers","permalink":"/docs/client/custom-http-headers","draft":false,"unlisted":false,"editUrl":"https://github.com/line/armeria/edit/main/site-new/src/content/docs/client/custom-http-headers.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Retrofit integration","permalink":"/docs/client/retrofit"},"next":{"title":"Overriding client timeouts","permalink":"/docs/client/timeouts"}}');var r=i(74848),a=i(28453);const o={},c="Sending custom HTTP headers",l={},s=[{value:"Using <code>Clients.withHeaders()</code>",id:"using-clientswithheaders",level:2},{value:"Using <code>ClientOptions.HEADERS</code>",id:"using-clientoptionsheaders",level:2},{value:"Using <code>ClientBuilder.decorator()</code>",id:"using-clientbuilderdecorator",level:2},{value:"Using a derived client",id:"using-a-derived-client",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sending-custom-http-headers",children:"Sending custom HTTP headers"})}),"\n",(0,r.jsx)(n.p,{children:"When sending an RPC request, it is sometimes required to send HTTP headers with it, such as an authentication token.\nThere are four ways to customize the HTTP headers of your RPC request:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Using the ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/Clients.html#withHeaders(java.util.function.Consumer)",children:"Clients#withHeaders(Consumer)"})," method"]}),"\n",(0,r.jsxs)(n.li,{children:["Using the ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientOptions.html#HEADERS",children:"ClientOptions#HEADERS"})," option"]}),"\n",(0,r.jsxs)(n.li,{children:["Using the ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientBuilder.html#decorator(java.util.function.Function)",children:"ClientBuilder#decorator(Function)"})," method"]}),"\n",(0,r.jsx)(n.li,{children:"Using a derived client"}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"using-clientswithheaders",children:["Using ",(0,r.jsx)(n.code,{children:"Clients.withHeaders()"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import static com.linecorp.armeria.common.HttpHeaderNames.AUTHORIZATION;\nimport com.linecorp.armeria.common.util.SafeCloseable;\nimport com.linecorp.armeria.client.Clients;\n\nHelloService.Iface client = Clients.newClient("tbinary+http://example.com/hello",\n                                               HelloService.Iface.class);\ntry (SafeCloseable ignored = Clients.withHeaders(\n        headers -> headers.set(AUTHORIZATION, credential))) {\n    client.hello("authorized personnel");\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["If you are setting only a single header,\nyou can use ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/Clients.html#withHeader(java.lang.CharSequence,java.lang.String)",children:"Clients#withHeader(CharSequence,String)"})," simply:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'try (SafeCloseable ignored = Clients.withHeader(AUTHORIZATION, credential)) {\n    client.hello("authorized personnel");\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can also nest ",(0,r.jsx)(n.code,{children:"withHeader(s)"}),". The following example will send both ",(0,r.jsx)(n.code,{children:"user-agent"})," header and\n",(0,r.jsx)(n.code,{children:"authorization"})," header when calling ",(0,r.jsx)(n.code,{children:"client.hello()"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import static com.linecorp.armeria.common.HttpHeaderNames.USER_AGENT;\n\ntry (SafeCloseable ignored1 = Clients.withHeader(USER_AGENT, myUserAgent)) {\n    for (String cred : credentials) {\n        try (SafeCloseable ignored2 = Clients.withHeaders(AUTHORIZATION, cred)) {\n            client.hello("authorized personnel");\n        }\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"using-clientoptionsheaders",children:["Using ",(0,r.jsx)(n.code,{children:"ClientOptions.HEADERS"})]}),"\n",(0,r.jsxs)(n.p,{children:["If you have a custom HTTP header whose value does not change often, you can use\n",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientOptions.html#HEADERS",children:"ClientOptions#HEADERS"})," which is more efficient:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import static com.linecorp.armeria.common.HttpHeaderNames.AUTHORIZATION;\nimport com.linecorp.armeria.common.HttpHeaders;\nimport com.linecorp.armeria.client.ClientBuilder;\nimport com.linecorp.armeria.client.ClientOption;\n\nClientBuilder cb = Clients.builder("tbinary+http://example.com/hello");\ncb.setHeader(AUTHORIZATION, credential);\n// or:\n// cb.option(ClientOptions.HEADERS, HttpHeaders.of(AUTHORIZATION, credential));\nHelloService.Iface client = cb.build(HelloService.Iface.class);\nclient.hello("authorized personnel");\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"using-clientbuilderdecorator",children:["Using ",(0,r.jsx)(n.code,{children:"ClientBuilder.decorator()"})]}),"\n",(0,r.jsx)(n.p,{children:"If you want more freedom on how you manipulate the request headers, use a decorator:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'ClientBuilder cb = Clients.builder("tbinary+http://example.com/hello");\n\n// Add a decorator that inserts the custom header.\ncb.decorator((delegate, ctx, req) -> { // See DecoratingHttpClientFunction and DecoratingRpcClientFunction.\n    HttpRequest newReq = req.withHeaders(req.headers().toBuilder().set(AUTHORIZATION, credential));\n    ctx.updateRequest(newReq);\n    return delegate.execute(ctx, newReq);\n});\n\nHelloService.Iface client = cb.build(HelloService.Iface.class);\nclient.hello("authorized personnel");\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Note that this method is as efficient as the ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientOptions.html#HEADERS",children:"ClientOptions#HEADERS"})," option.\nChoose whichever you prefer."]}),"\n",(0,r.jsx)(n.h2,{id:"using-a-derived-client",children:"Using a derived client"}),"\n",(0,r.jsxs)(n.p,{children:["Although not as simple as using ",(0,r.jsx)(n.a,{href:"type://https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/Clients.html#withHeader(java.lang.CharSequence,java.lang.String)",children:"Clients#withHeader(CharSequence,String)"}),",\nyou can create a derived client to add more custom headers to an existing client:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"HelloService.Iface client = ...;\nHelloService.Iface derivedClient = Clients.newDerivedClient(client, options -> {\n    return ClientOptions.builder()\n                        .options(options)\n                        .decorator(...)  // Add a decorator.\n                        .addHeader(AUTHORIZATION, credential)  // Add an HTTP header.\n                        .build();\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);